"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="1692c739-cf8b-50e4-90c0-2c619989e8b5")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[1119],{473935:(e,t,n)=>{n.d(t,{X:()=>z});var a=n(848318),r=n(301168),l=n(316397),i=n(239604),o=n(398872),s=n(734045),c=n(782288),u=n(186606),d=n(320953),m=n(536384),x=n.n(m),g=n(857607),p=n(379267),h=n(554326),f=n(614892),y=n(899757),E=n(738042),_=n(103392),b=n(169660);let v="stack_controls--input--gK1jo text--fontNeg12--2PWcg text--_fontBase--QdLsd text--_negText--j9g-L",k="stack_controls--scrubbableControl--b1ChI",C="stack_controls--inputSvg--wFizL",S="stack_controls--stackSpacingRow--Uus3H";function w(){let e=(0,h.J2)(u.Ez5.canvasViewState().focusedStackRegion);if(!e)return null;let{region:t,focus:n}=e;return t===u.RN9.SPACING?a.createElement(N,{focusOnMount:n}):t===u.RN9.COUNTER_SPACING?a.createElement(A,{focusOnMount:n}):a.createElement(I,{stackRegion:t,focusOnMount:n})}let T=e=>{if(e.keyCode===g.Uz.TAB){e.preventDefault(),e.currentTarget.blur();let t=e.shiftKey;u.Qa7.tabActiveStackRegion(t)}};function N({focusOnMount:e}){return a.createElement(f.fI,{className:S},a.createElement(b.KI,{focusOnMount:e,inputClassName:v,inputTestId:"stackSpacingControl",noBorderOnFocus:!0,onBlur:u.Qa7.clearActiveStackRegion,onCanvasUI:!0,onKeyDown:T,onPaste:L,outerClassName:k,recordingKey:"stackSpacingControl",source:"canvas",svgClassName:C}))}function A({focusOnMount:e}){return a.createElement(f.fI,{className:S},a.createElement(y.q,{focusOnMount:e,inputClassName:v,inputTestId:"stackCounterSpacingControl",noBorderOnFocus:!0,onBlur:u.Qa7.clearActiveStackRegion,onCanvasUI:!0,onKeyDown:T,onPaste:L,outerClassName:k,recordingKey:"stackCounterSpacingControl",source:"canvas",svgClassName:C}))}function I({stackRegion:e,focusOnMount:t}){let[n]=(0,_.HF)(e),r=Array.isArray(n)?n.length:0;return e===u.RN9.SPACING?null:a.createElement(f.fI,{className:x()("stack_controls--stackPaddingRow--40WUa",{"stack_controls--large--bJFUN":r>3})},a.createElement(E.s,{disableVariablesEntryPoint:!0,focusOnMount:t,inputClassName:v,inputTestId:"stackPaddingControl",noBorderOnFocus:!0,onBlur:u.Qa7.clearActiveStackRegion,onKeyDown:T,onPaste:L,outerClassName:k,paddingSelection:e,recordingKey:"stackPaddingControl",source:"canvas",svgClassName:C}))}function L(e){(0,p.gk)(e)&&(e.preventDefault(),e.currentTarget.blur(),d.l7.user("paste-in-stack",()=>{u.glU.triggerAction("paste",{})}))}let z=a.memo(function(){return(0,r.d4)(e=>e.mirror.appModel.isReadOnly)?null:a.createElement(M,null)});function M(){return a.createElement(l.k,{isShown:!0},a.createElement(s.IA,null,a.createElement(R,{testID:"DesignInlineMenu"})))}function R({testID:e}){let t=(0,r.d4)(e=>{let t=e.mirror.selectionProperties.stackMode;return 1===e.mirror.selectionProperties.numSelected&&("HORIZONTAL"===t||"VERTICAL"===t||"GRID"===t)});return(0,r.d4)(e=>{let t=e.mirror.selectionProperties.selectedWidgetInfo;return!!(1===e.mirror.selectionProperties.numSelected&&t?.propertyMenu.length)})?a.createElement(c.W1,{size:"small",testID:e},a.createElement(i.jk,null),a.createElement(o.x,null)):t?a.createElement(c.W1,{testID:e,darkModePreferred:!0},a.createElement(w,{key:"stackControls"})):null}},149928:(e,t,n)=>{n.d(t,{m:()=>r});var a=n(848318);function r({children:e}){return a.createElement("div",{className:"objects_panel_container--container--jBz9j"},e)}},766647:(e,t,n)=>{n.d(t,{U0:()=>lc,Cb:()=>ld,gC:()=>lm});var a=n(848318),r=n(301168),l=n(938982),i=n(658029),o=n(326149),s=n(91876),c=n(749214);let u=(0,a.memo)(function(e){return(0,c.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,c.jsx)("path",{fill:"var(--color-icon)",d:"M14 4a3 3 0 0 1 1.656 5.5A3 3 0 0 1 14 15a2.98 2.98 0 0 1-2-.769V17a3 3 0 1 1-4.657-2.5 2.996 2.996 0 0 1 0-5A3 3 0 0 1 9 4zm3.5 11a.5.5 0 0 1 .5.5V17h1.5a.5.5 0 0 1 0 1H18v1.5a.5.5 0 0 1-1 0V18h-1.5a.5.5 0 0 1 0-1H17v-1.5a.5.5 0 0 1 .5-.5M9 15a2 2 0 1 0 2 2v-2zm0-5a2 2 0 1 0 0 4h2v-4zm5 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4M9 5a2 2 0 1 0 0 4h2V5zm3 4h2a2 2 0 1 0 0-4h-2z"})})});var d=n(757071),m=n(186606),x=n(82433),g=n(19180),p=n(382902),h=n(740705),f=n(978877),y=n(989232),E=n(998568),_=n(396872),b=n(461979),v=n(256350),k=n(967688),C=n(31898),S=n(493228),w=n(636524),T=n(163699),N=n(551011),A=n(255130),I=n(495243),L=n(947943),z=n(107242),M=n(277059),R=n(867790),O=n(947967),j=n(344042),B=n(791455),F=n(162796),$=n(309488),D=n(93275),q=n(768618),P=n(446951),H=n(416406),U=n(709076),G=n(559537),V=n(605808),W=n(320953),K=n(865114),X=n(439952),Y=n(355755),Z=n(554326),J=n(274466),Q=n(927148),ee=n(111592);async function et(e,t){let n;if(W.l7.ai("figmake",()=>{let t=e.createCodeLayerFromDesign("paste",!0,Q.n0);if(1!==t.length)throw Error("Expected exactly one code layer to be created");n=t[0]}),n)await (0,X.Jr)().loadAllImagesUnder(n,m.MoD.ALL,"rev-image-paste");else{let n=p.zl.get(G.Ah).find(t=>(0,G.ak)(t,e.guid));t(t=>t.filter(t=>!(0,G.ak)(t,e.guid))),ee.H.system("figmake",()=>{let t=(0,q.UN)().get(e.guid);t&&t.removeSelfAndChildren()});let a=n?.designToCodeErrors;a&&a[0]?(0,G.hH)(a[0]):(0,G.hH)(m.FDn.DESIGN_2_REACT_OTHER)}}async function en(e,t,n,a,r){if(!e)return;let l=t.get(e);if(!l)return;let i=(0,J.A)(l)?"IMAGE":"FIGMA_NODE";if("FIGMA_NODE"===i&&"TEXT"===l.type){a(l.characters),W.l7.system("clean-up-chat-box-pasted-text-node",()=>{l.removeSelfAndChildren()}),n(e=>{let t=e.find(e=>"pending"===e.status);return t?e.filter(e=>e.uniqueId!==t.uniqueId):e});return}let o=r(e);try{"FIGMA_NODE"===i?await et(l,n):function(e,t,n){let a=(0,G.NC)(e),r=(0,G.Zz)(e);if(m.glU?.addImageNodeAsImageImport(e.id),a){let l={status:"success",nodeGuid:e.guid,image:a,imageHash:r,type:"IMAGE",uniqueId:t};n(t=>t.map(t=>(0,G.ak)(t,e.guid)?l:t))}}(l,o,n)}catch(t){n(t=>t.map(t=>(0,G.ak)(t,e)?{...t,status:"error"}:t))}}let ea=(0,P.Ju)(function(e){let t=F.hS(e),{claimAPendingAttachmentOrMakeOne:n,setAttachments:r}=(0,G._9)(e.chatMessagesNodeGuid||""),{addCommunityAttribution:l}=(0,V.Pe)(),i=a.useCallback((e,t,a)=>{let l=(0,q.UN)(),i=e[0];if(!i)return;let o=l.get(i);if(!o)return;let s=l.getInternalCanvas();s&&(ee.H.system("figmake-inserted-component",()=>{s.appendChild(o)}),en(i,l,r,()=>{},n))},[r,n]),o=a.useCallback((e,t)=>{l(t,{hubFileId:e.hub_file_id.toString(),creatorName:e.editor_name,hubFileName:e.file_name})},[l]);return a.createElement($.bL,{manager:t,width:"fit-content"},a.createElement(D.vo,null,a.createElement(D.Y9,null,a.createElement(D.hE,null,(0,k.t)("sites.panel.make.attach_design"))),a.createElement(D.nB,{padding:0},a.createElement(H.s3,{name:"chatAssetSearch",recordingKey:"chatAssetSearch"},a.createElement(U.z6,{isFigmake:!0,isVisualSearch:!1,closeOnEscape:!0,assetInsertionCallback:i,hubFileFragmentInsertionCallback:o})))))},"ChatAssetSearchModal",P.ZU.YES);var er=n(660376),el=n(469508),ei=n(232786),eo=n(760893),es=n(376771),ec=n(531788),eu=n(773511),ed=n(211616),em=n(767332),ex=n(713196);let eg=(0,a.memo)(function(e){return(0,c.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,c.jsx)("path",{fill:"var(--color-icon)",fillRule:"evenodd",d:"m16.7 5.699.315-1.26c.126-.505.844-.505.97 0L18.3 5.7l1.26.315c.505.126.505.844 0 .97L18.3 7.3l-.315 1.26c-.126.505-.844.505-.97 0L16.7 7.3l-1.26-.315c-.505-.126-.505-.844 0-.97zM13 6a.5.5 0 0 1 0 1H7.5a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V11a.5.5 0 0 1 1 0v5.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 6 16.5v-9A1.5 1.5 0 0 1 7.5 6zm-2.146 4.146a.5.5 0 0 1 0 .708L9.707 12l1.147 1.146a.5.5 0 0 1-.708.708l-1.5-1.5a.5.5 0 0 1 0-.708l1.5-1.5a.5.5 0 0 1 .708 0m2.292.708a.5.5 0 0 1 .708-.708l1.5 1.5a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708-.708L14.293 12z",clipRule:"evenodd"})})});var ep=n(586646),eh=n(447426),ef=n(491383),ey=n(782073),eE=n(18252),e_=n(918777),eb=n(615233),ev=n(178806),ek=n(850426),eC=n(877146),eS=n(863270),ew=n(481406),eT=n(818031),eN=n(330362),eA=n(8578),eI=n(101872),eL=n(730143),ez=n(633468),eM=n(318147),eR=n(138528),eO=n(532511),ej=n(679996),eB=n(697051),eF=n(880801),e$=n(648013),eD=n(982963),eq=n(182656),eP=n(369231),eH=n(748059),eU=n(187782),eG=n(63163),eV=n(912873),eW=n(597803),eK=n(523152);let eX={chatBoxMessageRow:{alignItems:"x6s0dn4",borderRadius:"x9h44rk",display:"x78zum5",flexDirection:"x1q0g3np",justifyContent:"x1qughib",marginBottom:"x38tqe7",paddingTop:"x1y1aw1k",paddingInline:"xdqyycr",paddingBottom:"x1s51fez",position:"x1n2onr6",zIndex:"x8knxv4",$$css:!0},chatBoxMessageRowPrimary:{backgroundColor:"xu5wzci",color:"x1tk3asg",fontWeight:"x1s688f",$$css:!0},chatBoxMessageRowError:{backgroundColor:"x3yuajn",color:"x172n1ly",$$css:!0},chatBoxMessageRowWarning:{backgroundColor:"x1mt81i5",color:"x12fzf0q",$$css:!0},chatBoxMessageRowCommunity:{backgroundColor:"x1v8gsql",color:"x1akne3o",$$css:!0},chatBoxMessageRowInfo:{backgroundColor:"x1yjdb4r",border:"x1bamp8i",color:"x1akne3o",$$css:!0},chatBoxMessageRowWithClose:{paddingRight:"x1m2p0i2",$$css:!0}};function eY({children:e,variant:t,onClose:n}){return a.createElement("div",{...x.Ay.props(eX.chatBoxMessageRow,"primary"===t&&eX.chatBoxMessageRowPrimary,"error"===t&&eX.chatBoxMessageRowError,"warning"===t&&eX.chatBoxMessageRowWarning,"community"===t&&eX.chatBoxMessageRowCommunity,"info"===t&&eX.chatBoxMessageRowInfo,n&&eX.chatBoxMessageRowWithClose)},e,n&&a.createElement("div",{className:"x10l6tqk xclnmbr"},a.createElement(i.K,{onClick:n,"aria-label":(0,k.t)("living_designs.chat.errors.close")},a.createElement(eK.L,null))))}var eZ=n(71774),eJ=n(824937),eQ=n(885800);function e0(){let e=(0,eJ.RK)(),t=e?.name??"",{isConnectedNonOwner:n}=(0,eJ.zA)(),[r,l]=a.useState(!1),{getTriggerProps:i,getContainerProps:o,getArrowProps:s}=eH.fP({isOpen:r,onOpenChange:l,type:"dialog",openOnHover:!0,placement:"top"}),c=(0,p.Xr)(eW.Xl),u=(0,p.md)(eW.Xl),d=(0,p.md)(eW.GV),m=(0,eQ.A)();return((0,eG.h)(()=>{d&&m({showVisualBells:!1})}),d||!u)?null:a.createElement(eY,{variant:"warning",onClose:()=>c(!1)},a.createElement("div",{className:"x78zum5 x1q0g3np x1qughib x6s0dn4 xh8yej3","data-testid":"supabase-deploy-nudge"},a.createElement("div",{className:"x78zum5 x1q0g3np x167g77z xkh2ocl x6s0dn4"},a.createElement("div",{className:"x1gxdvn5"},a.createElement(eU.e,null)),a.createElement("div",{className:"x78zum5 xdt5ytf"},a.createElement("p",{...x.Ay.props(e1.textBodyMediumStrong)},(0,k.t)("figmake.deploy_nudge.init.title")),a.createElement("p",{...x.Ay.props(e1.textBodyMedium)},(0,k.t)("figmake.deploy_nudge.init.subtitle")))),a.createElement(eH.mc,{...o({style:{boxShadow:"var(--elevation-500-modal-window)",borderRadius:"var(--radius-large, 0.8125rem)",padding:"4px",background:"var(--color-bg)",width:"240px"}})},a.createElement(eH.i3,{...s()}),a.createElement("div",{className:"x78zum5 xkh2ocl xz9dl7a xsag5q8 xnm25rq"},a.createElement("p",{...x.Ay.props(e1.textBodyMediumStrong)},(0,k.t)("figmake.deploy_nudge.popover.title"))),a.createElement("div",{className:"xv42yna xh8yej3"}),a.createElement("div",{className:"x78zum5 xdt5ytf xkh2ocl x1bptt5e x1v2ro7d x1cy8zhl"},a.createElement("p",{...x.Ay.props(e1.textBodyMedium)},(0,k.t)("figmake.deploy_nudge.popover.subtitle")),a.createElement("div",{className:"x78zum5 x1q0g3np x167g77z"},a.createElement(eZ.ls,{size:eV.Pf.LARGE}),a.createElement("div",{className:"x78zum5 xdt5ytf xkvmg5q"},a.createElement("p",{...x.Ay.props(e1.textBodyMediumStrong)},t),a.createElement("p",{...x.Ay.props(e1.textBodyMediumSecondary)},(0,k.t)("figmake.deploy_nudge.popover.user_avatar.subtitle"))),a.createElement("div",null)))),a.createElement(ec.$n,{variant:"secondary",disabled:n,onClick:()=>m({showVisualBells:!0}),...n?i():{}},(0,k.t)("figmake.settings.connected_project.deploy_button"))))}let e1={textBodyMedium:{...ey.g.textBodyMedium,$$css:!0},textBodyMediumStrong:{...ey.g.textBodyMediumStrong,$$css:!0},textBodyMediumSecondary:{...ey.g.textBodyMedium,color:"x1n0bwc9",$$css:!0}};var e5=n(276630),e7=n(175957),e2=n(304738),e8=n(951212),e6=n(102865),e3=n(710923),e4=n(264530),e9=n(897659),te=n(277311),tt=n(696483),tn=n(601021),ta=n(721494),tr=n(347857),tl=n(518016),ti=n(362026),to=n(863703);let ts={inspectedElementAttachment:{display:"x78zum5",flexDirection:"x1q0g3np",justifyContent:"x1qughib",alignItems:"x6s0dn4",marginLeft:"xq1n1xh",marginTop:"x14vqqas",gap:"x1jnr06f",borderRadius:"x12oqio5",width:"xeq5yr9",$$css:!0},inspectedElementPrompt:{backgroundColor:"x1v8gsql",border:"x1bamp8i",color:"x1akne3o",$$css:!0},inspectedElementPromptIcon:{"--color-icon":"xmauxvm",$$css:!0},inspectedElementChat:{margin:"x1ghz6dp",marginLeft:null,marginTop:null,paddingRight:"xy13l1i",backgroundColor:"xcr9a89",color:"x1quhyk7",$$css:!0},inspectedElementChatIcon:{"--color-icon":"x1aue78i",$$css:!0}};function tc({tagName:e,variant:t="prompt"}){let n=(0,p.md)(N.f3),r=a.useCallback(()=>{n?.setDirectManipulationEnabled(!1)},[n]);return a.createElement("div",{...x.Ay.props(ts.inspectedElementAttachment,"prompt"===t?ts.inspectedElementPrompt:ts.inspectedElementChat)},a.createElement("div",null,tu(e,t)),a.createElement("div",null,e),"prompt"===t?a.createElement(i.K,{"aria-label":(0,k.t)("figmake.chat.click_to_inspect.remove"),onClick:r},a.createElement(tt.f,{className:"xmauxvm"})):null)}let tu=(e,t)=>{let n=x.Ay.props("prompt"===t?ts.inspectedElementPromptIcon:ts.inspectedElementChatIcon);switch(e.toLocaleLowerCase()){case"p":case"span":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"label":case"strong":case"em":case"b":case"i":return a.createElement(tn.e,{...n});case"a":return a.createElement(ta.r,{...n});case"img":case"video":return a.createElement(tr.s,{...n});case"li":case"ul":return a.createElement(tl.Z,{...n});case"ol":return a.createElement(ti.p,{...n});default:return a.createElement(to.c,{...n})}};var td=n(630677),tm=n(637640),tx=n(103661),tg=n(946778),tp=n(311045),th=n(14564),tf=n(169567),ty=n(901319),tE=n(437631);function t_(){let e=(0,ty.Y9)((0,k.t)("auth.welcome-to-figma")),t=(0,r.wA)();return a.createElement(eS.fu,{name:"Logged Out File Chatbox Banner"},a.createElement("div",{className:"x9f619 x78zum5 x1ov5egs x9a3u73 x1cy8zhl x1mxnbhz x131gfan x1mgsydn x167g77z"},a.createElement("div",{className:"x1tk3asg x1g2dr8m xiqqdae x1j61x8r xkezfkh x14kxzw3 xqp8s7e x78zum5 x6s0dn4 xxk0z11 x1iyjqo2 xeuugli"},a.createElement("span",{className:"xb3r6kr xuxw1ft xlyipyv"},(0,k.t)("auth.sign_up_to_use_figma_rev"))),a.createElement("div",{className:"xeq5yr9 x78zum5 x13a6bvl x167g77z x3psx0u"},a.createElement(eu.E,{onClick:()=>{(0,th.UK)("SIGN_UP_BUTTON_BANNER"),e({origin:td.ty.FIGMA_REV_LOGGED_OUT_FOOTER,formState:tg.qB.SIGN_UP})},className:"xxk0z11 x16v0e3u xf67zum x19y5rnk x1akne3o x2b8uid xeq5yr9 xclx6tv xiqqdae x1j61x8r xkezfkh x14kxzw3 xqp8s7e x2lah0s"},(0,k.t)("auth.sign_up")),a.createElement(tf.M,{onClick:()=>{(0,th.UK)("GOOGLE_SSO_BUTTON"),(0,td.Rm)({dispatch:t,origin:td.ty.FIGMA_REV_LOGGED_OUT_FOOTER_WITH_GOOGLE,redirectUrl:tm.Ay.location.pathname}).then(e=>{"login"===e.type&&t(tx.My({userId:e.user.id}))},e=>{(0,tp.g)("google_signup_error",td.ty.FIGMA_REV_LOGGED_OUT_FOOTER_WITH_GOOGLE,{error:e.message})})}})),a.createElement(tE.P,{origin:td.DT.LOGGED_OUT_FILE,overrideUseFedCMPrompt:!1})))}var tb=n(279144),tv=n(399994),tk=n(213584),tC=n(143823),tS=n(498561);let tw=(0,p.eU)({});async function tT(e){let t=await e.loadImagesAndExport([{imageType:"PNG",contentsOnly:!0,useAbsoluteBounds:!1,colorProfile:"DOCUMENT"}]);return`data:image/png;base64,${(0,b.H9)(t)}`}let tN=()=>{let[e,t]=(0,p.fp)(tw);return a.useCallback(async n=>{let a=(0,q.UN)();if(e[n])return e[n];let r=a.get(n);if(!r)return;let l=await tT(r);return t(e=>({...e,[n]:l})),l},[e,t])},tA=(0,P.Ju)(function(e){let{importNodeGuid:t}=e,[n,l]=a.useState(!0),[i,o]=a.useState(!1),[s,c]=a.useState(null),[u]=(0,p.fp)(tw),d=tN(),m=(0,r.wA)(),x=a.useCallback(async()=>{o(!1),u[t]||l(!0);try{let e=await d(t);c(e||null),e||o(!0)}catch(e){console.error("Error loading image:",e),o(!0)}finally{l(!1)}},[t,d,u]);a.useEffect(()=>{x()},[x]);let g=F.hS({open:!0,onClose:()=>(m(C.Lo()),!0)});return a.createElement($.bL,{manager:g,width:"fit-content",height:"full"},a.createElement(D.vo,null,a.createElement(D.Y9,null,null),a.createElement(D.nB,{scrolling:"none",padding:0},a.createElement("div",{style:{width:"80vw",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"}},n?a.createElement("div",null,a.createElement(tC.k,{size:"lg"})):s?a.createElement(tS.D,{imageSrc:s,shouldZoomToStart:!1,shouldWheelPan:!0,enableZoomControls:!0,enableZoomKeyControls:!0,minZoomFactor:.01,maxZoomFactor:10,crossOrigin:"use-credentials"}):i?a.createElement("div",{style:{textAlign:"center"}},(0,k.t)("figmake.import_modal.error")):null))))},"FigmakeImportModal",P.ZU.NO);function tI(){let e=(0,r.wA)();return t=>e(C.to({type:tA,data:{importNodeGuid:t}}))}let tL={attachmentWrapper:{position:"x1n2onr6",$$css:!0},hideChildFileIconOnHover:{"--xvxo1p6":"xyymrbi xhxs2qp",$$css:!0},attachmentFileTypeIconWrapper:{position:"x10l6tqk",top:"xndqk7f",right:"x1pzoy33",insetInlineStart:null,insetInlineEnd:null,opacity:"x1lw2822",pointerEvents:"x47corl",$$css:!0}};function tz({attachment:e,clearAttachment:t}){let n=tI(),r=(0,G.oz)();if("error"===e.status)return null;if(!(0,G.aZ)(e))return a.createElement(tM,{onClear:()=>r(e)});let l="success"===e.status?e.type:null;return a.createElement(tR,{pastedDesignNodeId:e.nodeGuid,loading:"loading"===e.status,onClear:()=>{e.nodeGuid&&t(e)},onClick:e=>{n(e)},attachmentType:l})}function tM({onClear:e}){let t={thumbnailUrl:"",altText:"Attached design from Figma",onClick:()=>{},dimensions:{width:64,height:64},isFigmake:!0};return e?a.createElement(tk.v,{...t,isUploading:!0,showTemporaryPlaceholder:!0,onDelete:e}):a.createElement(tk.M,{...t,isUploading:!0,showTemporaryPlaceholder:!0})}function tR({pastedDesignNodeId:e,loading:t,onClear:n,onClick:r,attachmentType:l}){let i=(0,Y.eY)().get(e),o=(0,tv.yh)({nodeId:i?.guid||"",width:512,height:512,shouldSkip:!i,regenerateAfterImagesLoaded:!0,reason:"figmake_pasted_design.thumbnail",version:i?.editInfo?.lastEditedAt||""});if(!o)return a.createElement(tM,null);let s=64/(o.displaySize.x/o.displaySize.y),c={thumbnailUrl:o.src,altText:"Attached design from Figma",onClick:()=>r?.(e),dimensions:{width:64,height:s},isFigmake:!0};return a.createElement("div",{style:{width:64,height:s},...x.Ay.props(tL.attachmentWrapper,n&&tL.hideChildFileIconOnHover)},n?a.createElement(tk.v,{...c,onDelete:n,isUploading:t}):a.createElement(tk.M,{...c,isUploading:t}),"FIGMA_NODE"===l&&a.createElement(tO,null))}function tO(){return a.createElement("div",{...x.Ay.props(tL.attachmentFileTypeIconWrapper)},a.createElement(tb.w4,{size:16,type:tb.y1.DESIGN}))}var tj=n(906329),tB=n(267266),tF=n(764286);let t$="https://help.figma.com/hc/articles/31722591905559-Figma-Make-FAQs",tD={chatbox:{position:"x1n2onr6",display:"x78zum5",flexDirection:"xdt5ytf",flexShrink:"x2lah0s",paddingTop:"x1iorvi4",overflow:"xb3r6kr",overflowX:null,overflowY:null,borderStyle:"x1y0btm7",borderInlineStyle:null,borderInlineStartStyle:null,borderLeftStyle:null,borderInlineEndStyle:null,borderRightStyle:null,borderBlockStyle:null,borderTopStyle:null,borderBottomStyle:null,borderWidth:"xmkeg23",borderInlineWidth:null,borderInlineStartWidth:null,borderLeftWidth:null,borderInlineEndWidth:null,borderRightWidth:null,borderBlockWidth:null,borderTopWidth:null,borderBottomWidth:null,borderColor:"x14i3s5s",borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,borderRadius:"x9h44rk",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,bottom:"x1ey2m1c",transition:"x1753ylo",transitionBehavior:null,transitionDelay:null,transitionDuration:null,transitionProperty:null,transitionTimingFunction:null,":focus-within_borderColor":"x116ztm0",":focus-within_borderInlineColor":null,":focus-within_borderInlineStartColor":null,":focus-within_borderLeftColor":null,":focus-within_borderInlineEndColor":null,":focus-within_borderRightColor":null,":focus-within_borderBlockColor":null,":focus-within_borderTopColor":null,":focus-within_borderBottomColor":null,":focus-within_boxShadow":"xhfuivf",paddingBottom:"xsag5q8",gap:"x1v2ro7d",rowGap:null,columnGap:null,$$css:!0},chatboxDraggingAttachment:{border:"x11z6oqc",borderWidth:null,borderInlineWidth:null,borderInlineStartWidth:null,borderLeftWidth:null,borderInlineEndWidth:null,borderRightWidth:null,borderBlockWidth:null,borderTopWidth:null,borderBottomWidth:null,borderStyle:null,borderInlineStyle:null,borderInlineStartStyle:null,borderLeftStyle:null,borderInlineEndStyle:null,borderRightStyle:null,borderBlockStyle:null,borderTopStyle:null,borderBottomStyle:null,borderColor:null,borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,$$css:!0},chatboxTextarea:{display:"x78zum5",flexGrow:"x1iyjqo2",resize:"xtt52l0",minHeight:"x8nclml",paddingLeft:"xnm25rq",paddingRight:"xyfqnmn",paddingInlineStart:null,paddingInlineEnd:null,paddingTop:"xz9dl7a",paddingBottom:"xsag5q8",cursor:"x1ed109x",$$css:!0},chatboxFigmakeTextarea:{fontSize:"x4z9k3i",$$css:!0},sendButton:{borderRadius:"x1xwekrv",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,height:"xlrawln",padding:"x10db7i2",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,justifyContent:"xlqzeqv",alignItems:"x6s0dn4",display:"x78zum5",flexShrink:"x2lah0s",$$css:!0},sendButtonEnabled:{backgroundColor:"xu5wzci",$$css:!0},sendButtonDisabled:{backgroundColor:"xgbcquw",$$css:!0},stopButton:{display:"x78zum5",height:"xlrawln",padding:"x11w2ro1",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,alignItems:"x6s0dn4",background:"xsqpjig",backgroundAttachment:null,backgroundClip:null,backgroundColor:null,backgroundImage:null,backgroundOrigin:null,backgroundPosition:null,backgroundPositionX:null,backgroundPositionY:null,backgroundRepeat:null,backgroundSize:null,borderRadius:"x1xwekrv",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,gap:"x195vfkc",rowGap:null,columnGap:null,$$css:!0},stopButtonText:{...ey.g.textBodyMedium,overflow:"xb3r6kr",overflowX:null,overflowY:null,whiteSpace:"xuxw1ft",color:"x1tk3asg",fontStyle:"x1j61x8r",$$css:!0},codeDrawerButton:{backgroundColor:"xjbqb8w",cursor:"x1ypdohk",$$css:!0},colorTextDanger:{color:"x172n1ly",$$css:!0},colorText:{color:"x1akne3o",$$css:!0}};function tq({children:e,dataTestId:t}){return a.createElement("div",{className:"x78zum5 xdt5ytf x2lah0s xwalrwr x7wzq59 x1ey2m1c","data-testid":t},e)}function tP(){return a.createElement(el.N,{href:"https://creativecommons.org/licenses/by/4.0/",newTab:!0},(0,k.tx)("design_systems.preset_libraries.tooltip.figma_license_link"))}function tH({communityAttributions:e,onClose:t}){if(e.length<=0||e.length>3)return null;let n=e.map(e=>a.createElement(ek.Ph,{newTab:!0,key:e.hubFileId,href:(0,ez.X$)(e.hubFileId),trusted:!0},(0,b.EJ)(e.hubFileName,30)));return a.createElement(eY,{variant:"community",onClose:t},a.createElement("div",{className:"x78zum5 x1q0g3np x17d4w8g"},a.createElement("div",{className:"x2lah0s"},a.createElement(ed.f,null)),a.createElement("div",null,1===e.length?(0,k.tx)("figmake.chat.community_attribution.attributions_one",{hubFileLink:n[0],creatorName:e[0].creatorName,licenseLink:a.createElement(tP,null)}):2===e.length?(0,k.tx)("figmake.chat.community_attribution.attributions_two",{hubFileLink1:n[0],hubFileLink2:n[1],licenseLink:a.createElement(tP,null)}):(0,k.tx)("figmake.chat.community_attribution.attributions_three",{hubFileLink1:n[0],hubFileLink2:n[1],hubFileLink3:n[2],licenseLink:a.createElement(tP,null)}))))}let tU=(0,eS.tf)(ei.$);function tG({licenseType:e,onClose:t}){let{getProvisionalAccessBanner:n,getPendingRequest:r}=(0,eO.wH)(),{text:l,shouldShowCurf:i}=n(e),{curfCtaHandler:o,curfCtaLabel:s}=(0,eO.mT)(e),c=l;return i||r(e)?.entryPoint!==eC.tc.CODE_CHAT_LIMIT||(c=(0,k.t)("fullscreen.toolbar_banner.provisional_access.code_chat")),a.createElement(eS.fu,{name:"ChatBoxProvisionalAccessBanner","data-testid":"provisional-access-banner"},a.createElement("div",{className:"xyorhqc"},a.createElement(eo.Yy,{variant:"brand",icon:null,onDismiss:t},a.createElement(es.Q,null,c),i&&a.createElement(tU,{onClick:o},s))))}function tV(){let e=(0,eR.X$)("ViewPlansButton"),t=e.unwrapOr(null)?.tier||null,n=(0,eL.q5)(),r=(0,B.Oc)(),l=n?.teamId??"",i=(0,eD.$Y)(l),o=r?ej.b.FIGMAKE_METER_LIMIT_TOAST:ej.b.LIVING_DESIGNS_METER_LIMIT_TOAST,s=(0,eT.y)(l,o);return t===eM.Ag.STARTER&&(0,g.k)().bake_starter_limit&&i?a.createElement(ev.$z,{variant:"primary",onClick:s},(0,k.tx)("figmake.meter_limit.view_plans")):null}function tW(){let{handleUpgrade:e,getIsUpgradeHandlerLoading:t}=(0,eO.wH)({entryPoint:eC.tc.CODE_CHAT_LIMIT,folderId:null}),n=(0,B.Oc)()?eM.G_.FIGMAKE:eM.G_.SITES;return t()?a.createElement(ev.$z,{variant:"primary",disabled:!0},(0,k.tx)("figmake.meter_limit.get_full_seat")):a.createElement(ev.$z,{variant:"primary",onClick:e({licenseType:n,upgradeReason:e3.i.CODE_CHAT_LIMIT,entryPoint:eC.tc.CODE_CHAT_LIMIT})},(0,k.tx)("figmake.meter_limit.get_full_seat"))}function tK(){let e=(0,B.Oc)()?eF.JT.FIGMAKE:eF.JT.LIVING_DESIGNS,{meterResetDate:t}=(0,eB.I)(e);if(!t)return null;let n=new Date(t);if(isNaN(n.getTime()))return null;let a=(0,e_.A)(n);return a.isSame((0,e_.A)(),"day")&&(a=a.add(1,"day")),a.format("MMMM D, YYYY")}function tX(){let e=tK();return e?(0,k.tx)("figmake.meter_limit.your_credits_limit_will_reset_on_upgrade_now",{resetDate:e}):null}function tY(){let e=tK();return e?(0,k.tx)("figmake.meter_limit.reached_your_current_credits_limit",{resetDate:e}):(0,k.tx)("figmake.meter_limit.primary")}function tZ(){let e=tK();return e?(0,k.tx)("figmake.meter_limit.seat_credit_limit_reached",{resetDate:e}):null}function tJ(){let e=(0,I._H)(),t=(0,eR.X$)("ChatBoxToast"),n=t.unwrapOr(null)?.tier||null,r=(0,I.Tk)(),l=(0,ew.yy)(),i=(0,p.md)(eL.Hu);if(!r||r===I.ee.DISABLE_WITHOUT_TOAST)return null;let o=function(e,t){switch(e){case I.ee.UNAVAILABLE_ON_EDU_PLANS:return{title:(0,k.tx)("figmake.view_only.unavailable_on_edu")};case I.ee.MAKE_UNAVAILABLE_ON_PLAN:return{title:(0,k.tx)("figmake.view_only.unavailable_on_plan",{learnMoreLink:a.createElement(ek.Ph,{newTab:!0,trusted:!0,href:t$},(0,k.tx)("general.learn_more"))}),icon:a.createElement(em.t,null)};case I.ee.MAKE_UNAVAILABLE_ON_SEAT:return{title:(0,k.tx)("figmake.view_only.unavailable_on_seat",{learnMoreLink:a.createElement(ek.Ph,{newTab:!0,trusted:!0,href:t$},(0,k.tx)("general.learn_more"))}),icon:a.createElement(em.t,null)};case I.ee.INTERIM_VIEW_ONLY_COMING_SOON:return{title:(0,k.tx)("figmake.view_only.coming_soon_title"),content:()=>(0,k.tx)("figmake.view_only.check_back_in_coming_weeks"),icon:a.createElement(em.t,null)};case I.ee.VIEW_ONLY_ASK_TO_EDIT:return{title:void 0,content:()=>(0,k.tx)("figmake.view_only.banner_message"),button:a.createElement(e$.RJ,{viewOnly:!0,variant:"primary"}),icon:null};case I.ee.METER_LIMIT:return{title:void 0,content:()=>a.createElement(tY,null)};case I.ee.METER_LIMIT_UPGRADE_PLAN:return{title:(0,k.tx)("figmake.meter_limit.primary"),content:()=>a.createElement(tX,null),button:a.createElement(tV,null)};case I.ee.METER_LIMIT_UPGRADE_SEAT:return{title:void 0,content:()=>a.createElement(tZ,null),button:a.createElement(tW,null),icon:null};case I.ee.PLAN_AI_DISABLED:return{title:(0,k.tx)("living_designs.chat.disabled_reason.title.not_available"),content:()=>(0,k.tx)("living_designs.chat.disabled_reason.subtitle.ai_disabled",{planName:t})};case I.ee.DISABLE_CATCH_ALL:return{title:(0,k.tx)("living_designs.chat.disabled_reason.title.not_available")};case I.ee.DISABLE_WITHOUT_TOAST:return{title:null};default:(0,er.xb)(e)}}(r,l?.name||i?.name||"");return a.createElement(eS.fu,{name:"ChatBoxToast",properties:{codeChatRestriction:r,isViewOnly:e,tier:n}},a.createElement("div",{className:"xyorhqc","data-testid":"chat-box-toast"},a.createElement(eo.Yy,{variant:"brand",icon:o.icon},a.createElement(es.Q,{title:o.title},o.content?.()),o.button)))}function tQ({attachments:e,clearAttachment:t}){return e&&e.filter(e=>"error"!==e.status).length>0?a.createElement("div",{className:"x78zum5 x1q0g3np x167g77z x1xps8ly"},e.map(e=>"error"===e.status?null:a.createElement(tz,{key:e.uniqueId,attachment:e,clearAttachment:t}))):null}function t0(){let e=function(){let e=(0,p.Xr)(e8.j),t=(0,e2.C5)();return()=>{t(e7.f0.SETTINGS),e(e6.p.SUPABASE)}}(),t=(0,p.Xr)(tj.rK);return a.createElement(eY,{variant:"error",onClose:()=>t(!1)},a.createElement("div",{className:"x78zum5 x1q0g3np x1qughib x6s0dn4 xh8yej3","data-testid":"supabase-error-banner"},a.createElement("div",{className:"x78zum5 x1q0g3np x167g77z xkh2ocl x6s0dn4"},a.createElement(ex.Z,{"aria-hidden":!0,style:{"--color-icon":"currentColor"}}),(0,k.t)("figmake.supabase_error.title")),a.createElement(ec.$n,{variant:"secondary",onClick:e},(0,k.t)("figmake.supabase_error.button"))))}function t1({chatError:e,onClose:t,onRetry:n}){let{error:r,cortexClientGeneratedRequestUuid:l}=e,{node:i,dismissable:o}=(0,e9.u1)({error:r}),s=(0,eb.b5)()?l:void 0,c=!1,u=!1;if(r.message===te.T_.ATTACHMENTS_TOO_LARGE||r.message===te.T_.MAX_CONTENT_LENGTH_EXCEEDED)u=!0;else if(r.message===te.T_.PROMPT_ENHANCEMENT_FAILED)u=!0;else if(r.message===te.T_.PROMPT_ENHANCEMENT_FAILED)u=!0;else{let e=(0,eI.sZ)(r);c=[eA.B.GENERIC,eA.B.OFFLINE,eA.B.NETWORK_ERROR].includes(e),u=[eA.B.CONTENT_LENGTH_LIMIT,eA.B.UNSAFE_OR_HARMFUL_CONTENT].includes(e)}return a.createElement(eY,{variant:u?"warning":"error",onClose:o?t:void 0},a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x1nfngrj"},a.createElement("span",{className:"xvy4d1p"},a.createElement(ex.Z,{"aria-hidden":!0,style:{"--color-icon":"currentColor"}})),a.createElement("div",{role:"alert",className:"x1iyjqo2"},i,s&&a.createElement("p",null,`Request UUID: ${s}`)),c&&n&&a.createElement(ec.$n,{variant:"secondary",onClick:n},(0,k.t)("ai.try_again"))))}function t5({onClose:e,requestFixErrors:t,errorFixingDisabled:n,isLastUserMessageAutoErrorFix:r,errorCount:l,variant:i}){let o=(0,p.Xr)(N.YD),s=(0,p.Xr)(N.Vo),c=(0,k.t)("living_designs.chat.errors.error_count",{count:l});return c="error"===i?r?l>10?(0,k.t)("figmake.errors.autofix_failed_max_errors",{maxCount:10}):(0,k.t)("figmake.errors.autofix_failed",{count:l}):l>10?(0,k.t)("figmake.errors.max_errors",{maxCount:10}):(0,k.t)("living_designs.chat.errors.error_count",{count:l}):l>10?(0,k.t)("figmake.chat.warning_message_max_errors",{maxCount:10}):(0,k.t)("figmake.chat.warning_message",{count:l}),a.createElement(eY,{variant:i,onClose:e},a.createElement(eu.E,{onClick:()=>{o(!0),s("console")},...x.Ay.props(tD.codeDrawerButton,"error"===i&&tD.colorTextDanger,"info"===i&&tD.colorText)},a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x1jnr06f"},a.createElement(ex.Z,{"aria-hidden":!0,style:{"--color-icon":"currentColor"}}),a.createElement("div",{style:{color:"currentColor"}},c))),a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x167g77z x19y5rnk x1yjdb4r"},a.createElement(ec.$n,{variant:"secondary",onClick:t,disabled:n},(0,k.t)("living_designs.chat.errors.ask_figma_fix"))))}function t7({onClose:e}){return a.createElement(eY,{variant:"info",onClose:e},a.createElement("span",{className:"x78zum5 x1q0g3np x6s0dn4 x1jnr06f"},a.createElement(eg,null),(0,k.t)("figmake.chat.autofix_message")))}function t2({state:e}){return"chatDisabled"===e.type?a.createElement(a.Fragment,null,a.createElement(tJ,null),e.showLoggedOutBanner&&a.createElement(t_,null)):"supabaseNudge"===e.type?a.createElement(e0,null):"supabaseError"===e.type?a.createElement(t0,null):"chatError"===e.type?a.createElement(t1,{chatError:e.chatError,onClose:e.onClose,onRetry:e.onRetry}):"consoleErrors"===e.type?a.createElement(t5,{onClose:e.onClose,requestFixErrors:e.requestFixErrors,errorFixingDisabled:e.errorFixingDisabled,isLastUserMessageAutoErrorFix:e.isLastUserMessageAutoErrorFix,errorCount:e.errorCount,variant:e.variant}):"selfHealing"===e.type?a.createElement(t7,{onClose:e.onClose}):"communityAttribution"===e.type?a.createElement(tH,{communityAttributions:e.communityAttributions,onClose:e.onClose}):"provisionalAccess"===e.type?a.createElement(tG,{licenseType:e.licenseType,onClose:e.onClose}):null}let t8=a.forwardRef((e,t)=>{let{placeholderText:n,canSend:r,sendMessage:l,chatBoxExtraContent:i,inspectedElement:o,errorFixingDisabled:s,showPasteDesignsCallout:c,generationInProgress:u,chatMessagesNodeGuid:d,canCancelGeneration:m,chatContainerRef:x,isDraggingAttachment:h,chatMessageCount:f,isLastUserMessageAutoErrorFix:y}=e,[E,_]=(0,p.fp)((0,A.mC)(d)),{chatError:v,clearChatError:C}=(0,te.tk)(d),[S,w]=(0,eq.jT)(),[T]=(0,e5.PM)(),N=S.filter(e=>"error"===e.type||"warn"===e.type),L=(0,K.ZC)(N),z=a.useMemo(()=>N.every(e=>"warn"===e.type)&&0===T.length,[N,T]),M=(0,K.ZC)(f),[R,O]=(0,a.useState)(!1),j=r&&!(0,b.jN)(E),F=function(e){let[t,n]=a.useState(!1),r=a.useRef(null);return a.useEffect(()=>(r.current&&clearTimeout(r.current),n(e.length>0),r.current=setTimeout(()=>{n(!1)},1e4),()=>{r.current&&clearTimeout(r.current)}),[e]),t}(E);a.useEffect(()=>{let e=(0,A.A5)(d);e?e.isTyping!==F&&(0,A.YZ)({...e,isTyping:F}):d&&(0,A.YZ)({node:d,isTyping:F,messages:[],fileUpdates:[]})},[F,d]),a.useEffect(()=>{(L?.length!==N.length||M!==f)&&O(!1)},[L,N,M,f]);let[$,D]=(0,p.fp)((0,e4.o0)(d)),[q,P]=(0,a.useState)(300),[H,U]=(0,a.useState)(0),{communityAttributionDisplay:G,clearCommunityAttributionDisplay:W}=(0,V.Pe)();(0,a.useEffect)(()=>{if(!x?.current)return;let e=()=>{P(Math.max(64,.4*(x.current?.clientHeight||300)))},t=()=>{U(x.current?.clientWidth??0)},n=()=>{e(),t()};n(),new ResizeObserver(n).observe(x.current)},[x]);let X=a.useRef(void 0),Y=(0,a.useCallback)(()=>{if(t&&"current"in t&&t.current){let e=t.current;e.style.height="auto";let n=window.getComputedStyle(e),a=parseFloat(n.paddingTop),r=parseFloat(n.paddingBottom),l=(parseFloat(n.lineHeight)-parseFloat(n.fontSize))/2,i=Math.min(e.scrollHeight-a-r-l-l,q);i!==X.current&&(X.current=i),e.style.height=`${i}px`,e.style.overflowY=i>=q?"auto":"hidden"}},[q,t]);(0,a.useEffect)(()=>{Y()},[q,E,Y,H]);let Z=(0,I.ry)(),J=(0,eN.k)(),Q=(0,B.Oc)(),ee=Q?eM.G_.FIGMAKE:eM.G_.SITES,et=(0,eP.Xu)(),en=(0,p.md)(tj.Xl),{connectedProject:ea,isConnectedNonOwner:er}=(0,eJ.GC)(),el=(0,eJ.Iz)(),{showProvisionalAccessBanner:ei,onCloseProvisionalAccessBanner:eo}=function(e){let{getProvisionalAccessBanner:t}=(0,eO.wH)(),n=t(e),[r,l]=(0,a.useState)(!0);return{showProvisionalAccessBanner:n?.showBanner&&r,onCloseProvisionalAccessBanner:()=>{l(!1)}}}(ee),es={type:"normal"};return Z?es={type:"chatDisabled",showLoggedOutBanner:Q&&J}:et&&en&&(ea||er)?es={type:"supabaseNudge"}:et&&el?es={type:"supabaseError"}:v?es={type:"chatError",chatError:v,onClose:C,onRetry:()=>l({})}:(N.length>0||et&&T.length>0)&&!R?$?es={type:"selfHealing",onClose:()=>O(!0)}:u||(es={type:"consoleErrors",onClose:()=>O(!0),requestFixErrors:function(){D(!0);let e=Array.from(new Set([...N.map(e=>e.message)??[],...T.map(e=>e.event_message)]));l({message:z?(0,k.t)("figmake.chat.warning_fix_message"):(0,k.t)("living_designs.chat.errors.fix_these_errors"),errors:e}),w([])},errorFixingDisabled:s,isLastUserMessageAutoErrorFix:!!y,errorCount:N.length+T.length,variant:z?"info":"error"}):G&&G.length>0?es={type:"communityAttribution",communityAttributions:G,onClose:W}:(0,g.k)().bake_monetization_plan&&Q&&ei&&(es={type:"provisionalAccess",licenseType:ee,onClose:eo}),a.createElement("form",{onSubmit:e=>{e.preventDefault(),j&&l({})}},a.createElement(tq,null,a.createElement(t2,{state:es}),a.createElement(t6,{canCancelGeneration:m,canSend:j,chatBoxExtraContent:i,chatMessagesNodeGuid:d,generationInProgress:u,initialTextareaHeight:X.current,input:E,inspectedElement:o,isDraggingAttachment:h,maxTextareaHeight:q,placeholderText:n,sendMessage:l,setInput:_,showPasteDesignsCallout:c,textareaRef:t,updateTextareaHeight:Y})))});function t6({chatMessagesNodeGuid:e,generationInProgress:t,canSend:n,canCancelGeneration:r,sendMessage:l,input:i,setInput:o,updateTextareaHeight:s,inspectedElement:c,isDraggingAttachment:u,showPasteDesignsCallout:d,textareaRef:g,initialTextareaHeight:y,maxTextareaHeight:E,placeholderText:_,chatBoxExtraContent:v}){let C=(0,B.Oc)(),S=(0,p.md)(N.f3),w=(0,a.useCallback)(e=>{let t=e.target;s(),o(t.value)},[o,s]),T=p.zl.get((0,A.Z3)(e)),L=(0,I.ry)(),{attachments:z,clearAttachment:M}=(0,G._9)(e),R=C?(0,tB.W)():null,O=L?"var(--color-bg-secondary)":"var(--color-bg)";return a.createElement("div",{...x.Ay.props(tD.chatbox,u&&tD.chatboxDraggingAttachment),style:{backgroundColor:O}},a.createElement("div",{className:"x78zum5 xdt5ytf x1iyjqo2 xs83m0k x1r8uery",style:{backgroundColor:O}},d&&a.createElement(t3,null),a.createElement(tQ,{attachments:z,clearAttachment:M}),c?a.createElement(tc,{tagName:c.tagName,variant:"prompt"}):null,a.createElement("textarea",{ref:g,...x.Ay.props(tD.chatboxTextarea,C&&tD.chatboxFigmakeTextarea),"data-testid":"code-chat-chat-box",disabled:L,maxLength:5e5,onChange:w,onFocus:e=>{let t=e.target.value.length;e.target.setSelectionRange(t,t)},onKeyDown:e=>{e.stopPropagation(),"Enter"===e.key&&!e.shiftKey&&!e.nativeEvent.isComposing&&(e.preventDefault(),n&&(l({}),(c||S?.directManipulationEditor.directManipulationEnabled())&&S?.setDirectManipulationEnabled(!1)))},onPaste:function(e){if(C)try{let t=(e.clipboardData||window.clipboardData).getData("Text");(function(e){let t=e.match(/(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:\/~+#-]*[\w@?^=%&\/~+#-])/g);return!!(t&&[...t].findIndex(e=>(function(e){if((0,b.gU)(e)){let t=new URL(e);if((0,tF.F4)(t.hostname))return!0}return!1})(e))>-1)})(t)&&(0,G.hH)(m.FDn.USER_PASTED_FIGMA_LINK_IN_CHAT)}catch{}},placeholder:_,style:{backgroundColor:O,height:y?`${y}px`:"auto",overflowY:y&&y>=E?"auto":"hidden"},value:i})),a.createElement("div",{className:"x78zum5 x1q0g3np x1qughib x6s0dn4 x84vhe8"},v,a.createElement("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0}},a.createElement("div",{className:"x78zum5 xb3r6kr xlyipyv xuxw1ft xeuugli xs83m0k x1n0bwc9 x1d4th4m"},R),a.createElement("div",{style:{flexShrink:0}},(()=>{let e=(0,eE.A)(.19,1,.22,1);return a.createElement("div",{className:"x78zum5 x6s0dn4 xl56j7k x11umrmk"},a.createElement(f.P.button,{onClick:()=>{t?T&&T.abort():(l({}),(c||S?.directManipulationEditor.directManipulationEnabled())&&S?.setDirectManipulationEnabled(!1))},disabled:t?!r:!n,...x.Ay.props(t?tD.stopButton:tD.sendButton,!t&&n&&tD.sendButtonEnabled,!t&&!n&&tD.sendButtonDisabled),variants:{play:{width:"25px",transition:{duration:.3,ease:e}},stop:{width:"63px",transition:{duration:.3,ease:e}}},initial:"play",animate:t?"stop":"play","aria-label":t?(0,k.t)("living_designs.chat.stop_button.alt_text"):(0,k.t)("living_designs.chat.send_button.alt_text"),"data-testid":t?"code-chat-stop-button":"code-chat-send-button"},a.createElement(f.P.div,{className:"x1n2onr6 x78zum5 x6s0dn4 xl56j7k xvy4d1p xxk0z11",variants:{play:{x:0,transition:{duration:.3,ease:e}},stop:{x:0,transition:{duration:.3,ease:e}}},animate:t?"stop":"play"},a.createElement(h.N,{mode:"wait"},t?a.createElement(f.P.div,{key:"square",className:"absolute",animate:{opacity:1,scale:1,rotate:0},exit:{opacity:0,scale:0,rotate:-45},initial:{opacity:0,scale:0,rotate:100},transition:{duration:.3,ease:e}},a.createElement(eh.d,{className:"xwa2v1s xvy4d1p xxk0z11 x2lah0s"})):a.createElement(f.P.div,{key:"arrow",className:"absolute",animate:{opacity:1,scale:1,rotate:0},exit:{opacity:0,scale:0,rotate:45},initial:{opacity:0,scale:0,rotate:-45},transition:{duration:.25,ease:e}},a.createElement(ep.W,{className:"xwa2v1s xvy4d1p xxk0z11 x2lah0s"})))),a.createElement(h.N,null,t&&a.createElement(f.P.span,{...x.Ay.props(tD.stopButtonText),initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},transition:{opacity:{duration:.25,ease:e},width:{duration:.25,ease:e}}},(0,k.t)("living_designs.chat.stop_button")))))})()))))}function t3(){return a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x1nejdyq x1ruevkc x1opjl2c xxs4gfe x1sxf85j"},a.createElement(t4,null),a.createElement("div",{className:"x1nmd3yn xm735u9 xkbmbem xqp8s7e xv1l7n4 xvwc6ox x1j61x8r"},(0,k.t)("figmake.chat.paste_existing_design_callout")))}function t4(){return a.createElement("svg",{width:"22",height:"27",viewBox:"0 0 22 27"},a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.3438 5.59766H18.8389V20.5352H16.2041V22.7998H5.85938V20.3682H3.1377V5.79492H5.7168V3.06641H16.3438V5.59766ZM7.83398 9.25586C7.691 9.24173 7.55088 9.29393 7.44922 9.39551L7.39355 9.45117C7.29203 9.55285 7.23973 9.69297 7.25391 9.83594C7.34716 10.7618 7.7613 14.2858 8.74023 15.2656C9.40363 15.9289 10.4407 16.2157 11.4219 16.1045L12.167 16.8545C12.5491 17.2397 13.171 17.241 13.5547 16.8574L14.834 15.5781C15.2154 15.1967 15.2167 14.5783 14.8369 14.1953L14.0986 13.4512C14.2185 12.4619 13.9322 11.4128 13.2627 10.7432C12.283 9.76425 8.76013 9.34913 7.83398 9.25586Z",fill:ef.Tj.bgSelected}),a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.2261 0.0282208C5.71996 0.0785065 6.10527 0.495932 6.10527 1.00306V2.22185H15.9015V1.00306C15.9015 0.495932 16.2868 0.0785065 16.7807 0.0282208L16.8811 0.0234375H20.7996L20.9001 0.0282208C21.3939 0.0785065 21.7792 0.495932 21.7792 1.00306V4.92155L21.7745 5.022C21.7275 5.48284 21.3609 5.84947 20.9001 5.89639L20.7996 5.90117H19.8238V20.1057H20.7996L20.9001 20.1105C21.3939 20.1608 21.7792 20.5782 21.7792 21.0853V25.0038L21.7745 25.1043C21.7275 25.5651 21.3609 25.9317 20.9001 25.9787L20.7996 25.9834H16.8811L16.7807 25.9787C16.3198 25.9317 15.9532 25.5651 15.9063 25.1043L15.9015 25.0038V23.7869H6.10527V25.0038L6.10049 25.1043C6.05357 25.5651 5.68694 25.9317 5.2261 25.9787L5.12565 25.9834H1.20716L1.10671 25.9787C0.645871 25.9317 0.279246 25.5651 0.232322 25.1043L0.227539 25.0038V21.0853C0.227539 20.5782 0.612855 20.1608 1.10671 20.1105L1.20716 20.1057H2.19444V5.90117H1.20716L1.10671 5.89639C0.645871 5.84947 0.279246 5.48284 0.232322 5.022L0.227539 4.92155V1.00306C0.227539 0.495932 0.612855 0.0785065 1.10671 0.0282208L1.20716 0.0234375H5.12565L5.2261 0.0282208ZM1.20716 25.0038H5.12565V21.0853H1.20716V25.0038ZM16.8811 25.0038H20.7996V21.0853H16.8811V25.0038ZM6.10527 3.20147V4.92155L6.10049 5.022C6.05357 5.48284 5.68694 5.84947 5.2261 5.89639L5.12565 5.90117H3.17406V20.1057H5.12565L5.2261 20.1105C5.71996 20.1608 6.10527 20.5782 6.10527 21.0853V22.8073H15.9015V21.0853C15.9015 20.5782 16.2868 20.1608 16.7807 20.1105L16.8811 20.1057H18.8442V5.90117H16.8811L16.7807 5.89639C16.3198 5.84947 15.9532 5.48284 15.9063 5.022L15.9015 4.92155V3.20147H6.10527ZM1.20716 4.92155H5.12565V1.00306H1.20716V4.92155ZM16.8811 4.92155H20.7996V1.00306H16.8811V4.92155Z",fill:ef.Tj.iconBrand}),a.createElement("path",{d:"M7.39116 8.45953C7.62267 8.28138 7.92476 8.21392 8.21343 8.28179L12.0259 9.17828V9.17926L12.2076 9.22613C13.9005 9.71089 15.0432 11.2703 15.0259 13.0045L15.4644 13.4429C15.8466 13.8255 15.8467 14.4452 15.4644 14.8277L12.8267 17.4654C12.4442 17.8478 11.8245 17.8476 11.4419 17.4654L11.0035 17.0269C9.26918 17.0443 7.70984 15.9015 7.22514 14.2086L7.17827 14.0269H7.17729L6.28081 10.2144C6.20316 9.88421 6.30267 9.53728 6.54253 9.29742L7.29643 8.54351L7.39116 8.45953ZM7.95952 9.26519L10.1744 11.481C10.4208 11.3465 10.703 11.2691 11.0035 11.2691L11.1802 11.2779C12.0543 11.3666 12.7369 12.105 12.7369 13.0025C12.7367 13.9595 11.9605 14.7357 11.0035 14.7359C10.106 14.7358 9.36756 14.0533 9.27885 13.1793L9.27007 13.0025L9.27885 12.8248C9.30267 12.5907 9.37346 12.3705 9.481 12.1734L7.26616 9.95855L7.23491 9.9898L8.13139 13.8023C8.4771 15.2707 9.88699 16.2325 11.3804 16.0191L12.1343 16.773L14.772 14.1353L14.0181 13.3814C14.2314 11.888 13.2696 10.4781 11.8013 10.1324L7.98882 9.2359L7.95952 9.26519ZM11.0035 12.2486C10.5873 12.2487 10.2496 12.5863 10.2496 13.0025C10.2497 13.3926 10.5464 13.7139 10.9263 13.7525L11.0035 13.7564C11.3934 13.7562 11.7147 13.4594 11.7535 13.0796L11.7574 13.0025C11.7574 12.5863 11.4196 12.2488 11.0035 12.2486Z",fill:ef.Tj.iconBrand}))}var t9=n(494604),ne=n(697587);function nt({showAiBetaBadge:e}){return a.createElement("div",{className:"xh8yej3 x78zum5 x87ps6o"},a.createElement(t9.Wv,{titleTx:(0,k.tx)("living_designs.chat.default_title")},e?a.createElement(ne.y,{helpUrlVariant:eF.JT.CODE_CHAT}):null))}var nn=n(176677),na=n(909678),nr=n(959498),nl=n(238462),ni=n(755534),no=n(125761),ns=n(254028);let nc={defaultTypography:{lineHeight:"xno9bf3",fontSize:"x17akokd",fontWeight:"x1yuz8eb",letterSpacing:"xqp8s7e",$$css:!0},figmakeTypography:{lineHeight:"x1fc57z9",fontSize:"x1lh6uom",fontWeight:"x1yuz8eb",letterSpacing:"xuf8qxk",$$css:!0},userMessageTypography:{lineHeight:"xno9bf3",fontSize:"x17akokd",fontWeight:"x1yuz8eb",letterSpacing:"xqp8s7e",$$css:!0},figmakeUserMessageTypography:{lineHeight:"x17fgdl5",fontSize:"x1lh6uom",fontWeight:"x1yuz8eb",letterSpacing:"xuf8qxk",$$css:!0},artifactTypography:{color:"x1n0bwc9",lineHeight:"xno9bf3",fontSize:"x17akokd",fontWeight:"x1yuz8eb",letterSpacing:"xqp8s7e",$$css:!0},figmakeArtifactTypography:{color:"x1n0bwc9",lineHeight:"x1o2sk6j",fontSize:"x1lh6uom",fontWeight:"x1yuz8eb",letterSpacing:"xuf8qxk",$$css:!0},artifactActiveTypography:{color:"x1ptu4o3",lineHeight:"x14kxzw3",fontSize:"xiqqdae",fontWeight:"x6xwguf",letterSpacing:"xqp8s7e",$$css:!0},figmakeArtifactActiveTypography:{color:"x1ptu4o3",lineHeight:"x1o2sk6j",fontSize:"x1lh6uom",fontWeight:"x6xwguf",letterSpacing:"xr8fz4w",$$css:!0}};function nu(){let e=(0,ns.Oc)(),t=e?nc.figmakeUserMessageTypography:nc.userMessageTypography,n=e?nc.figmakeArtifactTypography:nc.artifactTypography;return{userMessageTypographyStyle:t,artifactActiveTypographyStyle:e?nc.figmakeArtifactActiveTypography:nc.artifactActiveTypography,artifactTypographyStyle:n,defaultTypographyStyle:e?nc.figmakeTypography:nc.defaultTypography}}let nd={messageContent:{display:"x78zum5",borderRadius:"xgqmno8",padding:"x1r1m0to",backgroundColor:"x1v8gsql",userSelect:"x1hx0egp",whiteSpace:"x126k92a",wordBreak:"x13faqbe",cursor:"x1ed109x",$$css:!0}};function nm({message:e,user:t}){(0,er.vA)(e.type===m.K$p.USER_MESSAGE,"Message must be a user message");let{userMessageTypographyStyle:n}=nu(),r=(0,na.H5)(e.textContent||""),l=(0,a.useMemo)(()=>"imports"in r&&r.imports?r.imports:[],[r]),o=(0,a.useMemo)(()=>"inspectedElement"in r&&r.inspectedElement?r.inspectedElement:null,[r]),s=r.plainText.trim(),c=tI(),u=e=>{c(e)};return a.createElement("div",{className:"x1eaahee"},a.createElement("div",{className:"x78zum5 x1q0g3np x167g77z x13a6bvl"},a.createElement("div",{className:"x78zum5 xdt5ytf x167g77z xuk3077"},o&&o.tagName?a.createElement(tc,{variant:"chat",tagName:o.tagName}):null,l.length>0?a.createElement("div",{className:"x78zum5 x1q0g3np x167g77z x1a02dak x13a6bvl"},l.map(e=>a.createElement(tR,{key:e.guid,pastedDesignNodeId:e.guid,onClick:()=>u(e.guid),attachmentType:(0,G.yM)(e)}))):null,a.createElement("div",{...x.Ay.props(nd.messageContent,n)},s)),a.createElement("div",{className:"xpvyfi4 x1ty9z65"},a.createElement(i.K,{"aria-label":t.name??t.handle,disabled:!0},a.createElement(eV.H8,{user:t})))))}var nx=n(399879);let ng={default:{duration:1,ease:"linear",repeat:1/0},rotate:{duration:2,ease:[.6,-1,.4,2],repeat:1/0}};function np(){return a.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},a.createElement(f.P.ellipse,{animate:{ry:[2.5,0,2.5],strokeDashoffset:[-10,10],rotate:[0,45,90]},cx:"12",cy:"12",fill:"transparent",initial:{strokeDashoffset:-10,ry:2.5,rotate:0},rx:"8.5",ry:"2.5",stroke:"var(--color-icon)",strokeDasharray:"14 5",strokeDashoffset:"-10",strokeLinecap:"round",strokeWidth:"1",transition:ng}),a.createElement(f.P.ellipse,{animate:{ry:[2.5,0,2.5],strokeDashoffset:[-10,10],rotate:[-90,-45,0]},cx:"12",cy:"12",fill:"transparent",initial:{strokeDashoffset:-8,ry:4,rotate:-45},rx:"8.5",ry:"2.5",stroke:"var(--color-icon)",strokeDasharray:"14 5",strokeDashoffset:"-10",strokeLinecap:"round",strokeWidth:"1",transition:ng}))}var nh=n(56629),nf=n(889899);let ny=(0,a.memo)(({children:e,duration:t=2,baseColor:n="#a1a1aa",shimmerColor:r="#000",spread:l=2,as:i="p"})=>{let o=(0,a.useMemo)(()=>Math.min(e.length*l,100),[e,l]),s=`linear-gradient(
        90deg,
        transparent calc(50% - ${o}px),
        ${r} 50%,
        transparent calc(50% + ${o}px)
      ),
      linear-gradient(${n}, ${n})`,c=(0,f.P)(i);return a.createElement(c,{className:"shimmer_text--container--n0FBj",style:{backgroundImage:s,width:"fit-content"},initial:{backgroundPosition:"100% center"},animate:{backgroundPosition:"0% center"},transition:{duration:t,repeat:1/0,ease:"linear"}},e)});var nE=n(198629),n_=n(404655);function nb(){return a.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},a.createElement("path",{d:"M18 12C18 15.3137 15.3137 18 12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C15.3137 6 18 8.68629 18 12Z",fill:"#14AE5C"}),a.createElement("path",{d:"M17 12C17 14.7614 14.7614 17 12 17C9.23858 17 7 14.7614 7 12C7 9.23858 9.23858 7 12 7C14.7614 7 17 9.23858 17 12Z",stroke:"white",strokeOpacity:"0.6",strokeWidth:"2"}))}let nv={artifactContainer:{display:"x78zum5",borderColor:"x7z60cl",borderRadius:"x9h44rk",borderWidth:"xmkeg23",borderStyle:"x1y0btm7",padding:"x153ncpu",lineHeight:"x1o2sk6j",$$css:!0},inProgress:{color:"x1akne3o",$$css:!0}};function nk({toolCall:e}){return a.createElement(nC,{icon:"view_tool"===e.toolName?a.createElement(nh._,null):null,text:"view_tool"===e.toolName?(0,k.t)("figmake.tool_call.viewing",{file:e.partialArgs.path}):(0,k.t)("figmake.chat.working")})}function nC({text:e,icon:t}){return a.createElement("div",{className:"x78zum5 x1n0bwc9 x193iq5w x1q0g3np x6s0dn4"},a.createElement("div",{className:"x78zum5 x2lah0s"},t),a.createElement("span",{className:"x78zum5 x1iog12x x12lumcd xb3r6kr xlyipyv xuxw1ft"},a.createElement(ny,null,e??"")))}function nS({children:e,isInProgress:t,isCurrentVersion:n}){let{artifactTypographyStyle:r,artifactActiveTypographyStyle:l}=nu();return a.createElement("div",{...x.Ay.props(nv.artifactContainer,n?l:r,t?nv.inProgress:void 0)},e)}function nw(e){let{chatMessagesNodeGuid:t,layerDisplayName:n,type:r}=e,l=(0,p.md)((0,n_.l)(t)),{exchange:s}=(0,A.$W)(t),c=(0,B.Oc)(),u="progress"===e.type&&e.showCodeStreaming&&s?function(e){let t;if(e&&e.messages.length>0){let n=e?.messages[e.messages.length-1],a=(0,na.H5)(n?.textContent||""),r=e.fileUpdates[e.fileUpdates.length-1];a.code?t=a.code:r&&(t=r.contents)}return t}(s):void 0;(0,a.useEffect)(()=>{u&&"progress"===e.type&&e.scrollToBottom()},[u,e]);let d="version"===r&&e.isCurrentVersion,m="version"===r?e.versionNumber:0,x="version"===r?e.versionTitle:void 0,y="version"===r?e.restoreVersion:void 0,E=(0,g.k)().bake_version_titles&&c,_=a.useMemo(()=>"progress"===r?null:"version"===r?E&&x?a.createElement("div",{className:"x78zum5 xdt5ytf"},a.createElement("div",{className:"x6xwguf"},x),a.createElement("div",{className:"x1yuz8eb"},(0,k.t)("figmake.chat.artifact.version",{version:m}))):d?(0,k.t)("figmake.chat.artifact.latest_version"):(0,k.t)("figmake.chat.artifact.version",{version:m}):null,[r,d,x,m,E]),b=null;b=l?.type==="toolCall"?a.createElement(nk,{toolCall:l}):l?.type==="code"?a.createElement(nC,{icon:a.createElement(nf.A,null),text:(0,k.t)("figmake.tool_call.writing",{file:n??l.fullFilePath})}):l?.type==="editedFiles"?a.createElement(nC,{icon:a.createElement(nf.A,null),text:(0,k.t)("figmake.tool_call.editing",{file:l.files.join(", ")})}):a.createElement("div",{className:"x78zum5 x1q0g3np x1n0bwc9 x193iq5w x6s0dn4"},a.createElement(ny,null,(0,k.t)("figmake.chat.working")));let v=(0,n_.N)(l),C="progress"===r?null:y?a.createElement(i.K,{"aria-label":(0,k.t)("figmake.chat.artifact.restore"),onClick:y},a.createElement(o.H,null)):null,S="progress"===r?a.createElement(tC.k,null):d?a.createElement(nb,null):C;return a.createElement(nS,{isInProgress:"progress"===r,isCurrentVersion:d},a.createElement("div",{className:"x78zum5 xdt5ytf xh8yej3"},a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x1qughib xh8yej3"},a.createElement("div",{className:"x78zum5 x845mor xb3r6kr xlyipyv xuxw1ft xeuugli",title:v??""},"progress"===r?b:_),a.createElement("div",{className:"x78zum5 x6s0dn4 xet2fuk x2lah0s"},S)),a.createElement(h.N,null,!!u&&a.createElement(f.P.div,{initial:{height:0,opacity:0},animate:{height:128,opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"x78zum5 x1n2onr6 x47corl xdt5ytf x1cy8zhl xh8yej3 xb3r6kr"},a.createElement(f.P.div,{className:"x10l6tqk x13vifvy xu96u03 x3m8u43 x1vqgdyp x1vjfegm xu4a7ya"}),a.createElement(nE.O,{code:u,fileName:n??"",fullHeight:!0,maxHeight:"128px",onlyShowCode:!0})))))}var nT=(e=>(e.PENDING="pending",e.SUCCESS="success",e.FAILURE="failure",e))(nT||{}),nN=(e=>(e.TOOL_CALL_SUCCESS="tool_call_success",e.TOOL_CALL_CANCELLED="tool_call_cancelled",e.TOOL_CALL_DISABLED="tool_call_disabled",e))(nN||{}),nA=n(947970),nI=n(720522);function nL({header:e,body:t}){return a.createElement("div",{className:"x78zum5 xdt5ytf xkh2ocl"},a.createElement("div",{className:"x78zum5 xkh2ocl x14pk0dq"},e),t&&a.createElement(a.Fragment,null,a.createElement(eZ.cG,null),a.createElement("div",{className:"x78zum5 xkh2ocl x14pk0dq"},t)))}var nz=n(57679),nM=n(887437),nR=n(338538),nO=n(139356),nj=n(749233);function nB({text:e}){return a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x167g77z xkh2ocl"},a.createElement("div",{className:"xvvfnsg"},a.createElement(nO.r,null)),a.createElement("div",{...x.Ay.props(nP.textBodyLargeStrong)},e))}function nF({title:e,subtitle:t,interaction:n}){return a.createElement(nq,{icon:a.createElement(tC.k,{size:"md"}),title:e,subtitle:t,interaction:n})}function n$({title:e,subtitle:t,interaction:n}){return a.createElement(nq,{icon:a.createElement(nj.w,null),title:e,subtitle:t,interaction:n})}function nD({title:e,subtitle:t,interaction:n}){return a.createElement(nq,{icon:a.createElement("div",{className:"x15edyk6"},a.createElement(ex.Z,null)),title:e,subtitle:t,interaction:n})}function nq({icon:e,title:t,subtitle:n,interaction:r}){return a.createElement("div",{className:"x78zum5 x1q0g3np x167g77z xwib8y2 xkh2ocl"},a.createElement("div",{className:"x78zum5 x1cy8zhl xkh2ocl"},e),a.createElement("div",{className:"x78zum5 xdt5ytf x1cy8zhl x167g77z xkh2ocl"},a.createElement("div",{className:"x78zum5 xdt5ytf x1cy8zhl xdpxx8g"},a.createElement("div",{...x.Ay.props(nP.textBodyLargeStrong)},t),a.createElement("div",{...x.Ay.props(nP.textBodyLargeSecondary)},n)),r))}let nP={textBodyLargeStrong:{...ey.g.textBodyLargeStrong,$$css:!0},textBodyLargeSecondary:{...ey.g.textBodyLarge,color:"x1n0bwc9",$$css:!0}};function nH({dismissSupabase:e,trackingContext:t}){let n=(0,eJ.wT)(),r=(0,eL.tS)()||"",l=a.useCallback(()=>{(0,nM.oU)({persistentEntityId:t.persistentEntityId,clientLifecycleId:t.clientLifecycleId},"toolCta",r),n()},[n,t.persistentEntityId,t.clientLifecycleId,r]);return a.createElement(n$,{title:(0,k.t)("figmake.supabase.cta.list.account_connected"),subtitle:(0,k.t)("figmake.supabase.cta.auth.body_text"),interaction:a.createElement("div",{className:"x78zum5 x167g77z"},a.createElement(ec.WW,{variant:"primary",onClick:l},(0,k.t)("figmake.supabase.connect")),a.createElement(ec.WW,{variant:"secondary",onClick:()=>e()},(0,k.t)("figmake.supabase.cancel")))})}var nU=n(68097);function nG({toolCallId:e,toolName:t,dismissSupabase:n,trackingContext:l}){let{organization:i}=(0,eJ.mS)(),o=(0,r.wA)();return a.createElement("div",{className:"x78zum5 xdt5ytf x167g77z xkh2ocl"},a.createElement(nB,{text:(0,k.t)("figmake.supabase.cta.list.account_connected")}),a.createElement(nB,{text:(0,k.t)("figmake.supabase.cta.list.org_connected",{org:i?.name??""})}),a.createElement(n$,{title:(0,k.t)("figmake.supabase.cta.connect_to_existing_projects.title"),subtitle:(0,k.t)("figmake.supabase.cta.connect_to_existing_projects.subtitle"),interaction:a.createElement("div",{className:"x78zum5 x167g77z"},a.createElement(ec.WW,{variant:"primary",onClick:()=>{o((0,C.to)({type:nU.Z,data:{toolCallId:e,toolName:t,trackingContext:l,source:"toolCta"},showModalsBeneath:!0}))}},(0,k.t)("figmake.supabase.cta.connect_to_existing_projects.button")),a.createElement(ec.WW,{variant:"secondary",onClick:()=>n()},(0,k.t)("figmake.supabase.cancel")))}))}function nV(){let{organization:e}=(0,eJ.mS)(),{connectedProject:t}=(0,eJ.GC)(),n=t?.name??"";return a.createElement("div",{className:"x78zum5 xdt5ytf x167g77z xkh2ocl"},a.createElement(nB,{text:(0,k.t)("figmake.supabase.cta.list.account_connected")}),a.createElement(nB,{text:(0,k.t)("figmake.supabase.cta.list.org_connected",{org:e?.name??""})}),a.createElement(nB,{text:(0,k.t)("figmake.supabase.cta.list.project_connected",{project:n})}))}function nW(){let{organization:e}=(0,eJ.mS)(),t=(0,p.md)(nR.Kj);if(!t||"connecting"!==t.state)return null;let n=t.project.name??"";return a.createElement("div",{className:"x78zum5 xdt5ytf x167g77z xkh2ocl"},a.createElement(nB,{text:(0,k.t)("figmake.supabase.cta.list.account_connected")}),a.createElement(nB,{text:(0,k.t)("figmake.supabase.cta.list.org_connected",{org:e?.name??""})}),a.createElement(nF,{title:(0,k.t)("figmake.supabase.cta.list.project_connecting",{project:n}),subtitle:(0,k.t)("figmake.supabase.cta.list.project_connecting.subtitle")}))}var nK=n(78926);function nX({toolCallId:e,toolName:t,dismissSupabase:n,trackingContext:l}){let{organization:i}=(0,eJ.mS)(),o=(0,r.wA)();return a.createElement("div",{className:"x78zum5 xdt5ytf x167g77z xkh2ocl"},a.createElement(nB,{text:(0,k.t)("figmake.supabase.cta.list.account_connected")}),a.createElement(nB,{text:(0,k.t)("figmake.supabase.cta.list.org_connected",{org:i?.name??""})}),a.createElement(n$,{title:(0,k.t)("figmake.supabase.cta.create_project.title"),subtitle:(0,k.t)("figmake.supabase.cta.create_project.subtitle"),interaction:a.createElement("div",{className:"x78zum5 x167g77z"},a.createElement(ec.WW,{variant:"primary",onClick:()=>{o((0,C.to)({type:nK.AP,data:{toolCallId:e,toolName:t,trackingContext:l,source:"toolCta"},showModalsBeneath:!0}))}},(0,k.t)("figmake.supabase.cta.create_project.button")),a.createElement(ec.WW,{variant:"secondary",onClick:()=>n()},(0,k.t)("figmake.supabase.cancel")))}))}function nY(){return a.createElement("div",{className:"x78zum5 xdt5ytf x167g77z xkh2ocl xl56j7k x6s0dn4 x1tamke2 xh8yej3"},a.createElement(tC.k,null))}function nZ({toolCallId:e,toolName:t,dismissSupabase:n,trackingContext:r}){let{authenticated:l,connectedProject:i,existingProjects:o,isLoading:s}=(0,eJ.zA)(),c=(0,p.Xr)(tj.hR),u=(0,p.md)(nR.Kj);return(0,a.useEffect)(()=>{if(s){c(tj.s8.LOADING);return}if(u&&"connecting"===u.state){c(tj.s8.CONNECTING_TO_PROJECT);return}i?c(tj.s8.CONNECTED_PROJECT):l&&o.length?c(tj.s8.CONNECT_TO_EXISTING_PROJECTS):l?c(tj.s8.CREATE_PROJECT):c(tj.s8.AUTH)},[s,i,o,l,c,u]),a.createElement(nJ,{toolCallId:e,toolName:t,dismissSupabase:n,trackingContext:r})}function nJ({toolCallId:e,toolName:t,dismissSupabase:n,trackingContext:r}){let l=(0,p.md)(tj.hR),i=(0,eL.tS)()||"",o=a.useRef(!1);switch(a.useEffect(()=>{if(o.current)return;let e=(0,nM.oR)({persistentEntityId:r.persistentEntityId,clientLifecycleId:r.clientLifecycleId},"toolCta",l,i);o.current=e},[l,r.persistentEntityId,r.clientLifecycleId,i]),l){case tj.s8.AUTH:return a.createElement(nH,{dismissSupabase:n,trackingContext:r});case tj.s8.CONNECTING_TO_PROJECT:return a.createElement(nW,null);case tj.s8.CONNECT_TO_EXISTING_PROJECTS:return a.createElement(nG,{toolCallId:e,toolName:t,dismissSupabase:n,trackingContext:r});case tj.s8.CREATE_PROJECT:return a.createElement(nX,{toolCallId:e,toolName:t,dismissSupabase:n,trackingContext:r});case tj.s8.CONNECTED_PROJECT:return a.createElement(nV,null);case tj.s8.LOADING:return a.createElement(nY,null)}}var nQ=n(114344);function n0({toolCallId:e,toolName:t,disabledStatus:n,dismissSupabase:r,trackingContext:l}){return n?a.createElement(nL,{header:a.createElement(n1,{disabledStatus:n})}):a.createElement(nL,{header:a.createElement(n5,null),body:a.createElement(nZ,{toolCallId:e,toolName:t,dismissSupabase:r,trackingContext:l})})}function n1({disabledStatus:e}){let t=a.useMemo(()=>{switch(e){case nN.TOOL_CALL_SUCCESS:return(0,k.t)("figmake.supabase.cta.collapsed.success");case nN.TOOL_CALL_DISABLED:return(0,k.t)("figmake.supabase.cta.collapsed.disabled");case nN.TOOL_CALL_CANCELLED:default:return(0,k.t)("figmake.supabase.cta.collapsed.failure")}},[e]);return a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x167g77z"},a.createElement("div",{className:"xvy4d1p xxk0z11 x78zum5 xl56j7k x6s0dn4"},a.createElement(nI.B,{svg:nQ.A,useOriginalSrcFills_DEPRECATED:!0,svgWidth:"14px",svgHeight:"14px"})),a.createElement("p",{...x.Ay.props(n7.textBodyLargeStrong)},t))}function n5(){return a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x1qughib xh8yej3 xou54vl"},a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x167g77z"},a.createElement("div",{className:"xvy4d1p xxk0z11 x78zum5 xl56j7k x6s0dn4"},a.createElement(nI.B,{svg:nQ.A,useOriginalSrcFills_DEPRECATED:!0,svgWidth:"14px",svgHeight:"14px"})),a.createElement("p",{...x.Ay.props(n7.textBodyLargeStrong)},(0,k.t)("figmake.supabase.cta.title"))),a.createElement(eZ.jc,{url:nz.kS,linkText:(0,k.t)("figmake.supabase.cta.link")}))}let n7={textBodyLargeStrong:{...ey.g.textBodyLargeStrong,$$css:!0}};var n2=n(788502),n8=n(353019),n6=n(334804),n3=n(600254),n4=n(364633);function n9({toolCallId:e,toolName:t,disabledStatus:n,initialSecretName:r,dismissSupabase:l,trackingContext:i}){return n?a.createElement(nL,{header:a.createElement(ae,{disabledStatus:n,initialSecretName:r})}):a.createElement(nL,{header:a.createElement(at,null),body:a.createElement(an,{toolCallId:e,toolName:t,initialSecretName:r,dismissSupabase:l,trackingContext:i})})}function ae({initialSecretName:e,disabledStatus:t}){let n=a.useMemo(()=>{switch(t){case nN.TOOL_CALL_SUCCESS:return(0,k.t)("figmake.supabase.create_secret_cta.collapsed.success",{secretName:e});case nN.TOOL_CALL_DISABLED:return(0,k.t)("figmake.supabase.create_secret_cta.collapsed.disabled");case nN.TOOL_CALL_CANCELLED:default:return(0,k.t)("figmake.supabase.create_secret_cta.collapsed.failure")}},[t,e]);return a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x167g77z"},a.createElement(n8.m,null),a.createElement("p",{...x.Ay.props(al.textBodyLargeStrong)},n))}function at(){let{connectedProject:e}=(0,eJ.GC)();return a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x1qughib xh8yej3 xou54vl"},a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x167g77z"},a.createElement(n8.m,null),a.createElement("p",{...x.Ay.props(al.textBodyLargeStrong)},(0,k.t)("figmake.supabase.create_secret_cta.header"))),a.createElement(eZ.jc,{url:(0,nz.C4)(e?.id),linkText:(0,k.t)("figmake.supabase.create_secret_cta.link")}))}function an({toolCallId:e,toolName:t,initialSecretName:n,dismissSupabase:r,trackingContext:l}){let[i,o]=a.useState("init"),s=a.createElement(n6.G,{text:n,className:"x1i89z7r x1ey7xld x256u9z"});switch(i){case"init":return a.createElement(n$,{title:(0,k.tx)("figmake.supabase.create_secret_cta.body.title_secret_name",{secretName:s}),subtitle:(0,k.t)("figmake.supabase.create_secret_cta.body.subtitle"),interaction:a.createElement(ar,{interactionState:i,setInterationState:o,toolCallId:e,toolName:t,initialSecretName:n,dismissSupabase:r,trackingContext:l})});case"loading":return a.createElement(nF,{title:(0,k.t)("figmake.supabase.create_secret_cta.body.loading.title"),subtitle:(0,k.t)("figmake.supabase.create_secret_cta.body.loading.subtitle")});case"success":return a.createElement(nB,{text:(0,k.t)("figmake.supabase.create_secret_cta.body.title")});case"failed":return a.createElement(nD,{title:(0,k.tx)("figmake.supabase.create_secret_cta.body.error.title_secret_name",{secretName:s}),subtitle:(0,k.t)("figmake.supabase.create_secret_cta.body.error.subtitle"),interaction:a.createElement(ar,{interactionState:i,setInterationState:o,toolCallId:e,toolName:t,initialSecretName:n,dismissSupabase:r,trackingContext:l})})}}var aa=(e=>(e.INIT="init",e.LOADING="loading",e.SUCCESS="success",e.FAILED="failed",e))(aa||{});function ar({interactionState:e,setInterationState:t,toolCallId:n,toolName:r,initialSecretName:l,dismissSupabase:i,trackingContext:o}){let[s,c]=a.useState(""),u=(0,eL.tS)(),d="loading"===e,m=(0,nA.S)(),x=async()=>{if(!u){console.error("No open file key found");return}t("loading");try{await n3.R.createSecret({fileKey:u,secretName:l,secretValue:s}),(0,nM.XJ)(o,u)}catch(e){t("failed"),(0,n4.fQ)(e);return}t("success"),m({toolCallId:n,toolName:r,toolResult:{success:!0,message:`Successfully created secret ${l}.`}})};return a.createElement("form",{className:"x78zum5 xdt5ytf x1cy8zhl xl56j7k x167g77z xkh2ocl xy13l1i"},a.createElement(n2.p,{type:"password",id:"password",value:s,onChange:c,placeholder:(0,k.t)("figmake.supabase.create_secret_cta.body.secret_value"),size:"lg",disabled:d}),d?a.createElement(eZ.lV,{variant:"primary"},(0,k.t)("figmake.supabase.create_secret_cta.body.button")):a.createElement("div",{className:"x78zum5 x167g77z"},a.createElement(ec.WW,{type:"submit",variant:"primary",onClick:x},(0,k.t)("figmake.supabase.create_secret_cta.body.button")),a.createElement(ec.WW,{variant:"secondary",onClick:()=>i()},(0,k.t)("figmake.supabase.cancel"))))}let al={textBodyLargeStrong:{...ey.g.textBodyLargeStrong,$$css:!0}};function ai({toolCall:e,toolResult:t,isMostRecentMessage:n,trackingContext:r}){let l=t&&t.result?t.result.success?nT.SUCCESS:nT.FAILURE:nT.PENDING;return a.createElement("div",{className:"x78zum5 xdt5ytf x1cy8zhl x1jnr06f x9h44rk x1bamp8i"},a.createElement(ao,{toolName:e.toolName,toolCallId:e.toolCallId,partialArgs:e.partialArgs,isMostRecentMessage:n,status:l,trackingContext:r}))}function ao({toolName:e,toolCallId:t,partialArgs:n,isMostRecentMessage:r,status:l,trackingContext:i}){let o=(0,eW.gJ)(),[s,c]=a.useState(!1),u=(0,I.ry)(),d=a.useMemo(()=>r?u||o&&(0,eP.d4)(e)?nN.TOOL_CALL_DISABLED:s?nN.TOOL_CALL_CANCELLED:void 0:l===nT.SUCCESS?nN.TOOL_CALL_SUCCESS:nN.TOOL_CALL_CANCELLED,[r,l,o,s,u,e]),m=(0,nA.S)(),x=(0,eL.tS)()||"",g=a.useCallback(n=>{(0,nM.IB)({persistentEntityId:i.persistentEntityId,clientLifecycleId:i.clientLifecycleId},e,x),c(!0),m({toolCallId:t,toolName:e,toolResult:n})},[t,e,m,x,i.persistentEntityId,i.clientLifecycleId]);switch(e){case"supabase_connect":{let n={success:!1,message:"User dismissed Supabase connect tool call"};return a.createElement(n0,{toolCallId:t,toolName:e,disabledStatus:d,dismissSupabase:()=>g(n),trackingContext:i})}case"create_supabase_secret":{let r={success:!1,message:"User dismissed secret creation tool call"};return a.createElement(n9,{toolCallId:t,toolName:e,disabledStatus:d,initialSecretName:n.secretName??"",dismissSupabase:()=>g(r),trackingContext:i})}default:return null}}function as(){return(0,ns.Oc)()?e9.lV.FIGMAKE:e9.lV.CODE_IN_SITES}var ac=n(693164),au=n(940589),ad=n(946190),am=n(818882),ax=n(478111),ag=n(20116),ap=n(858260),ah=n(491721),af=n(231521),ay=n(871930);let aE=[ap.iK,ah.Db,af.v5,af.YW,ay.jL,ay.dJ,ah.k_,ah.Db],a_="editor_theme--heading--vjD0c",ab="editor_theme--revTextCode--mNWW0",av="editor_theme--revHeading--ImFNg",ak={code:"editor_theme--code--FBk-C",heading:{h1:a_,h2:a_,h3:a_,h4:a_,h5:a_,h6:a_},link:"editor_theme--link--g9j-A",list:{listitem:"editor_theme--listItem--HtIgs",nested:{listitem:"editor_theme--nestedListItem--rxhSm"},ol:"editor_theme--listOl--bcK9i",ul:"editor_theme--listUl--9En-S"},ltr:"editor_theme--ltr--z-aAi",rtl:"editor_theme--rtl--2jeQD",paragraph:"editor_theme--paragraph--5klW3",placeholder:"editor_theme--placeholder--1ATfY",quote:"editor_theme--quote--x7A5C",text:{bold:"editor_theme--textBold--eUufn",code:"editor_theme--textCode--dShpu",italic:"editor_theme--textItalic--6aIoY",strikethrough:"editor_theme--textStrikethrough--Nx-DH",underline:"editor_theme--textUnderline--sWctL",underlineStrikethrough:"editor_theme--textUnderlineStrikethrough--BF3Oy"}},aC={code:ab,heading:{h1:av,h2:av,h3:av,h4:av,h5:av,h6:av},link:"editor_theme--revLink--cC1OE",list:{listitem:"editor_theme--revListItem--t-JSJ",nested:{listitem:"editor_theme--revNestedListItem--xI4pL"},ol:"editor_theme--revListOl--VIR3k",ul:"editor_theme--revListUl--l1Hwr"},ltr:"editor_theme--revLtr--P2rY9",rtl:"editor_theme--revRtl--p2uEF",paragraph:"editor_theme--revParagraph--nf-XL",placeholder:"editor_theme--revPlaceholder--MjHDL",quote:"editor_theme--revQuote--vLFjg",text:{bold:"editor_theme--revTextBold--B6at8",code:ab,italic:"editor_theme--revTextItalic--Bc6Q3",strikethrough:"editor_theme--revTextStrikethrough--OgIi0",underline:"editor_theme--revTextUnderline--Vbg5K",underlineStrikethrough:"editor_theme--revTextUnderlineStrikethrough--H-f-D"}},aS=[ac.TB,ac.jA,ac.mK,ac.NB,ac.eA,ac.gb,ac.d7,ac.Pi,ac.Eg,ac.gW,ac.WY,ac.ps];function aw(e){let[t]=(0,ad.DF)();return(0,a.useEffect)(()=>{try{t.update(()=>{(0,ac.Wn)(e.textContent,aS,void 0,!0)},{discrete:!0})}catch(n){console.error("Error parsing editor state. Default to empty lexical state",n);let e=t.parseEditorState('{"root":{"children":[{"children":[],"direction":null,"format":"","indent":0,"type":"paragraph","version":1,"textStyle":""}],"direction":null,"format":"","indent":0,"type":"root","version":1}}');t.setEditorState(e)}},[e.textContent,t]),a.createElement("div",null,a.createElement(ag.$,{contentEditable:a.createElement(am.a,{className:"x1iyjqo2",spellCheck:!1,"data-testid":"code-chat-content-editable",contentEditable:!1}),placeholder:null,ErrorBoundary:ax.R}))}function aT({textContent:e,editorTheme:t}){return a.createElement(au.n,{initialConfig:{namespace:"code-chat-rich-text-editor",onError(e){throw e},theme:t??ak,nodes:aE,editable:!1}},a.createElement(aw,{textContent:e}))}function aN(){let e=(0,ns.Oc)()?aC:ak;return function(t){return a.createElement(aT,{textContent:t,editorTheme:e})}}var aA=n(829036),aI=n(952039),aL=n(303397),az=n(412775),aM=n(273664),aR=n(799770),aO=n(647942),aj=n(481694),aB=n(444747),aF=(e=>(e.FAILED_TO_RETRIEVE_CODE_FILES="FAILED_TO_RETRIEVE_CODE_FILES",e))(aF||{});class a$ extends Error{constructor(e,t){super(t),this.type=e,this.name="RestoreVersionError"}}let aD=(0,aM.q)();function aq({codeSnapshotKey:e,chatMessagesNodeGuid:t,featureType:n,persistentEntityId:l,clientLifecycleId:i,restoreToVersionTitle:o}){let s=(0,no.iZ)(),c=(0,eL.q5)(),u=c?.key||null,d=(0,r.wA)(),[m,x]=(0,p.fp)(aD(t)),g=(0,eQ.A)();return{restoreVersion:a.useMemo(()=>{if(u&&e&&s&&t&&c?.canEdit)return async()=>{if(m){d(aI.F.enqueue({message:(0,k.t)("figmake.chat.version_restore_in_progress")}));return}try{x(!0);let a=(0,q.UN)().get(t);if(!a)throw Error(`Chat messages node not found: ${t}`);await aP({fileKey:u,codeSnapshotKey:e,user:s,featureType:n,chatMessagesNode:a,restoreToVersionTitle:o}),g({showVisualBells:!1}),y.definedAnalyticsHandler.trackDefinedEvent("ai_for_production.version_restore_clicked",{success:!0,codeSnapshotKey:e,fileKey:u,featureType:n,persistentEntityId:l,clientLifecycleId:i})}catch(a){let t=a instanceof a$?a.type:"";y.definedAnalyticsHandler.trackDefinedEvent("ai_for_production.version_restore_clicked",{success:!1,errorType:t,errorMessage:a.message,codeSnapshotKey:e,fileKey:u,featureType:n,persistentEntityId:l,clientLifecycleId:i}),d(aI.F.enqueue({message:(0,k.t)("figmake.chat.version_restore_failed"),error:!0}))}finally{x(!1)}}},[u,e,s,t,c?.canEdit,n,l,i,d,m,x,o,g])}}async function aP({fileKey:e,codeSnapshotKey:t,user:n,featureType:a,chatMessagesNode:r,restoreToVersionTitle:l}){let i;try{i=await (0,aO.lm)({fileKey:e,codeSnapshotKey:t})}catch(e){throw new a$("FAILED_TO_RETRIEVE_CODE_FILES",e.message)}let o=(0,aR.Zi)(n,{codeSnapshotKey:t},l),s=a===e9.lV.FIGMAKE?(0,az.Bi)():(0,aj.OS)(r),c=Object.fromEntries(s.map(e=>[e.codeFileFullPathWithoutScheme,e]));ee.H.ai("restore-version",()=>{(0,er.vA)(void 0!==m.glU,"Fullscreen must be defined");let e=[];if(a===e9.lV.FIGMAKE)for(let[t,n]of((e=s.filter(e=>"/App.tsx"!==e.codeFileFullPathWithoutScheme)).forEach(e=>{e.codeFilePath=`${Q.GX}${e.codeFileFullPathWithoutScheme}`}),(0,aj.zK)(e),Object.entries(i))){let{codeFile:e}=(0,aj.Ur)(c,t,n);e&&(e.sourceCode=n,p.zl.set((0,e4.Nm)(r.guid),"assistant"))}else{let e=Object.entries(i);(0,er.vA)(1===s.length,"Code layer must have exactly one code file"),(0,er.vA)(1===e.length,"Code layer snapshot must have exactly one code file");let[t,n]=e[0],{codeFile:a}=(0,aj.Ur)(c,s[0].codeFileFullPathWithoutScheme,n);a&&(a.sourceCode=n,p.zl.set((0,e4.Nm)(r.guid),"assistant"))}let t=aB.O.get(r.guid);t&&(t.hasSystemEdited=!0);let n=[...r.chatMessages,o];r.chatMessages=n,aL.Y5.commit();let l=a===e9.lV.FIGMAKE?(0,az.Bi)().find(e=>"/App.tsx"===e.codeFileFullPathWithoutScheme):s[0];l&&(0,eq.Jt)(l),(0,A.wi)(r.guid,{switchToPreview:!1})})}var aH=n(635600);let aU={reasoningTitle:{display:"x78zum5",alignItems:"x6s0dn4",userSelect:"x87ps6o",cursor:"x1ypdohk",background:"x11g6tue",border:"x1gs6z28",padding:"x1717udv",width:"xh8yej3",textAlign:"xdpxx8g",color:"xv1l7n4",transition:"x1op4zxa",$$css:!0},reasoningTitleExpanded:{color:"xiuzu7u",$$css:!0},chevronIcon:{"--color-icon":"x1ha9dcd",transition:"x1bmturs",$$css:!0},chevronIconExpanded:{"--color-icon":"xhxt56g",transform:"x1iffjtl",$$css:!0}};function aG({reasoning:e,isReasoningComplete:t}){let n=aN(),r=a.useRef(null),[l,i]=a.useState(!1),[o,s]=a.useState(!1);a.useEffect(()=>{r.current&&i((r.current?.scrollHeight||0)>184)},[e]);let c=n(e??"");a.useEffect(()=>{if(r.current&&!t){let e=r.current;requestAnimationFrame(()=>{e.scrollTop=e.scrollHeight})}},[e,t]);let u=o||!t;return a.createElement("div",{className:"x78zum5 xdt5ytf"},t?a.createElement(eu.E,{...x.Ay.props(aU.reasoningTitle,o&&aU.reasoningTitleExpanded),onClick:()=>s(!o),"aria-expanded":o,"aria-label":o?(0,k.t)("figmake.chat.hide_reasoning"):(0,k.t)("figmake.chat.show_reasoning")},(0,k.t)("figmake.chat.reasoning"),a.createElement(aH.a,{...x.Ay.props(aU.chevronIcon,o&&aU.chevronIconExpanded)})):a.createElement(ny,null,(0,k.t)("figmake.chat.reasoning")),a.createElement("div",{className:"xb3r6kr"},a.createElement(h.N,{mode:"wait"},!t&&a.createElement(f.P.div,{key:"in-progress",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},style:{position:"relative"}},l&&a.createElement("div",{className:"x10l6tqk xu96u03 x3m8u43 xxk0z11 x47corl x13vifvy xu4a7ya"}),a.createElement("div",{ref:r,className:"xv1l7n4 xhpif6o xf18ygs xnuq7ks x1anpbxc x1iog12x x1hx0egp xkcv6ua x1ed109x x1i69ec5 xb3r6kr x78zum5 xdt5ytf xmidabu"},c),l&&a.createElement("div",{className:"x10l6tqk xu96u03 x3m8u43 xxk0z11 x47corl x1ey2m1c xf5q8oo"})),t&&u&&a.createElement(f.P.div,{key:"completed",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"}},a.createElement("div",{className:"xv1l7n4 xhpif6o xf18ygs xnuq7ks x1anpbxc x1iog12x x1hx0egp x1odjw0f xkcv6ua x1ed109x"},c)))))}let aV={container:{display:"x78zum5",flexDirection:"xdt5ytf",gap:"xou54vl",$$css:!0}};function aW({messages:e,isMostRecent:t,isInProgress:n,showCodeStreaming:r,scrollToBottom:l,trackingContext:i,chatMessagesNodeGuid:o,versionNumber:s,isAutoErrorFix:c,title:u,layerDisplayName:d}){let{defaultTypographyStyle:p}=nu(),h=!!(0,g.k)().bake_chat_message_revamp,f=e[e.length-1],{codeSnapshot:y,plainText:E,signedReasoning:_}=(0,na.lr)(f.textContent||""),{restoreVersion:b}=aq({codeSnapshotKey:y?.codeSnapshotKey,chatMessagesNodeGuid:o,featureType:as(),restoreToVersionTitle:u,...i}),v=a.useRef((E||_?.text)??""),k=a.useRef(f.id);a.useEffect(()=>{if(!n)return;let e=(E||_?.text)??"";(f.id!==k.current||e.length>v.current.length)&&l(),v.current=e,k.current=f.id},[E,_?.text,l,n,f.id]);let C=(0,K.ZC)(n);a.useEffect(()=>{!n&&C&&t&&l()},[n,t,l,C]);let S=a.useMemo(()=>(function(e){let t=[];return e.forEach(e=>{if(e.type===m.K$p.ASSISTANT_MESSAGE){let n=(0,na.lr)(e.textContent),a=[];switch(n.signedReasoning&&a.push({type:"reasoning",reasoning:n.signedReasoning.text}),n.mode){case"code":n.codeFilePath&&a.push({type:"code",code:n.code,file:n.codeFilePath});break;case"message":a.push({type:"message",message:n.plainText});break;case"plan":a.push({type:"plan",plan:n.plainText,title:n.title||""});break;case"summary":a.push({type:"summary",summary:n.plainText});break;case"work":a.push({type:"work",work:n.plainText});break;default:n.plainText.length>0&&a.push({type:"message",message:n.plainText})}e.toolCalls&&e.toolCalls.forEach(t=>{if(na.AD.includes(t.toolName)){let n=(0,na.Vm)(t);if(!n)return;let r={type:"clientSideToolCall",toolCall:n},l=e.toolResults.find(e=>e.toolCallId===t.toolCallId&&e.toolName===t.toolName);if(l){let e=(0,na.Xy)(l);e&&(r.toolResult=e)}a.push(r)}else a.push({type:"toolCall",name:t.toolName})}),t.push(...a)}}),t})(e),[e]),w=a.useMemo(()=>t&&n?a.createElement(nw,{type:"progress",showCodeStreaming:r,chatMessagesNodeGuid:o,layerDisplayName:d,scrollToBottom:l}):null,[t,n,o,l,d,r]),T=a.useMemo(()=>{if(0===S.length)return[c?a.createElement(aY,{key:"fixing"}):a.createElement(aK,{key:"thinking"})];let e=!1;return S.flatMap((r,l)=>{let c=l===S.length-1;switch(r.type){case"reasoning":let m=l<S.length-1;return[a.createElement(aG,{key:`reasoning-${l}`,reasoning:r.reasoning,isReasoningComplete:m})];case"plan":return e=!0,[a.createElement(aJ,{key:`plan-${l}}`,plan:r.plan})];case"summary":return[h?null:a.createElement(nw,{type:"version",isCurrentVersion:t,versionNumber:s,restoreVersion:b,chatMessagesNodeGuid:o,layerDisplayName:d,versionTitle:u}),a.createElement(aQ,{key:`summary-${l}`,summary:r.summary})];case"clientSideToolCall":return[a.createElement(ai,{key:`clientSideToolCall-${l}`,toolCall:r.toolCall,toolResult:r.toolResult,isMostRecentMessage:t&&c,trackingContext:i}),...c&&n?[a.createElement(aX,{key:"working"})]:[]];default:if(c&&w){let t=S.findIndex(e=>"summary"===e.type);return e&&(-1===t||t<l)?[w]:[a.createElement(aX,{key:"working"})]}return[]}})},[S,c,s,t,b,w,n,h,o,u,i,d]),N=a.createElement(a0,{trackingContext:i,isInProgress:n,lastMessage:f}),A=h&&!n?a.createElement(nw,{type:"version",key:`version-${s}`,isCurrentVersion:t,versionNumber:s,restoreVersion:b,chatMessagesNodeGuid:o,layerDisplayName:d,versionTitle:u}):null;return a.createElement("div",{...x.Ay.props(aV.container,p),"data-testid":"assistant-chat-messages-v2"},T,A,N)}function aK(){return a.createElement("div",{className:"x78zum5 x6s0dn4 x167g77z"},a.createElement(np,null),a.createElement(ny,null,(0,k.t)("figmake.chat.thinking")))}function aX(){return a.createElement("div",{className:"x78zum5 x6s0dn4 x167g77z"},a.createElement(np,null),a.createElement(ny,null,(0,k.t)("figmake.chat.working")))}function aY(){return a.createElement("div",{className:"x78zum5 x6s0dn4 x167g77z"},a.createElement(np,null),a.createElement(ny,null,(0,k.t)("figmake.chat.fixing")))}function aZ({text:e}){let t=aN();return a.createElement("div",{className:"x1ed109x"}," ",t(e.trim()))}function aJ({plan:e}){return a.createElement(aZ,{text:e})}function aQ({summary:e}){return a.createElement(aZ,{text:e})}function a0({trackingContext:e,isInProgress:t,lastMessage:n}){let r=(0,eL.q5)(),l=r?.key||null,i=e.clientLifecycleId&&!t&&r?.canEdit,o=as(),{feedbackState:s,setFeedbackState:c,sentimentFeedbackCallback:u,additionalFeedbackCallback:d,productType:m}=(0,aA.q)(e,l,o,n);return i?a.createElement("div",{className:"x11yfylt"},a.createElement(nx.z,{aiTrackingContext:{action:eF.JT.CODE_CHAT,source:o,clientLifecycleId:e.clientLifecycleId,quick_actions_session_id:null,file_key:l,product_type:m},sentimentFeedbackCallback:u,additionalFeedbackCallback:d,hideInitialText:!0,externalFeedbackState:s,setExternalFeedbackState:c,thumbsUpLabel:(0,k.t)("figmake.chat.thumbs_up"),thumbsDownLabel:(0,k.t)("figmake.chat.thumbs_down")})):null}function a1(e){let{scrollContainerRef:t,scrollToBottom:n,nearBottomThreshold:r=.3}=e,[l,i]=(0,a.useState)(!1),[o,s]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),[d,m]=(0,a.useState)(!1),x=(0,a.useRef)(0),g=(0,a.useRef)(null);(0,a.useEffect)(()=>()=>{g.current&&clearTimeout(g.current)},[]);let p=(0,a.useCallback)(()=>{if(!t.current)return!1;let{scrollTop:e,scrollHeight:n,clientHeight:a}=t.current;return n-e-a<a*r},[r,t]),h=(0,a.useCallback)(()=>{t.current&&(n?.(),u(!1))},[n,t]),f=(0,a.useCallback)(()=>{o||l?(u(!0),p()||m(!0)):(h(),m(!1))},[p,o,h,l]);return{showScrollToBottomButton:d,handleScroll:(0,a.useCallback)(e=>{g.current&&clearTimeout(g.current);let t=e-x.current;e!==x.current&&(t<0?(s(!0),p()||(i(!0),m(c))):(s(!1),t>=0&&p()&&(i(!1),m(!1),c&&h())),p()&&m(!1)),x.current=e,g.current=window.setTimeout(()=>{s(!1),g.current=null},200)},[p,c,h]),handleScrollToBottomClick:(0,a.useCallback)(()=>{i(!1),m(!1),h()},[h]),requestScrollToBottom:f}}var a5=n(901262);let a7={container:{display:"x78zum5",borderColor:"x7z60cl",borderRadius:"x9h44rk",borderWidth:"xmkeg23",borderStyle:"x1y0btm7",padding:"x153ncpu",lineHeight:"x1o2sk6j",flexDirection:"xdt5ytf",color:"x1n0bwc9",$$css:!0},caret:{"--color-icon":"xtc4nxu",transition:"x1bmturs",$$css:!0},caretExpanded:{transform:"x1iffjtl",$$css:!0}};function a2({changes:e,initialExpanded:t=!1,maxHeight:n,chatMessagesNodeGuid:r,featureType:l}){let[i,o]=(0,a.useState)(t),{defaultTypographyStyle:s}=nu(),{restoreFile:c,canRestoreFiles:u}=(0,a5.B)({chatMessagesNodeGuid:r,featureType:l||e9.lV.FIGMAKE});if(0===e.length)return null;if(1===e.length){let t=e[0];return t?a.createElement("div",{...x.Ay.props(a7.container,s),style:n?{maxHeight:n,overflowY:"auto"}:void 0},a.createElement(a8,{change:t,onRestoreFile:u?c:void 0})):null}return a.createElement("div",{...x.Ay.props(a7.container,s),style:n?{maxHeight:n,overflowY:"auto"}:void 0},a.createElement(eu.E,{className:"x78zum5 x6s0dn4 x167g77z x1ypdohk x87ps6o x1qughib x1n0bwc9",onClick:()=>o(!i)},a.createElement("span",null,(0,k.t)("figmake.edits.edited_files",{fileCount:e.length})),a.createElement("span",{...x.Ay.props(a7.caret,i&&a7.caretExpanded)},a.createElement(aH.a,null))),i&&a.createElement("div",{className:"x78zum5 xdt5ytf x167g77z x1ib1h6n"},e.map((e,t)=>a.createElement(a8,{key:`${e.path}-${t}`,change:e,onRestoreFile:u?c:void 0}))))}function a8({change:e,onRestoreFile:t}){let n;return a.createElement("div",{className:"x78zum5 x6s0dn4 x167g77z x1qughib xjwf9q1"},a.createElement("span",{className:"x98rzlu xb3r6kr xlyipyv xuxw1ft",title:e.path},(n=e.path).split("/").pop()??n),a.createElement("span",{className:"x1jnr06f x78zum5 x6s0dn4"},e.addedLines>0&&a.createElement("span",{className:"xq6u9c4"},(0,k.t)("figmake.edits.lines_added",{count:e.addedLines})),e.removedLines>0&&a.createElement("span",{className:"x172n1ly"},(0,k.t)("figmake.edits.lines_removed",{count:e.removedLines})),t&&a.createElement(eu.E,{className:"xfawy5m x12oqio5 xet2fuk x1ypdohk x1n0bwc9 xjbqb8w x1gs6z28 x78zum5 x6s0dn4 xl56j7k xvy4d1p xxk0z11 x12tve8b x1c5oinq",onClick:()=>t(e.path)},a.createElement(o.H,{className:"x1wt4b31 x1kky2od xlup9mm"}))))}let a6={textBodyLarge:{...ey.g.textBodyLarge,$$css:!0},textBodyLargeStrong:{...ey.g.textBodyLargeStrong,$$css:!0}};function a3({message:e,chatMessagesNodeGuid:t,systemMessageIndex:n,featureType:r,isMostRecent:l,trackingContext:i,title:o,layerDisplayName:s}){(0,er.vA)(e.type===m.K$p.SYSTEM_MESSAGE,"Message must be a system message");let{defaultTypographyStyle:c}=nu(),u=(0,na.U1)(e.textContent||""),{restoreVersion:d}=aq({codeSnapshotKey:u?.type==="manual_edit"?u?.codeSnapshot?.codeSnapshotKey:void 0,chatMessagesNodeGuid:t,featureType:r,restoreToVersionTitle:o,...i}),g=a.createElement(nw,{type:"version",isCurrentVersion:l,versionNumber:n+1,restoreVersion:d,chatMessagesNodeGuid:t,layerDisplayName:s,versionTitle:o});return a.createElement("div",{className:"x78zum5 xdt5ytf xou54vl"},a.createElement("div",{...x.Ay.props(c)},(0,k.t)("figmake.chat.restoring_a_previous_version")),g)}function a4({message:e,chatMessagesNodeGuid:t,systemMessageIndex:n,featureType:r,isMostRecent:l,trackingContext:i,title:o,layerDisplayName:s}){(0,er.vA)(e.type===m.K$p.SYSTEM_MESSAGE,"Message must be a system message");let{defaultTypographyStyle:c}=nu(),u=(0,na.U1)(e.textContent||"");(0,er.vA)(u?.type==="manual_edit","Message must be a manual edit system message");let{changedFiles:d,codeSnapshot:g}=u,p=g?.codeSnapshotKey,h=o&&(0,k.t)("figmake.chat.edited_version",{versionTitle:o}),{restoreVersion:f}=aq({codeSnapshotKey:p,chatMessagesNodeGuid:t,featureType:r,restoreToVersionTitle:h,...i}),y=a.createElement(nw,{type:"version",isCurrentVersion:l,versionNumber:n+1,restoreVersion:f,chatMessagesNodeGuid:t,layerDisplayName:s,versionTitle:h});return a.createElement("div",{className:"x78zum5 xdt5ytf xou54vl"},a.createElement("div",{...x.Ay.props(c)},(0,k.t)("figmake.edits.manual_edit_message")),a.createElement(a2,{changes:d,initialExpanded:!0,chatMessagesNodeGuid:t}),y)}function a9(){return a.createElement("div",{className:"x78zum5 xdt5ytf xou54vl"},a.createElement("p",{...x.Ay.props(a6.textBodyLarge)},(0,k.t)("figmake.duplicated_file_system_message")),a.createElement(re,null))}function re(){return a.createElement("div",{className:"x78zum5 xdt5ytf x1cy8zhl x1jnr06f x9h44rk x1bamp8i x14pk0dq"},a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x167g77z"},a.createElement("div",{className:"xvy4d1p xxk0z11 x78zum5 xl56j7k x6s0dn4"},a.createElement(nI.B,{svg:nQ.A,useOriginalSrcFills_DEPRECATED:!0,svgWidth:"14px",svgHeight:"14px"})),a.createElement("p",{...x.Ay.props(a6.textBodyLargeStrong)},(0,k.t)("figmake.supabase.duplicated_file.cta"))))}let rt=a.memo(function(){return a.createElement("div",{className:"x78zum5 x6s0dn4 xl56j7k xzw2spd x879a55"},a.createElement(tC.k,{size:"sm"}))}),rn=a.memo(function(e){let{index:t,start:n,measureRef:r}=e.virtualItem,{setSize:l,isResizingPanel:i,frozenDimensions:o}=e,s=(0,a.useRef)(t);(0,a.useEffect)(()=>{s.current=t},[t,s]);let c=(0,a.useRef)(!1),u=(0,a.useRef)(null),d=(0,a.useRef)(null);(0,a.useEffect)(()=>(u.current&&!i?(d.current&&d.current.disconnect(),d.current=new ResizeObserver(e=>{for(let t of e){let e=t.contentRect.width,n=t.contentRect.height;n>0&&l(s.current,e,n)}}),d.current.observe(u.current)):i&&d.current&&(d.current.disconnect(),d.current=null),()=>{d.current&&(d.current.disconnect(),d.current=null)}),[l,i]),(0,a.useEffect)(()=>{if((e.isLast||!c.current)&&u.current&&!i){c.current=!0;let e=u.current.getBoundingClientRect().width,t=u.current.getBoundingClientRect().height;t&&l(s.current,e,t),r(u.current)}},[e.isLast,l,r,i]);let m=o?{width:`${o.width}px`,height:`${o.height}px`}:{};return a.createElement("div",{ref:u,"data-virtual-index":t,style:{position:"absolute",top:n,left:0,width:"100%",...m}},e.children)});function ra({chatMessagesNodeGuid:e,messagesForRendering:t,exchangeMessageIds:n,emptyState:r,dragOverlay:l,featureType:i,layerDisplayName:o,isResizingPanel:s,clientLifecycleIdMap:c,showCodeStreaming:u}){let d=(0,a.useRef)(null),m=(0,a.useRef)(new Map),x=(0,a.useRef)(null),p=(0,a.useRef)(null),h=(0,a.useRef)(new Map),f=(0,a.useRef)(void 0),{handleScroll:y,showScrollToBottomButton:E,handleScrollToBottomClick:_,requestScrollToBottom:b}=a1({scrollContainerRef:d,scrollToBottom:()=>{x.current&&t.length>0&&x.current.scrollToIndex(t.length-1,{align:"end"})}}),v=(0,a.useRef)(t.length),k=(0,no.iZ)(),C=(0,a.useMemo)(()=>E?a.createElement(eu.E,{className:"x78zum5 x6s0dn4 xl56j7k x10l6tqk x1td3qas x10w6t97 x1c7jfne x1nrll8i xuuh30 x1yjdb4r x16rqkct x16a2w50 x1ypdohk x1epfdc x1vjfegm xk82a7y",onClick:_},a.createElement(nr.W,null)):null,[E,_]),S=(0,eL.q5)(),w=S?.key||null,T=(0,a.useMemo)(()=>(0,nM.qE)(w,e),[w,e]),N=S?.name,A=(0,a.useCallback)(e=>0===t.length?0:m.current.get(e)||600,[t.length,600]),I=(0,a.useCallback)((e,t,n)=>{h.current.set(e,{width:t,height:n});let a=m.current.get(e);if(a!==n){let t=n-(a||600);if(0!==t&&d.current){let n=d.current,a=n.scrollTop,r=0;for(let t=0;t<e;t++)r+=m.current.get(t)||600;r<a&&(n.scrollTop=a+t)}m.current.set(e,n),x.current&&x.current.measure()}},[600]),L=(0,nn.z)({size:t.length,parentRef:d,estimateSize:A,overscan:10});x.current=L,(0,a.useEffect)(()=>{if(t.length>v.current){let e=t.slice(v.current),n=e.filter(e=>"user"===e.type&&e.user.id===k?.id),a=e.filter(e=>"system"===e.type),r=d.current;if(r){let{scrollTop:e,scrollHeight:l,clientHeight:i}=r;l-e-i<100&&t.length>0?L.scrollToIndex(t.length-1,{align:"end"}):n.length>0||a.length>0?t.length>0&&L.scrollToIndex(t.length-1,{align:"end"}):b()}else n.length>0||a.length>0?t.length>0&&L.scrollToIndex(t.length-1,{align:"end"}):b();v.current=t.length}else t.length<v.current&&(v.current=t.length)},[t,b,t.length,L,k?.id]);let z=(0,a.useRef)(!0);(0,a.useEffect)(()=>{z.current&&t.length>0&&(L.scrollToIndex(t.length-1,{align:"end"}),z.current=!1)},[t.length,L]),(0,a.useEffect)(()=>{let e=f.current;!e&&s&&(h.current.clear(),L.virtualItems.forEach(e=>{let t=d.current?.querySelector(`[data-virtual-index="${e.index}"]`);if(t){let n=t.getBoundingClientRect();h.current.set(e.index,{width:n.width,height:n.height})}})),e&&!s&&(h.current.clear(),x.current&&x.current.measure()),f.current=s},[s,L.virtualItems]);let M=(0,a.useMemo)(()=>{let e=0;return t.map(t=>{if("system"===t.type){let n=t.message,a=(0,na.U1)(n.textContent||"");if(a?.type==="restore"||a?.type==="manual_edit")return e++}else if("assistant"===t.type)return 1+(t.messages.some(e=>"summary"===(0,na.lr)(e.textContent||"").mode)?e++:e);return 0})},[t]),R=(0,a.useCallback)((r,l)=>{switch(r.type){case"user":return a.createElement(nm,{key:`${r.type}-message-${l}`,message:r.message,user:r.user});case"system":let s=r.message,d=(0,na.U1)(s.textContent||"");if(d?.type==="restore")return a.createElement(a3,{key:`${r.type}-message-${l}`,message:s,chatMessagesNodeGuid:e,systemMessageIndex:M[l]??0,featureType:i,isMostRecent:l===t.length-1,trackingContext:{persistentEntityId:T,clientLifecycleId:c.get(s.id)||""},title:r.title||N});if(d?.type==="manual_edit"){if(!(0,g.k)().bake_manual_edits)return null;return a.createElement(a4,{key:`${r.type}-message-${l}`,message:s,chatMessagesNodeGuid:e,systemMessageIndex:M[l]??0,featureType:i,isMostRecent:l===t.length-1,trackingContext:{persistentEntityId:T,clientLifecycleId:c.get(s.id)||""},title:r.title||N})}if(d?.type==="duplicated_file")return a.createElement(a9,{key:`${r.type}-message-${l}`});return null;case"assistant":let m=r.messages[r.messages.length-1],x=c.get(m.id)||"",p=n.has(m.id);return a.createElement(aW,{chatMessagesNodeGuid:e,isAutoErrorFix:r.isAutoErrorFix??!1,isInProgress:p,isMostRecent:l===t.length-1,layerDisplayName:o??void 0,messages:r.messages,scrollToBottom:b,showCodeStreaming:u,title:r.title||N,trackingContext:{persistentEntityId:T,clientLifecycleId:x},versionNumber:1+(M[l]??0)})}},[e,i,T,c,N,n,o,b,t.length,M,u]),O=0===t.length,j=(0,a.useMemo)(()=>L.virtualItems.map(e=>e.index),[L.virtualItems]),B=O?a.createElement("div",{className:"x78zum5 xdt5ytf x98rzlu x1iyjqo2 xs83m0k x1r8uery xysyzu8 xl56j7k"},r):a.createElement(ni.P,{className:"x78zum5 xdt5ytf x98rzlu x1iyjqo2 xs83m0k x1r8uery xysyzu8",scrollContainerRef:d,onScroll:y},a.createElement("div",{style:{height:`${L.totalSize}px`,width:"100%",position:"relative"},className:"x1g8o3q3 x78zum5 xdt5ytf"},L.virtualItems.map(e=>{let n=t[e.index];if(!n)return null;let r=h.current.get(e.index);return a.createElement(rn,{isLast:e.index===t.length-1,key:`${n.type}-message-${e.index}`,virtualItem:e,setSize:nl.lQ,isResizingPanel:s,frozenDimensions:r},a.createElement("div",{className:"x1iwkndl x78zum5 xdt5ytf",tabIndex:-1},r?R(n,e.index):a.createElement(rt,null)))}),a.createElement("div",{ref:p,className:"x10l6tqk x1agkon0 x3rpodo xh8yej3 xlshs6z x47corl"},j.map(e=>{let n=t[e];return a.createElement(rn,{isLast:!1,key:`${n.type}-message-${e}`,virtualItem:{index:e,start:0,end:0,size:0,measureRef:nl.lQ,key:`${n.type}-message-${e}`},setSize:s?nl.lQ:I,isResizingPanel:s},a.createElement("div",{className:"x1iwkndl x78zum5 xdt5ytf",tabIndex:-1},R(n,e)))}))));return a.createElement("div",{className:"x1n2onr6 x78zum5 xdt5ytf x5yr21d xh8yej3","data-testid":"code-chat-messages-v2"},B,C,l&&a.createElement("div",{className:"x10l6tqk x13vifvy xu96u03 x3m8u43 x1ey2m1c xhtitgo"},l))}function rr({chatMessagesNodeGuid:e,messagesForRendering:t,exchangeMessageIds:n,emptyState:r,dragOverlay:l,featureType:i,layerDisplayName:o,clientLifecycleIdMap:s,showCodeStreaming:c}){let u=(0,a.useRef)(null),d=(0,a.useCallback)((e="smooth")=>{u.current?.scrollIntoView({behavior:e})},[u]),m=(0,a.useRef)(null),{handleScroll:x,showScrollToBottomButton:p,handleScrollToBottomClick:h,requestScrollToBottom:f}=a1({scrollContainerRef:m,scrollToBottom:d});(0,a.useEffect)(()=>{d("instant")},[d]);let y=(0,a.useRef)(t.length),E=(0,no.iZ)();(0,a.useEffect)(()=>{if(t.length>y.current){let e=t.slice(y.current),n=e.filter(e=>"user"===e.type&&e.user.id===E?.id),a=e.filter(e=>"system"===e.type);n.length>0||a.length>0?d():f(),y.current=t.length}else t.length<y.current&&(y.current=t.length)},[t,f,d,E?.id]);let _=(0,a.useMemo)(()=>p?a.createElement(eu.E,{className:"x78zum5 x6s0dn4 xl56j7k x10l6tqk x1td3qas x10w6t97 x1c7jfne x1nrll8i xuuh30 x1yjdb4r x16rqkct x16a2w50 x1ypdohk x1epfdc x1vjfegm xk82a7y",onClick:h},a.createElement(nr.W,null)):null,[p,h]),b=(0,eL.q5)(),v=b?.key||null,k=(0,a.useMemo)(()=>(0,nM.qE)(v,e),[v,e]),C=b?.name,S=0,w=t.length,T=t.map((t,r)=>{switch(t.type){case"user":return a.createElement(nm,{key:`${t.type}-message-${r}`,message:t.message,user:t.user});case"system":let l=t.message,u=(0,na.U1)(l.textContent||"");if(u?.type==="restore")return a.createElement(a3,{key:`${t.type}-message-${r}`,message:l,chatMessagesNodeGuid:e,systemMessageIndex:S++,featureType:i,isMostRecent:r===w-1,trackingContext:{persistentEntityId:k,clientLifecycleId:s.get(l.id)||""},title:t.title||C});if(u?.type==="manual_edit"){if(!(0,g.k)().bake_manual_edits)return null;return a.createElement(a4,{key:`${t.type}-message-${r}`,message:l,chatMessagesNodeGuid:e,systemMessageIndex:S++,featureType:i,isMostRecent:r===w-1,trackingContext:{persistentEntityId:k,clientLifecycleId:s.get(l.id)||""},title:t.title||C})}if(u?.type==="duplicated_file")return a.createElement(a9,{key:`${t.type}-message-${r}`});return null;case"assistant":let d=t.messages[t.messages.length-1],m=s.get(d.id)||"",x=n.has(d.id);return a.createElement(aW,{chatMessagesNodeGuid:e,isAutoErrorFix:t.isAutoErrorFix??!1,isInProgress:x,isMostRecent:r===w-1,layerDisplayName:o??void 0,messages:t.messages,scrollToBottom:f,showCodeStreaming:c,title:t.title||C,trackingContext:{persistentEntityId:k,clientLifecycleId:m},versionNumber:1+S++})}}),N=0===t.length?a.createElement("div",{className:"x78zum5 xdt5ytf x98rzlu x1iyjqo2 xs83m0k x1r8uery xysyzu8 xl56j7k"},r):a.createElement(ni.P,{className:"x78zum5 xdt5ytf x98rzlu x1iyjqo2 xs83m0k x1r8uery xysyzu8",scrollContainerRef:m,onScroll:x},a.createElement("div",{className:"xzw2spd x78zum5 xdt5ytf x1665zp3",tabIndex:-1},T),a.createElement("div",{ref:u}));return a.createElement("div",{className:"x1n2onr6 x78zum5 xdt5ytf x5yr21d xh8yej3","data-testid":"code-chat-messages-v2"},N,_,l&&a.createElement("div",{className:"x10l6tqk x13vifvy xu96u03 x3m8u43 x1ey2m1c xhtitgo"},l))}var rl=n(168323);let ri=(0,a.memo)(function(e){return(0,c.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,c.jsx)("path",{fill:"var(--color-icon)",d:"M13.756 5.013A2.5 2.5 0 0 1 16 7.5l-.013.256a2.5 2.5 0 0 1-.99 1.745A2.5 2.5 0 0 1 16 11.5a2.5 2.5 0 0 1-2.5 2.5 2.5 2.5 0 0 1-1.5-.504V15.5l-.013.256A2.5 2.5 0 0 1 9.5 18l-.256-.013a2.5 2.5 0 0 1-2.231-2.231L7 15.5c0-.819.394-1.545 1.002-2.001a2.5 2.5 0 0 1-.99-1.743L7 11.5c0-.819.394-1.545 1.002-2.001a2.5 2.5 0 0 1-.99-1.743L7 7.5a2.5 2.5 0 0 1 2.244-2.487L9.5 5h4zM17 14a.5.5 0 0 1 .5.5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 .5-.5m-7.5 0a1.5 1.5 0 1 0 1.5 1.5V14zm0-4a1.5 1.5 0 0 0 0 3H11v-3zm4 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m-4-4a1.5 1.5 0 1 0 0 3H11V6zM12 9h1.5a1.5 1.5 0 0 0 0-3H12z"})})});var ro=n(990140),rs=n(528067);function rc({enableAssetImport:e,enableImageAttachment:t,attachments:n,isViewOnly:l,chatMessagesNodeGuid:o,createLoadedAttachment:s}){let c=(0,r.wA)(),u=a.useRef(null),{getTriggerProps:d,manager:m}=rl.b(),x=a.useCallback(async e=>{let t=e.target.files?.[0];t&&(await (0,rs.z)(t,s),u.current&&(u.current.value=""))},[s]),g=e?a.createElement(rl.q7,{onClick:()=>{c(C.to({type:ea,data:{chatMessagesNodeGuid:o}}))},disabled:l||n.length>=G.qQ},a.createElement(rl.Q$,null,a.createElement(ri,null)),a.createElement("div",{className:"xifkd7f"},n.length>=G.qQ?(0,k.t)("sites.panel.make.attach_limit_reached",{limit:G.qQ}):(0,k.t)("figmake.attachments.import_from_figma"))):null,p=t?a.createElement(a.Fragment,null,a.createElement(rl.q7,{disabled:l||n.length>=G.qQ,onClick:()=>{u.current?.click()}},a.createElement(rl.Q$,null,a.createElement(tr.s,null)),a.createElement("div",{className:"xifkd7f"},n.length>=G.qQ?(0,k.t)("sites.panel.make.attach_limit_reached",{limit:G.qQ}):(0,k.t)("figmake.attachments.upload_image")))):null;return t||e?a.createElement(rl.bL,{manager:m},a.createElement(i.K,{...d(),"aria-label":(0,k.t)("sites.panel.make.attach_design"),"data-tooltip-show-above":!0,disabled:l||n.length>=G.qQ},a.createElement(ro.e,null)),t&&a.createElement("input",{type:"file",className:"x1s85apg",ref:u,accept:T.xp.join(","),onChange:x}),a.createElement(rl.mc,null,g,p)):null}let ru={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{duration:.3}},exit:{opacity:0,scale:.8,transition:{duration:.2}}},rd={animate:e=>({opacity:[.5,1,.5],y:[0,-2,0],transition:{duration:1,repeat:Number.POSITIVE_INFINITY,ease:"easeOut",times:[0,.5,1],delay:e}})};function rm({visible:e}){return a.createElement(h.N,{mode:"wait"},e&&a.createElement(f.P.div,{className:"x78zum5 x6s0dn4 x1v8gsql xmapbj6 x1i2kgm6 x1db2dqx",animate:"visible",exit:"exit",initial:"hidden",variants:ru},a.createElement("div",{className:"x78zum5 x195vfkc xpqajaz"},a.createElement(f.P.span,{className:"x1g8rjiy xuoj239 x1vc12gn xorixrz",custom:0,animate:"animate",variants:rd}),a.createElement(f.P.span,{className:"x1g8rjiy xuoj239 x1vc12gn xorixrz",custom:.25,animate:"animate",variants:rd}),a.createElement(f.P.span,{className:"x1g8rjiy xuoj239 x1vc12gn xorixrz",custom:.5,animate:"animate",variants:rd}))))}function rx({typingUsers:e}){return a.createElement("div",{className:"xqtp20y x1vjfegm x1n2onr6"},a.createElement("div",{className:"x10l6tqk x2rgi x131sewu x78zum5 xh8yej3 x13a6bvl"},a.createElement(rm,{visible:e.length>0}),a.createElement(h.N,{mode:"wait"},e.map((e,t)=>a.createElement(i.K,{key:e.sessionID,"aria-label":e.name,"data-tooltip-show-above":!0},a.createElement(f.P.div,{className:"x1ncqthk x16rqkct",style:{marginLeft:t>0?"-6px":"0"},animate:"visible",exit:"exit",initial:"hidden",variants:ru},a.createElement(eV.H8,{user:e})))))))}function rg(){return a.createElement("svg",{width:"41",height:"41",viewBox:"0 0 41 41",fill:"none"},a.createElement("rect",{x:"0.776855",y:"0.777344",width:"40",height:"40",rx:"5",fill:"white"}),a.createElement("rect",{x:"2.77686",y:"2.77734",width:"36",height:"36",rx:"4",fill:"url(#paint0_linear_9279_71495)"}),a.createElement("circle",{cx:"28.2769",cy:"13.2773",r:"5.5",fill:"#FFD966"}),a.createElement("path",{d:"M10.7964 19.4661L2.77686 28.4176V35.7773C2.77686 37.4342 4.12 38.7773 5.77686 38.7773H34.7769L17.4119 19.4604C15.6442 17.4939 12.5608 17.4966 10.7964 19.4661Z",fill:"#009951"}),a.createElement("defs",null,a.createElement("linearGradient",{id:"paint0_linear_9279_71495",x1:"20.7769",y1:"2.77734",x2:"20.7769",y2:"38.7773",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#6EC2FF"}),a.createElement("stop",{offset:"0.117896",stopColor:"#6FC2FF"}),a.createElement("stop",{offset:"0.213837",stopColor:"#72C4FF"}),a.createElement("stop",{offset:"0.2912",stopColor:"#76C6FF"}),a.createElement("stop",{offset:"0.353363",stopColor:"#7CC8FF"}),a.createElement("stop",{offset:"0.403704",stopColor:"#84CBFF"}),a.createElement("stop",{offset:"0.4456",stopColor:"#8CCFFF"}),a.createElement("stop",{offset:"0.48243",stopColor:"#95D2FF"}),a.createElement("stop",{offset:"0.51757",stopColor:"#9FD7FF"}),a.createElement("stop",{offset:"0.5544",stopColor:"#A9DBFF"}),a.createElement("stop",{offset:"0.596296",stopColor:"#B4DFFF"}),a.createElement("stop",{offset:"0.646637",stopColor:"#BEE4FF"}),a.createElement("stop",{offset:"0.7088",stopColor:"#C9E8FF"}),a.createElement("stop",{offset:"0.786163",stopColor:"#D3ECFF"}),a.createElement("stop",{offset:"0.882104",stopColor:"#DCF0FF"}),a.createElement("stop",{offset:"1",stopColor:"#E5F4FF"}))))}function rp(){return a.createElement(h.N,null,a.createElement(f.P.div,{className:"x1n2onr6 xh8yej3 x5yr21d x1yjdb4r x78zum5 xdt5ytf x6s0dn4 xl56j7k",initial:{opacity:0},animate:{opacity:.95},exit:{opacity:0,transition:{delay:.1}},transition:{duration:.2}},a.createElement("div",{className:"x1n2onr6 xrostsh xng8ra x78zum5 x6s0dn4 xl56j7k"},a.createElement(f.P.div,{className:"x10l6tqk xu96u03",style:{originX:.5,originY:.5},initial:{rotate:0,x:34,y:2,scale:.8,opacity:0},animate:{rotate:-20,x:20,y:4,scale:1,opacity:.95},exit:{rotate:-23,x:20,y:4,scale:.8,opacity:0,transition:{delay:.1}},transition:{duration:.3,type:"spring",delay:.1}},a.createElement(rg,null)),a.createElement(f.P.div,{className:"x1vjfegm",style:{originX:.5,originY:.5},initial:{scale:.8,y:0,opacity:0},animate:{scale:1,y:0,opacity:.95},exit:{scale:.8,y:0,opacity:0,transition:{delay:.1}},transition:{duration:.4,type:"spring"}},a.createElement(rg,null)),a.createElement(f.P.div,{className:"x10l6tqk x3m8u43",style:{originX:.5,originY:.5},initial:{rotate:0,x:-34,y:4,scale:.8,opacity:0},animate:{rotate:23,x:-22,y:4,scale:1,opacity:.95},exit:{rotate:23,x:-22,y:2,scale:.8,opacity:0,transition:{delay:.1}},transition:{duration:.4,type:"spring",delay:.1}},a.createElement(rg,null))),a.createElement(f.P.div,{className:"xw7yly9 x78zum5 xdt5ytf x6s0dn4"},a.createElement(f.P.p,{className:"x1wtuluy x1vzchgk x123g5w4 x1akne3o x1ghz6dp",initial:{opacity:0,y:8},animate:{opacity:.95,y:0},exit:{opacity:0,y:0,transition:{delay:0}},transition:{duration:.2,ease:"easeOut"}},(0,k.t)("figmake.code_chat.drag_upload_overlay.title")),a.createElement(f.P.p,{className:"x17hqfcz xemv814 x1ma9mv9 x1n0bwc9 x1xmf6yo x2b8uid x1jkqq1h",initial:{opacity:0,y:8},animate:{opacity:.95,y:0},exit:{opacity:0,y:0,transition:{delay:0}},transition:{duration:.2,delay:.1,ease:"easeOut"}},(0,k.t)("figmake.code_chat.drag_upload_overlay.description")))))}var rh=n(562027),rf=n(4881),ry=n(771981);let rE=(0,rf.Wh)(()=>(0,p.eU)(null)),r_=(0,rf.Wh)(()=>(0,p.eU)(null)),rb=(0,rf.Wh)(()=>(0,p.eU)(null)),rv={library_type:"team",library_name:"Unknown",library_file_key:"",library_key:(0,rh.l)(""),thumbnail_url:"",global_css:""},rk={library_type:"team",library_name:"Loading...",library_file_key:"",library_key:(0,rh.l)(""),thumbnail_url:"",global_css:""};function rC(){let[e,t]=(0,p.fp)(rE),n=(0,eL.tS)(),r=a.useCallback(e=>{if(e.raw_text_styles){let t=JSON.parse(e.raw_text_styles||"[]");W.l7.ai("figmake custom fonts",()=>{t.forEach(e=>{e.fontFamily&&e.fontWeight&&function(e){let t=m.t8O?.getLocalTextStyleFontInfo();if(t&&t.find(t=>t.family===e.fontFamily&&t.style===e.styleName))return;let n=(0,q.UN)().createStyle("TEXT");n.fontName={family:e.fontFamily,style:e.styleName,postscript:e.postscript},n.name=`${e.fontFamily}: ${e.styleName}`}({fontFamily:e.fontFamily,styleName:e.fontWeight,postscript:e.postscript||""})})})}let a=(0,az.fK)()["/styles/globals.css"];a&&(a.sourceCode=e.global_css),t({type:"LIBRARY",library:e}),y.definedAnalyticsHandler.trackDefinedEvent("ds_import.library_selected",{fileKey:n||"",libraryKey:e.library_key})},[t,n]),l=a.useCallback(()=>{e?.library&&y.definedAnalyticsHandler.trackDefinedEvent("ds_import.library_used_in_generation",{fileKey:n||"",libraryKey:e.library.library_key}),t(null)},[t,n,e]),i=a.useCallback(n=>{e&&t({...e,frozen:n})},[e,t]);return{libraryImport:e,createLibraryImport:r,stashLibraryImport:l,setFrozenOnLibaryImport:i}}function rS(){let[e,t]=(0,p.fp)(r_),[n,r]=(0,p.fp)(rb);return a.useEffect(()=>{null===n&&(r("loading"),(0,ry.N6)().then(e=>{t(e.data.meta),r("loaded")}).catch(e=>{r("error")}))},[n,r,t]),{allDsImportReadyLibraries:e,allDsImportReadyLibrariesRequestStatus:n}}var rw=n(642935),rT=n(323209);let rN=(0,a.memo)(function(e){return(0,c.jsx)("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 16 16",...e,children:(0,c.jsx)("path",{fill:"var(--color-icon)",fillRule:"evenodd",d:"M5 3.5a.5.5 0 0 1 1 0v4.585a1.5 1.5 0 0 1 0 2.83V12.5a.5.5 0 0 1-1 0v-1.585a1.5 1.5 0 0 1 0-2.83zm0 6a.5.5 0 1 1 1 0 .5.5 0 0 1-1 0m5 3a.5.5 0 0 0 1 0V7.915a1.5 1.5 0 0 0 0-2.83V3.5a.5.5 0 0 0-1 0v1.585a1.5 1.5 0 0 0 0 2.83zm0-6a.5.5 0 1 0 1 0 .5.5 0 0 0-1 0",clipRule:"evenodd"})})});var rA=n(894536),rI=n(88706),rL=n(442393),rz=n(454805),rM=n(34542),rR=n(381673),rO=n(517776),rj=n(520779),rB=n(263336),rF=n(274016),r$=n(136169),rD=n(392665),rq=n(376852),rP=n(622518),rH=n(561258),rU=n(277454),rG=n(882839),rV=n(483073),rW=n(698496),rK=n(513094),rX=n(512448),rY=n(506839),rZ=n(140603),rJ=n(181243);let rQ=(0,P.Ju)(function(e){let t=F.hS(e),{library:n,onClose:l}=e,i=(0,r.wA)(),{createLibraryImport:o}=rC(),s=(0,eL.tS)();(0,eG.h)(()=>{y.definedAnalyticsHandler.trackDefinedEvent("ds_import.library_warning_modal_shown",{library_key:n.library_key,file_key:s||""})});let c=a.useCallback(()=>{y.definedAnalyticsHandler.trackDefinedEvent("ds_import.library_warning_modal_continue_clicked",{library_key:n.library_key,file_key:s||""}),o(n),i((0,C.AS)()),l()},[o,i,n,l,s]);return a.createElement($.bL,{manager:t,width:"lg",height:"fixed"},a.createElement(D.vo,null,a.createElement(D.Y9,null,a.createElement(D.hE,null,(0,k.t)("figmake.ds_imports.library_selector_warning_modal.title"))),a.createElement(D.nB,null,a.createElement("div",{className:"x78zum5 xdt5ytf xou54vl x1xmf6yo x1e56ztr"},a.createElement("div",{className:"x78zum5 xou54vl x6s0dn4"},a.createElement(rJ.D,{thumbnailUrl:n.thumbnail_url,coverThumbnail:!0,name:n.library_name}),a.createElement("div",{className:"x78zum5 xdt5ytf x1jnr06f"},a.createElement("span",{className:"x17hqfcz xemv814 x1ma9mv9"},n.library_name),a.createElement("span",{className:"x1n0bwc9 xclx6tv x17akokd x1qxcl5b"},n.team_name))),a.createElement("p",null,(0,k.t)("figmake.ds_imports.library_selector_warning_modal.body")))),a.createElement(D.wi,null,a.createElement(D.jk,null,a.createElement(ec.$n,{onClick:c},(0,k.t)("figmake.ds_imports.library_selector_warning_modal.continue"))))))},"ChatLibrarySelectorWarningModal"),r0="https://help.figma.com/hc/articles/33024539096471-Bring-style-context-from-a-Figma-Design-library-into-Figma-Make",r1={textSecondary:{color:"x1n0bwc9",$$css:!0}};function r5({closeModal:e,hasExistingChatMessages:t}){let{allDsImportReadyLibraries:n,allDsImportReadyLibrariesRequestStatus:r}=rS();return"loading"===r||n?.length?a.createElement(rZ.$,{className:"x1y1aw1k xjkvuk6 xh8yej3 x78zum5 xdt5ytf x167g77z"},a.createElement(rY.S,null,a.createElement(r7,{closeModal:e,hasExistingChatMessages:t}))):a.createElement(r2,null)}function r7({closeModal:e,hasExistingChatMessages:t}){let{allDsImportReadyLibraries:n,allDsImportReadyLibrariesRequestStatus:l}=rS(),{createLibraryImport:i}=rC(),o=(0,r.wA)(),s=(0,eL.tS)();if("loading"===l)return a.createElement(a.Fragment,null,(0,rq.y1)(3).map(e=>a.createElement(rX.Q,{key:e})));let c=n||[];return 0===c.length?null:a.createElement("div",null,a.createElement("div",{className:"x1qh3cfz xbnt99j"},a.createElement("div",{className:"x78zum5 xdt5ytf x1cy8zhl x1jnr06f xc7ga6q x1seouad x1qh3cfz x1b06okx xcr9a89"},a.createElement("div",{...x.Ay.props(ey.g.textBodyMediumStrong)},(0,k.t)("sites.modal.select_library_banner_title")),a.createElement("div",{...x.Ay.props(ey.g.textBodyMedium,r1.textSecondary)},(0,k.t)("sites.modal.select_library_banner_subtitle"),"\xa0",a.createElement(ek.Ph,{href:r0,newTab:!0},(0,k.t)("sites.modal.learn_more"))))),a.createElement(rV.Tp,{entrypoint:rG.r6.FIGMAKE,initialTab:void 0,initialUpdatesModalScope:rU.aD.CURRENT},a.createElement(rH.dP,null,c.map((n,r)=>a.createElement(rK.V,{key:`LibraryListItem-${r}`,header:n.library_name,subheader:n.team_name,thumbnailUrl:n.thumbnail_url,coverThumbnail:!0,callToAction:null,name:n.library_name,onClick:()=>{y.definedAnalyticsHandler.trackDefinedEvent("ds_import.library_selector_overlay_library_selected",{library_key:n.library_key,file_key:s||""}),t?(e(),o(C.to({type:rQ,data:{library:n}}))):(i(n),e())},kbPath:[rW.m3.TabBodySection.Body,r]})))))}function r2(){let e=(0,p.Xr)(rD.j),t=(0,eL.tS)();return(0,eG.h)(()=>{y.definedAnalyticsHandler.trackDefinedEvent("ds_import.library_selector_empty_state_seen",{file_key:t||""})}),a.createElement("div",{className:"x9f619 x167g77z xh8yej3 x5yr21d x78zum5 x6s0dn4 xl56j7k xwib8y2"},a.createElement("div",{className:"xhwf2h4 x167g77z x78zum5 xdt5ytf x6s0dn4 xl56j7k x2b8uid"},a.createElement(rL.l,null),a.createElement("div",{...x.Ay.props(ey.g.textBodyMediumStrong)},(0,k.t)("sites.modal.no_libraries_found")),a.createElement("div",{...x.Ay.props(ey.g.textBodyMedium,r1.textSecondary)},(0,k.t)("sites.modal.select_library_banner_subtitle"),"\xa0",a.createElement(ek.Ph,{href:r0,newTab:!0},(0,k.t)("sites.modal.learn_more"))),a.createElement("div",{className:"x78zum5 x1q0g3np xl56j7k x2b8uid x6s0dn4"},a.createElement("div",{className:"x1dmp6jm xqtp20y x1bamp8i"}),"\xa0",a.createElement("div",{...x.Ay.props(ey.g.textBodyMedium,r1.textSecondary)},(0,k.t)("sites.modal.or")),"\xa0",a.createElement("div",{className:"x1dmp6jm xqtp20y x1bamp8i"})),a.createElement("div",{...x.Ay.props(ey.g.textBodyMedium,r1.textSecondary)},(0,k.t)("sites.modal.add_guidelines_text")),a.createElement(ec.$n,{variant:"primary",onClick:()=>{y.definedAnalyticsHandler.trackDefinedEvent("ds_import.library_selector_empty_state_guidelines_clicked",{file_key:t||""});let n=(0,az.fK)()["/Guidelines.md"]||null;n&&((0,L.Zr)(n),e(rD.I.CODE))}},(0,k.t)("sites.modal.add_guidelines_button_text"))))}let r8=(0,P.Ju)(function(e){let{bottomLeftAnchor:t,onCloseCallback:n,hasExistingChatMessages:l}=e,i={left:t.x,bottom:window.innerHeight-t.y+10},o=(0,r.wA)(),s=a.useCallback(()=>{n(),o((0,C.AS)())},[o,n]);return a.createElement(rP.bL,{defaultPosition:i,width:332,maxHeight:336,onClose:s},a.createElement(D.vo,null,a.createElement(D.Y9,null,a.createElement(D.hE,null,(0,k.t)("sites.modal.select_library"))),a.createElement(D.nB,{padding:0},a.createElement("div",{className:"x78zum5 xdt5ytf xou54vl x2ozue6 xh8yej3 x9f619"},a.createElement(r5,{closeModal:s,hasExistingChatMessages:l})))))},"ChatLibrarySelectorOverlay",P.ZU.YES);var r6=n(957872),r3=n(391301),r4=n(556049);function r9({targetKey:e,isShowing:t,onComplete:n}){return a.createElement(r3.rq,{arrowPosition:r4.F_.BOTTOM,targetKey:e,title:(0,k.tx)("figmake.design_system_imports.use_design_system_overlay.title"),description:(0,k.tx)("figmake.design_system_imports.use_design_system_overlay.description"),isShowing:t,onClose:n,onTargetLost:n,trackingContextName:"Make Design System Imports > Selected Design System Overlay",primaryCta:{label:(0,k.tx)("figmake.design_system_imports.learn_more"),href:r0,type:"link",ctaTrackingDescriptor:r6.c.DS_IMPORT_LEARN_MORE}})}function le({targetKey:e,isShowing:t,onComplete:n}){return a.createElement(r3.rq,{arrowPosition:r4.F_.BOTTOM,targetKey:e,title:(0,k.tx)("figmake.design_system_imports.selected_design_system_overlay.title"),description:(0,k.tx)("figmake.design_system_imports.selected_design_system_overlay.description"),isShowing:t,onClose:n,onTargetLost:n,trackingContextName:"Make Design System Imports > Selected Design System Overlay",primaryCta:{label:(0,k.tx)("figmake.design_system_imports.learn_more"),href:r0,type:"link",ctaTrackingDescriptor:r6.c.DS_IMPORT_LEARN_MORE}})}let lt={editButton:{borderRadius:"xdryqjb",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,borderLeft:"xof1wgs",borderLeftWidth:null,borderInlineStartWidth:null,borderInlineEndWidth:null,borderLeftStyle:null,borderInlineStartStyle:null,borderInlineEndStyle:null,borderLeftColor:null,borderInlineStartColor:null,borderInlineEndColor:null,transition:"xuk1p4z",transitionBehavior:null,transitionDelay:null,transitionDuration:null,transitionProperty:null,transitionTimingFunction:null,":hover_backgroundColor":"xv2f06h",width:"xvy4d1p",height:"xxk0z11",display:"x78zum5",alignItems:"x6s0dn4",justifyContent:"xl56j7k",gap:"xxhr3t",rowGap:null,columnGap:null,$$css:!0},editButtonFrozen:{backgroundColor:"x1yjdb4r",$$css:!0},libraryImportButtonText:{borderRadius:"xmdyj57",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,paddingLeft:"x1lqa7cf",paddingInlineStart:null,paddingInlineEnd:null,transition:"xuk1p4z",transitionBehavior:null,transitionDelay:null,transitionDuration:null,transitionProperty:null,transitionTimingFunction:null,":hover_backgroundColor":"xv2f06h",gap:"xxhr3t",rowGap:null,columnGap:null,$$css:!0},libraryImportButtonTextDisabled:{borderRadius:"xmdyj57",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,paddingLeft:"x1lqa7cf",paddingRight:"x1ug7bdz",paddingInlineStart:null,paddingInlineEnd:null,gap:"xxhr3t",rowGap:null,columnGap:null,$$css:!0},libraryImportButtonTextDisabledContainer:{backgroundColor:"x1v8gsql",height:"xxk0z11",display:"x3nfvp2",flexDirection:"x1q0g3np",alignItems:"x6s0dn4",gap:"xxhr3t",rowGap:null,columnGap:null,flexShrink:"x2lah0s",$$css:!0},libraryImportContainer:{display:"x3nfvp2",flexDirection:"x1q0g3np",height:"xxk0z11",alignItems:"x6s0dn4",gap:"xxhr3t",rowGap:null,columnGap:null,flexShrink:"x2lah0s",...ey.g.textBodyMedium,border:"x1bamp8i",borderWidth:null,borderInlineWidth:null,borderInlineStartWidth:null,borderLeftWidth:null,borderInlineEndWidth:null,borderRightWidth:null,borderBlockWidth:null,borderTopWidth:null,borderBottomWidth:null,borderStyle:null,borderInlineStyle:null,borderInlineStartStyle:null,borderLeftStyle:null,borderInlineEndStyle:null,borderRightStyle:null,borderBlockStyle:null,borderTopStyle:null,borderBottomStyle:null,borderColor:null,borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,borderRadius:"xpzoddv",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,$$css:!0}},ln=(0,rO.r1)("seen_figmake_selected_design_system_onboarding"),la=(0,rO.r1)("seen_figmake_use_design_system_onboarding");function lr({isViewOnly:e,hasMessages:t,libraryImports:n,disabled:l}){let i=(0,p.md)(ln),{show:o,isShowing:s,complete:c}=(0,rM.e)({overlay:r$.q6k,priority:rB.N.DEFAULT_MODAL},[i]),{allDsImportReadyLibraries:u,allDsImportReadyLibrariesRequestStatus:d}=rS(),h=(0,p.md)(la),{show:f,isShowing:E,complete:_}=(0,rM.e)({overlay:r$.cR4,priority:rB.N.DEFAULT_MODAL},[i]),b=(0,eL.tS)();a.useEffect(()=>{!e&&((0,az.fK)()["/Guidelines.md"]||W.l7.ai("code-chat",()=>{m.glU?.createNewCodeFile("Guidelines.md","",null)}))},[e]);let v=(0,eL.q5)(),S=(0,eR.X$)("LibraryImportButton"),w=(0,eR.YY)(S).unwrapOr(!1),[T,N]=a.useState(!1),A=(0,a.useRef)(null),{libraryImport:I}=rC(),z=(0,p.Xr)(rD.j),M=(0,r.wA)();a.useEffect(()=>{I&&o({canShow:e=>!e})},[I,o]),a.useEffect(()=>{"loaded"===d&&u?.length&&f({canShow:e=>!e})},[d,u,f,h]);let R=n||(I?.frozen?I:null),{getTriggerProps:j,manager:B}=rl.b(),F=e=>{let t=(0,az.fK)()[e]||null;t&&((0,L.Zr)(t),z(rD.I.CODE),t.codeFilePath&&(0,Q.ci)(t.codeFilePath))},$=w&&(0,g.k)().bake_starter_limit,D=()=>{if($){M(C.to({type:rF.DV,data:{team:v?.team??null,resource:rj.Bi.CODE_CHAT_LIBRARY_IMPORT,currentPlan:rR.F.Plan.STARTER,upsellPlan:rR.F.Plan.PRO,editorType:eM._Y.FIGMAKE,upsellSource:ej.b.CODE_CHAT_LIBRARY_IMPORT}}));return}let e=A.current;if(!e)return;y.definedAnalyticsHandler.trackDefinedEvent("ds_import.library_import_button_clicked",{selected_library_key:I?.library.library_key,file_key:b||""}),_();let n=e.getBoundingClientRect(),a=new rz.Mi(n.left,n.top);N(!0),M(C.to({type:r8,data:{bottomLeftAnchor:a,onCloseCallback:()=>{N(!1)},hasExistingChatMessages:t}}))},q=j(),P=q.onMouseDown;q.onMouseDown=e=>{e.preventDefault(),e.stopPropagation(),y.definedAnalyticsHandler.trackDefinedEvent("ds_import.settings_button_clicked",{library_key:I?.library.library_key,file_key:b||""}),c(),P(e)};let H=a.createElement(rl.bL,{manager:B},a.createElement(eu.E,{...x.Ay.props(lt.editButton,!l&&R&&lt.editButtonFrozen),disabled:l,key:"editButton",...q,"data-onboarding-key":O.oD},a.createElement(rN,null)),a.createElement(rl.mc,null,a.createElement(rl.q7,{onClick:()=>{y.definedAnalyticsHandler.trackDefinedEvent("ds_import.edit_styles_menu_item_clicked",{library_key:I?.library.library_key,file_key:b||""}),F("/styles/globals.css")}},a.createElement(rl.Q$,null,a.createElement(rA.G,null)),a.createElement("div",null,(0,k.t)("sites.modal.edit_styles_menu_title"),a.createElement(rl.ME,null,(0,k.t)("sites.modal.edit_styles_menu_subtitle")))),a.createElement(rl.q7,{onClick:()=>{y.definedAnalyticsHandler.trackDefinedEvent("ds_import.edit_guidelines_menu_item_clicked",{library_key:I?.library.library_key,file_key:b||""}),F("/Guidelines.md")}},a.createElement(rl.Q$,null,a.createElement(nf.A,null)),a.createElement("div",null,(0,k.t)("sites.modal.edit_guidelines_menu_title"),a.createElement(rl.ME,null,(0,k.t)("sites.modal.edit_guidelines_menu_subtitle"))))));return R?a.createElement("div",{ref:A,...x.Ay.props(lt.libraryImportContainer,lt.libraryImportButtonTextDisabledContainer)},a.createElement(eu.E,{className:"xuk1p4z xv2f06h xmdyj57 x1lqa7cf x1ug7bdz xxhr3t",disabled:!0,key:"libraryImportButton",onClick:nl.lQ},a.createElement("div",{className:"x10739mo xlup9mm xb3r6kr xlyipyv xuxw1ft"},R.library.library_name)),H):I?a.createElement("div",{ref:A,...x.Ay.props(lt.libraryImportContainer,l&&lt.libraryImportButtonTextDisabledContainer)},a.createElement(le,{targetKey:O.oD,isShowing:s,onComplete:c}),a.createElement(eu.E,{...x.Ay.props(lt.libraryImportButtonText,l&&lt.libraryImportButtonTextDisabled),disabled:l,key:"libraryImportButton",onClick:D},a.createElement("div",{className:"x10739mo xlup9mm xb3r6kr xlyipyv xuxw1ft"},I.library.library_name),a.createElement("div",{className:"x1kky2od x78zum5 xl56j7k xb3r6kr"},a.createElement(rI.r,null))),H):a.createElement("div",{ref:A},a.createElement(r9,{targetKey:O.t$,isShowing:E,onComplete:_}),a.createElement(rT.f,{"aria-label":(0,k.t)("sites.modal.select_library"),checked:T,"data-tooltip-show-above":!0,disabled:l,htmlAttributes:{"data-onboarding-key":O.t$},offIcon:a.createElement(rL.l,null),onChange:D,onIcon:a.createElement(rL.l,null),variant:"highlighted"}))}var ll=n(162293),li=n(308844);function lo({disabled:e,onClick:t,onUndo:n,isEnhanced:r}){return(0,g.k)().bake_enhance_prompt?a.createElement(h.N,{mode:"wait"},r?a.createElement(f.P.div,{key:"undo",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2,ease:"easeInOut"}},a.createElement(i.K,{"aria-label":(0,k.t)("figmake.chat_box.undo_enhance_prompt"),"data-tooltip-show-above":!0,disabled:e,onClick:n},a.createElement(o.H,null))):a.createElement(f.P.div,{key:"enhance",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2,ease:"easeInOut"}},a.createElement(i.K,{"aria-label":(0,k.t)("figmake.chat_box.enhance_prompt"),"data-tooltip-show-above":!0,disabled:e,onClick:t},a.createElement(s.T,null)))):a.createElement(a.Fragment,null)}function ls({enableAssetImport:e,enableImageAttachment:t,enableDsImport:n,createLoadedAttachment:o,attachments:s,isViewOnly:c,chatMessagesNodeGuid:m,enhancePrompt:x,isEnhancing:h,generationInProgress:f,hasMessages:y,libraryImports:_}){let v=(0,r.wA)(),S=(0,p.md)(N.f3),w=a.useRef(null),[I,L]=(0,p.fp)((0,A.mC)(m)),[z,M]=a.useState(""),[R,B]=a.useState(!1),F=a.useCallback(async e=>{let t=e.target.files?.[0];t&&(await (0,rs.z)(t,o),w.current&&(w.current.value=""))},[o]),$=a.useCallback(async()=>{try{for await(let e of(M(I),x(I)))L(e);B(!0)}catch(e){M(""),B(!1),(0,E.$D)(l.e.MAKE,e instanceof Error?e:Error(String(e)))}},[x,I,L]),D=a.useCallback(()=>{L(z),B(!1),M("")},[z,L]);a.useEffect(()=>{R&&""===I&&(B(!1),M(""))},[I,R]);let q=e?a.createElement(i.K,{onClick:()=>{v(C.to({type:ea,data:{chatMessagesNodeGuid:m}}))},"aria-label":s.length>=G.qQ?(0,k.t)("sites.panel.make.attach_limit_reached",{limit:G.qQ}):(0,k.t)("sites.panel.make.attach_design"),"data-tooltip-show-above":!0,disabled:c||s.length>=G.qQ},a.createElement(u,null)):null,P=t?a.createElement(a.Fragment,null,a.createElement("input",{type:"file",className:"x1s85apg",ref:w,accept:T.xp.join(","),onChange:F}),a.createElement(i.K,{"aria-label":s.length>=G.qQ?(0,k.t)("sites.panel.make.attach_limit_reached",{limit:G.qQ}):(0,k.t)("sites.panel.make.attach_image"),"data-tooltip-show-above":!0,disabled:c||s.length>=G.qQ,onClick:()=>{w.current?.click()}},a.createElement(d.T,null))):null;return t||e?a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x167g77z"},(0,g.k)().bake_chat_attach_menu?a.createElement(rc,{enableAssetImport:e,enableImageAttachment:t,attachments:s,isViewOnly:c,chatMessagesNodeGuid:m,createLoadedAttachment:o}):a.createElement(a.Fragment,null,q,P),a.createElement(lo,{disabled:c||(0,b.jN)(I)||h,onClick:$,onUndo:D,isEnhanced:R}),n&&a.createElement(lr,{isViewOnly:c,hasMessages:y,libraryImports:_,disabled:f||c}),(0,g.k)().bake_click_to_inspect&&S&&a.createElement(j.l,{disabled:c,componentPreview:S,onboardingKey:O.kx,showTooltipAbove:!0})):a.createElement("div",null)}function lc({setInput:e,chatMessagesNodeGuid:t,chatMessagesForDisplay:n,exchangeMessages:r,layerDisplayName:l,codeFileChanges:i,sendMessage:o,emptyState:s,sendDisabled:c,enableAssetImport:u=!1,enableImageAttachment:d=!1,showChatHeader:x=!1,featureType:h,enableDragUpload:f=!1,enableDsImport:E=!1,isResizingPanel:b,isLastUserMessageAutoErrorFix:C,messagesForRendering:w,clientLifecycleIdMap:N,showCodeStreaming:O}){let j=(0,I.ry)(),F=(0,A.s0)(t),$=(0,g.k)().bake_client_side_context_limit||!1,{Sprig:D}=(0,_.A)(),P=(0,ll.Go)(n),H=function(e){let{allDsImportReadyLibraries:t,allDsImportReadyLibrariesRequestStatus:n}=rS();return a.useMemo(()=>{if(!e)return null;let a=e.map(e=>e.type!==m.K$p.USER_MESSAGE?null:(0,na.MK)(e.textContent||"").libraryKey).filter(e=>!!e);if(0===a.length)return null;let r=a[a.length-1];if("loaded"===n){let e=t?.find(e=>e.library_key===r);return e?{type:"LIBRARY",library:e}:{type:"LIBRARY",library:rv}}return"loading"===n?{type:"LIBRARY",library:rk}:{type:"LIBRARY",library:rv}},[t,e,n])}(n),{exchange:U,user:X}=(0,A.$W)(t),J=[...n||[],...(0,ll.Qf)(U?.messages)||[]],Q=(0,a.useRef)(null),ee=(0,a.useRef)(null);a.useEffect(()=>{Q.current&&Q.current.focus()},[]),function(e,t){let n=(0,Y.eY)(),r=m.Ez5.figmakeState(),l=(0,Z.J2)(r.pastedNodeGuid),i=(0,K.ZC)(l),{attachments:o,setAttachments:s,claimAPendingAttachmentOrMakeOne:c}=(0,G._9)(e);a.useEffect(()=>{l!==i&&en(l,n,s,t,c)},[n,s,i,o,l,t,c])}(t,n=>{if(!Q.current)return;let a=Q.current.selectionStart,r=Q.current.selectionEnd,l=p.zl.get((0,A.mC)(t));e(l.substring(0,a)+n+l.substring(r))});let{attachments:et,stashAllAttachments:ea,createLoadedAttachment:er,attachmentsReady:el}=(0,G._9)(t),{selectedElement:ei,selectedElementCodeSnippet:eo}=(0,z.fl)(),{setChatError:es,chatError:ec,clearChatError:eu}=(0,te.tk)(t),[ed,em]=a.useState(!0),ex=a.useRef(!1);a.useMemo(()=>{(()=>{let e=p.zl.get((0,A.mC)(t)).length,{figmaNodeLength:n,imageTokens:a,figmaNodeCount:r,imageCount:l}=et.reduce((e,t)=>{if("success"!==t.status)return e;if("FIGMA_NODE"===t.type){let n=t.codeFiles.reduce((e,t)=>e+t.code.length,0);return{figmaNodeLength:e.figmaNodeLength+n,imageTokens:e.imageTokens,figmaNodeCount:e.figmaNodeCount+1,imageCount:e.imageCount}}if("IMAGE"===t.type){let n=t.image?.length/750||0;return{figmaNodeLength:e.figmaNodeLength,imageTokens:e.imageTokens+n,figmaNodeCount:e.figmaNodeCount,imageCount:e.imageCount+1}}return e},{figmaNodeLength:0,imageTokens:0,figmaNodeCount:0,imageCount:0}),i=ei&&eo?(0,M.F)(ei,eo):void 0,o=e/3,s=n/3,c=(i?JSON.stringify(i).length:0)/3,u=o+s+c+a,d=u<=15e4;d!==ex.current&&(d||y.definedAnalyticsHandler.trackDefinedEvent("ai_for_production.code_chat_client_side_context_limit_exceeded",{total_number_of_tokens_estimate:u,image_tokens_estimate:a,figma_node_tokens_estimate:s,text_tokens_estimate:o,point_and_prompt_tokens_estimate:c,text_character_count:e,image_attachment_count:l,figma_node_attachment_count:r,direct_selection_count:ei?1:0}),ex.current=d,em(d))})()},[t,et,ei,eo]),a.useEffect(()=>{ed||ec?.error.message===te.T_.MAX_CONTENT_LENGTH_EXCEEDED?ed&&ec?.error.message===te.T_.MAX_CONTENT_LENGTH_EXCEEDED&&eu():es({error:Error(te.T_.MAX_CONTENT_LENGTH_EXCEEDED)})},[ed,ec,es,eu]);let{communityAttribution:eg}=(0,V.Pe)(),ep=(0,B.Oc)(),eh=(0,R._A)(),{libraryImport:ef,stashLibraryImport:ey,setFrozenOnLibaryImport:eE}=rC(),e_=async({message:e,errors:t,hidden:n,isUserInput:a=!1})=>{if(!j&&(e||n))try{eu();let r=function(e,t){let n=(0,q.UN)(),a=[],r=e.filter(e=>"success"===e.status&&"FIGMA_NODE"===e.type).map(e=>{let a=e.codeFiles.map(e=>{let t=n.get(e.codeFileGuid);return t?(W.l7.ai("set-code-file-path",()=>{t.codeFilePath=eW.zM}),{fullFilePath:t.codeFileFullPathWithoutScheme,code:t.sourceCode,codeFileGuid:t.guid}):(console.error("codeFileNode not found",{codeFileAttachment:e}),null)}).filter(e=>!!e);return{type:"node",guid:e.nodeGuid,codeFiles:a,communityAttribution:t.get(e.nodeGuid),image:(0,g.k)().bake_d2r_image?e.image??void 0:void 0}}),l=e.filter(e=>"success"===e.status&&"IMAGE"===e.type).map(e=>({type:"image",guid:e.nodeGuid,image:e.image,imageHash:(0,g.k)().bake_image_include_hash?e.imageHash??void 0:void 0}));return a.push(...r),a.push(...l),a}(et,eg);ea(),eE(!0);let l=ei&&eo?(0,M.F)(ei,eo):void 0,i={plainText:e,libraryKey:ef?.library.library_key,imports:r,inspectedElement:l,errors:t,hidden:n},s=(0,li.u)(e||"",r,ei?.elementAndParentSources);await o(i,s),ey(),(0,g.k)().bake_sprig&&h===e9.lV.FIGMAKE&&a&&P>=2&&D("track","bake_survey_1_3_chats_sent")}catch(e){eE(!1),es(e instanceof Error?{error:e}:{error:Error("Unknown error")})}},eb=async e=>{if(!(ep&&eh()))return await e_({...e,isUserInput:!0})};!function({enabled:e,chatMessagesNodeGuid:t,chatMessages:n,setInput:r,sendMessage:l}){let[i,o]=a.useState(!1),s=(0,p.md)(A.lA);a.useEffect(()=>{e&&t&&n&&s&&!i&&(r(s),l({message:s}),o(!0))},[t,n,s,i,e])}({enabled:h===e9.lV.FIGMAKE,chatMessagesNodeGuid:t,chatMessages:n,setInput:e,sendMessage:e_});let ev=(0,S.KP)(),ek=void 0!==U&&U.messages.length>0,eC=(0,L.Wn)(t);!function({chatMessagesNodeGuid:e,featureType:t}){let{exchange:n,user:r}=(0,A.$W)(e),l=void 0!==n&&n.messages.length>0,i=(0,eL.tS)(),o=(0,no.iZ)();a.useEffect(()=>{if(!l||!i||r?.userID!==o?.id)return;let e=e=>{let a;e.preventDefault(),e.returnValue=!0;let r=n.messages[0];r&&r.type===m.K$p.USER_MESSAGE&&(a=(0,na.MK)(r.textContent).requestUuid),y.definedAnalyticsHandler.trackDefinedEvent("ai_for_production.unsaved_changes_warning_shown",{fileKey:i,featureType:t,requestUuid:a,userMessageId:r?.id})};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[l,i,t,n?.messages,r?.userID,o?.id])}({chatMessagesNodeGuid:t,featureType:h});let{enhancePrompt:eS,isEnhancing:ew}=function(e){let[t,n]=(0,a.useState)(!1),{setChatError:r,clearChatError:l}=(0,te.tk)(e);return{enhancePrompt:(0,a.useCallback)(async function*(e){let t;if(!e.trim())return e;n(!0),l();try{t=(await rw.Ay.shared.figmakeEnhancePrompt({prompt:e},{...(0,eI.Ay)()})).getReader();let n="";for(;;){let{done:e,value:a}=await t.read();if(e)break;n+=a.delta,yield n}return n}catch(t){let e=t instanceof Error?t:Error("Failed to enhance prompt");throw r({error:Error(te.T_.PROMPT_ENHANCEMENT_FAILED)}),e}finally{t?.releaseLock(),n(!1)}},[r,l]),isEnhancing:t}}(t),eT=!ek&&el&&!eC&&(ed||!$)&&!ew,eN=J?.length?(0,k.t)("living_designs.chat.placeholder.iterate"):(0,k.t)("living_designs.chat.placeholder.blank_slate"),[eA,ez]=a.useState(!1),eM=async e=>{if(j||!d||!f||0===e.files.length||e.files.length>G.qQ)return;let t=Array.from(e.files).map(async e=>{e&&T.xp.some(t=>e.type.startsWith(t.replace("*","")))&&await (0,rs.z)(e,er)});await Promise.all(t),ez(!1)},eR=(0,a.useMemo)(()=>new Set(r.map(e=>e.id)),[r]),eO=(0,g.k)().bake_chat_virtualization?a.createElement(ra,{chatMessagesNodeGuid:t,clientLifecycleIdMap:N,dragOverlay:eA?a.createElement(rp,null):void 0,emptyState:s,exchangeMessageIds:eR,featureType:h,isResizingPanel:b,layerDisplayName:l,messagesForRendering:w,showCodeStreaming:O}):a.createElement(rr,{chatMessagesNodeGuid:t,exchangeMessageIds:eR,dragOverlay:eA?a.createElement(rp,null):void 0,emptyState:s,featureType:h,layerDisplayName:l,messagesForRendering:w,clientLifecycleIdMap:N,showCodeStreaming:O}),ej=(0,g.k)().bake_manual_edits;return a.createElement("div",{className:"x78zum5 xdt5ytf xh8yej3 x5yr21d",ref:ee},a.createElement("div",{className:"x1n2onr6 xh8yej3 x5yr21d x78zum5 xdt5ytf"},x&&a.createElement(nt,{showAiBetaBadge:h!==e9.lV.FIGMAKE}),eO,a.createElement(rx,{typingUsers:F}),a.createElement("div",{className:"x10l6tqk xu96u03 x3m8u43 x1vqgdyp x47corl x1ey2m1c xf5q8oo"})),ej&&!ek&&a.createElement(lu,{chatMessagesNodeGuid:t,featureType:h,codeFileChanges:i}),a.createElement(v.Y,{isDragTarget:()=>f,onTargetDragEnter:()=>ez(!0),onTargetDragLeave:()=>ez(!1),onTargetDrop:eM},a.createElement(t8,{ref:Q,canCancelGeneration:X?.sessionID===ev,canSend:eT&&!c,chatBoxExtraContent:a.createElement(ls,{attachments:et,chatMessagesNodeGuid:t,createLoadedAttachment:er,enableAssetImport:u,enableDsImport:E,enableImageAttachment:d,enhancePrompt:eS,generationInProgress:ek,hasMessages:J.length>0,isEnhancing:ew,isViewOnly:j,libraryImports:H}),chatContainerRef:ee,chatMessageCount:J.length,chatMessagesNodeGuid:t,errorFixingDisabled:ek,generationInProgress:ek,inspectedElement:ei,isDraggingAttachment:eA,isLastUserMessageAutoErrorFix:C,placeholderText:eN,sendMessage:({message:e,errors:n})=>eb({message:e??p.zl.get((0,A.mC)(t)),errors:n}),showPasteDesignsCallout:ep&&u&&!j&&0===J.length&&0===et.length})))}function lu({chatMessagesNodeGuid:e,featureType:t,codeFileChanges:n}){if(!n)return null;let{changedFiles:r,error:l,hasBaseline:i}=n;return l||!i?null:a.createElement("div",{style:{padding:"0 16px 8px"}},a.createElement(a2,{changes:r,maxHeight:"140px",chatMessagesNodeGuid:e,featureType:t}))}function ld(e,t,n){return(0,a.useMemo)(()=>{let a,r;let l=new Map;return e.forEach(e=>{switch(e.type){case m.K$p.ASSISTANT_MESSAGE:case m.K$p.SYSTEM_MESSAGE:r=e.id;break;case m.K$p.USER_MESSAGE:r&&a&&l.set(r,(0,nM.Pd)(t,n,a)),r=void 0,a=e.id}}),r&&a&&l.set(r,(0,nM.Pd)(t,n,a)),l},[e,t,n])}function lm(e){let t=(0,w.zy)(e),n=(0,a.useRef)(null);return(0,a.useMemo)(()=>{let e=JSON.stringify(t.usersById);return n.current!==e&&(n.current=e),t},[t])}},829036:(e,t,n)=>{n.d(t,{q:()=>i});var a=n(848318),r=n(989232),l=n(897659);function i(e,t,n,i){let[o,s]=a.useState({selectedFeedback:null,shouldShowAdditionalFeedback:!1}),{persistentEntityId:c,clientLifecycleId:u}=e,d=n===l.lV.FIGMAKE?"figmake":"sites",m=a.useCallback((e,a,l)=>{u&&r.definedAnalyticsHandler.trackDefinedEvent("ai_for_production.chat_feedback",{feedbackType:e,productType:d,feedback:a,messageId:l.id,fileKey:t||void 0,featureType:n,persistentEntityId:c,clientLifecycleId:u})},[t,n,u,c,d]);return{feedbackState:o,setFeedbackState:s,sentimentFeedbackCallback:a.useCallback((e,t)=>{m(e.toString(),t,i)},[i,m]),additionalFeedbackCallback:a.useCallback((e,t)=>{m(e.toString(),t,i)},[i,m]),productType:d}}},579556:(e,t,n)=>{n.d(t,{t:()=>s});var a=n(848318),r=n(909678),l=n(186606),i=n(162293),o=n(369231);function s(e,t){return(0,a.useMemo)(()=>{let n=[],a=!1;for(let s=0;s<e.length;s++){let c=e[s];switch(c.type){case l.K$p.USER_MESSAGE:let u=t.usersById?.[c.userId];if(u){let e=(0,r.MK)(c.textContent||""),t=(0,i.gG)(e);e.hidden||n.push({type:"user",message:c,user:u}),a=t}continue;case l.K$p.SYSTEM_MESSAGE:let d=(0,r.U1)(c.textContent||""),m=d?.type==="manual_edit"||d?.type==="restore"?d?.title:void 0;n.push({type:"system",message:c,title:m}),a=!1;continue;case l.K$p.ASSISTANT_MESSAGE:let x=[c],g=(0,r.lr)(c.textContent||"").title,p=s;for(let t=s+1;t<e.length;t++){let n=e[t];if(!n)break;let a=(0,r.lr)(n.textContent||"");g||=a.title;let i=!0===a.hidden,s=n.type===l.K$p.SYSTEM_MESSAGE,c=n.type===l.K$p.ASSISTANT_MESSAGE,u=n.type===l.K$p.TOOL_MESSAGE;if(c||i&&s||u)p=t;else break;if(u){let e=n.toolResults[0];if(!e)continue;let t=x[x.length-1];if(!t||!t.toolCalls.find(t=>t.toolCallId===e.toolCallId&&t.toolName===e.toolName))continue;if(t.toolResults.push(e),(0,o.d4)(e.toolName))break}else x.push(n)}n.push({type:"assistant",messages:x,isAutoErrorFix:a,title:g}),a=!1,s=p;continue;case l.K$p.TOOL_MESSAGE:continue}}return n},[e,t])}},198629:(e,t,n)=>{n.d(t,{R:()=>el,O:()=>es});var a=n(848318),r=n(301168),l=n(100433),i=n(909678),o=n(658029),s=n(143823),c=n(878339),u=n(348154),d=n(549699),m=n(320953);n(82433);var x=n(19180),g=n(382902),p=n(238462),h=n(810503),f=n(967688),y=n(952039),E=n(142896),_=n(959750),b=n(17753),v=n(614892),k=n(494604),C=n(748790),S=n(551011),w=n(255130),T=n(264530),N=n(323209),A=n(958662);function I({isChatVisible:e,setIsChatVisible:t,disabled:n}){return a.createElement(N.f,{onChange:()=>t(!e),"aria-label":(0,f.t)("sites.panel.chat_tooltip"),checked:e,offIcon:a.createElement(A.C,null),onIcon:a.createElement(A.C,null),variant:"highlighted",disabled:n,recordingKey:"codeChatButton"})}var L=n(897659),z=n(495243),M=n(254028);class R{constructor(e){this.userScrolled=!1,this.handleUserScroll=()=>{this.userScrolled=!0},this.view=e,e.scrollDOM.addEventListener("wheel",this.handleUserScroll),e.scrollDOM.addEventListener("mousedown",this.handleUserScroll),e.scrollDOM.addEventListener("touchstart",this.handleUserScroll),e.scrollDOM.addEventListener("scroll",()=>{this.isNearBottom()&&(this.userScrolled=!1)})}isNearBottom(){let e=this.view.scrollDOM;return(e.scrollTop+e.clientHeight)/e.scrollHeight>=.9}isAutoScrollAllowed({checkNearBottom:e}){return!this.userScrolled||e&&this.isNearBottom()}destroy(){this.view.scrollDOM.removeEventListener("wheel",this.handleUserScroll),this.view.scrollDOM.removeEventListener("mousedown",this.handleUserScroll),this.view.scrollDOM.removeEventListener("touchstart",this.handleUserScroll)}}class O{constructor(){this.handlers=[]}register(e){this.handlers.push(e)}unregister(e){let t=this.handlers.indexOf(e);-1!==t&&this.handlers.splice(t,1)}setText(e){for(let t of this.handlers)t.setText(e)}appendText(e){for(let t of this.handlers)t.appendText(e)}}class j extends R{constructor(e,t){super(t),this.trigger=e,this.editorView=t,e.register(this)}setText(e){try{let t=this.editorView.state.doc.toString();if(e!==t){if(e.startsWith(t)){let n=e.slice(t.length);return this.appendText(n)}this.editorView.dispatch({changes:[{from:0,to:t.length,insert:e}]})}}catch(t){let e=(0,M.aI)()?L.lV.FIGMAKE:L.lV.CODE_IN_SITES;(0,L.Ho)(t,e,L.a5.EDIT_LOCALLY,{editorViewState:JSON.stringify(this.editorView.state)})}}appendText(e){this.editorView.dispatch({changes:[{from:this.editorView.state.doc.length,insert:e}],...this.isAutoScrollAllowed({checkNearBottom:!0})?{selection:{anchor:this.editorView.state.doc.length-this.editorView.state.doc.lineAt(this.editorView.state.doc.length-1).length},scrollIntoView:!0}:{}})}destroy(){this.trigger.unregister(this)}}var B=n(316631),F=n(947943),$=n(182656),D=n(444747),q=n(562612),P=n(186606);let H=l.Lz.baseTheme({".cm-remoteSelection":{display:"inline-block",height:"100%"},".cm-remoteLineSelection":{padding:0,margin:"0px 2px 0px 6px"},".cm-remoteSelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-remoteSelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-remoteSelectionCaret:hover > .cm-remoteSelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-remoteSelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-remoteSelectionCaret:hover > .cm-remoteSelectionInfo":{opacity:1,transitionDelay:"0s"}});class U extends l.xO{constructor(e,t,n){super(),this.color=e,this.name=t,this.sessionId=n}toDOM(){let e=document.createElement("span");e.className="cm-remoteSelectionCaret",e.style.backgroundColor=this.color,e.style.borderColor=this.color;let t=document.createElement("div");t.className="cm-remoteSelectionCaretDot";let n=document.createElement("div");return n.className="cm-remoteSelectionInfo",n.appendChild(document.createTextNode(this.name)),e.textContent="",e.appendChild(document.createTextNode("\u2060")),e.appendChild(t),e.appendChild(document.createTextNode("\u2060")),e.appendChild(n),e.appendChild(document.createTextNode("\u2060")),e}eq(e){return e.sessionId===this.sessionId}compare(e){return e.sessionId===this.sessionId}updateDOM(){return!1}get estimatedHeight(){return -1}ignoreEvent(){return!0}}function G(e,t){let n=e.caretAtFront?e.widecharPositionStart:e.widecharPositionEnd,a=[{from:n,to:n,value:l.NZ.widget({side:e.caretAtFront?1:-1,block:!1,widget:new U(e.color,e.userName,e.sessionId)})}];if(e.widecharPositionEnd>e.widecharPositionStart){let n=e.color+"33",r=e.widecharPositionStart,i=e.widecharPositionEnd,o=t.lineAt(r),s=t.lineAt(i);if(o.number===s.number)a.push({from:r,to:i,value:l.NZ.mark({attributes:{style:`background-color: ${n}`},class:"cm-remoteSelection"})});else{a.push({from:r,to:o.to,value:l.NZ.mark({attributes:{style:`background-color: ${n}`},class:"cm-remoteSelection"})}),a.push({from:s.from,to:i,value:l.NZ.mark({attributes:{style:`background-color: ${n}`},class:"cm-remoteSelection"})});for(let e=o.number+1;e<s.number;e++){let r=t.line(e).from;a.push({from:r,to:r,value:l.NZ.line({attributes:{style:`background-color: ${n}`},class:"cm-remoteLineSelection"})})}}}return a}let V=l.Pe.define({}),W=l.YH.define(),K=class e{constructor(t,n,a=()=>{},r){this.getCollaborativeText=t,this.editorView=n,this.logVerbose=a,this.onLocalChanges=r,this.collaborativeTextObserverHandle=null,this.collaborativeTextObserverHandle=this.collaborativeText.addObserver(this),this.cmAnnotation=e.nextAnnotation++,this.checkForDocMismatch(this.editorView.state.doc,"CodeMirror initialization")}get collaborativeText(){let e=this.getCollaborativeText();if(!e)throw Error("Collaborative text is not available");return e}onOperations(e,t){if(this.logVerbose("Collaborative Text","CodeMirror received ops from collaborative text",{matchesOurLocalTag:t===this.collaborativeTextObserverHandle,operations:e}),t===this.collaborativeTextObserverHandle)return;let n=[],a=[W.of(this.cmAnnotation)];for(let t of e)"insert"===t.type&&void 0!==t.text?n.push({changes:{from:t.widecharPosition,to:t.widecharPosition,insert:t.text},annotations:a,sequential:n.length>0,selection:t.updateCursor?{anchor:t.widecharPosition+t.widecharLength,head:t.widecharPosition+t.widecharLength}:void 0}):"delete"===t.type&&void 0!==t.widecharLength&&n.push({changes:{from:t.widecharPosition,to:t.widecharPosition+t.widecharLength,insert:""},annotations:a,sequential:n.length>0,selection:t.updateCursor?{anchor:t.widecharPosition,head:t.widecharPosition}:void 0});n.length>0&&this.editorView.dispatch(this.editorView.state.update(...n)),this.checkForDocMismatch(this.editorView.state.doc,"after applying remote edits")}onRemoteCursorsChanged(){this.editorView.dispatch({effects:[V.of()]})}textDidReload(){this.logVerbose("Collaborative Text","CodeMirror reloading text from history");let e=this.collaborativeText.computeCurrentText(),t=this.editorView.state.doc;this.editorView.dispatch({changes:[{from:0,to:t.length,insert:e}],annotations:[W.of(this.cmAnnotation)]})}onUnrecoverableBugError(){setTimeout(()=>{let e=l.Pe.appendConfig.of(l.$t.readOnly.of(!0));this.editorView.dispatch({effects:[e]})})}update(e){if(this.relayTextUpdatesToCollaborativeText(e),P.h3O){if(e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus()){let t=e.state.selection.main,n=t.to-t.from,a=n>0&&t.head===t.from;P.h3O.sendCollaborativeTextCursorPosition(t.from,n,a,this.collaborativeText)}else P.h3O.clearCollaborativeTextCursorPosition()}}relayTextUpdatesToCollaborativeText(e){if(!e.docChanged||0===e.transactions.length)return;let t=e.transactions.filter(e=>e.annotation(W)!==this.cmAnnotation);0!==t.length&&(this.logVerbose("Collaborative Text","CodeMirror informed us of local changes",{nonCollabTransactions:t}),this.checkForDocMismatch(e.startState.doc,"before CodeMirror updates are applied"),m.l7.user("codemirror-local-edit",()=>{for(let e of(this.collaborativeText.startBatch(),t))e.changes.iterChanges((e,t,n,a,r)=>{let l=r.sliceString(0,r.length,"\n");if(e!==t){let a=t-e;this.collaborativeText.createDeletionOp(n,a,!0,this.collaborativeTextObserverHandle??0)}l.length>0&&this.collaborativeText.createInsertionOp(n,l.length,l,this.collaborativeTextObserverHandle??0)});P.glU?.requestNextCommitMergeWithPrevious(P.zvt.COLLABORATIVE_TEXT_EDIT),this.collaborativeText.endBatch(),P.glU?.commit(),this.checkForDocMismatch(e.state.doc,"after Codemirror edits applied"),this.onLocalChanges?.()}))}checkForDocMismatch(e,t){this.collaborativeText.isInUnrecoverableBugErrorState()||e.length===this.collaborativeText.textLengthInWideChars()||this.logVerbose("CollaborativePlainTextCodeMirrorExtension","Collaborative text and editor state are out of sync. This is probably a bug.",{collabText:this.collaborativeText.computeCurrentText(),doc:e.toString(),actionContext:t})}destroy(){let e=this.getCollaborativeText();e&&null!==this.collaborativeTextObserverHandle&&(e.removeObserver(this.collaborativeTextObserverHandle),this.collaborativeTextObserverHandle=null),P.h3O&&P.h3O.clearCollaborativeTextCursorPosition()}};K.nextAnnotation=1;var X=n(980849);class Y{constructor(){this.handlers=[],this.inFlightFormatRequests=new Map}register(e){this.handlers.push(e)}async format(){for(let e of this.handlers){if(this.inFlightFormatRequests.has(e)){await this.inFlightFormatRequests.get(e);continue}let t=e.onFormatTriggered().finally(()=>{this.inFlightFormatRequests.delete(e)});this.inFlightFormatRequests.set(e,t),await t}}}class Z{constructor(e,t,n){this.parserName=t,this.editorView=n,this.documentEditCounter=0,e.register(this)}async onFormatTriggered(){for(let e=0;e<3;e++){let e=this.editorView.state.doc.toString(),t=this.documentEditCounter,n=await (0,X.IC)(e,this.parserName);if(this.documentEditCounter===t)return n.length>0&&this.editorView.dispatch({changes:n}),Promise.resolve()}return Promise.reject()}update(e){e.docChanged&&0!==e.transactions.length&&this.documentEditCounter++}}class J{constructor(e,t,n){this.codeFileGuid=e,this.atom=t,this.editorView=n,this.unsubscribe=g.zl.sub(t,()=>{this.checkForAtomEvent()}),g.zl.get(t)&&setTimeout(()=>{this.checkForAtomEvent()},0)}destroy(){this.unsubscribe()}checkForAtomEvent(){let e=g.zl.get(this.atom);if(e?.codeFileGuid!==this.codeFileGuid)return;let{fromCharIndex:t,toCharIndex:n}=e;this.goToRange(t,n),g.zl.set(this.atom,null)}goToLineAndColumn(e,t){let n=this.editorView.state.doc,a=Math.max(Math.min(e,n.lines),1),r=a===e?Math.max(Math.min(t,n.line(a).length),1):n.line(a).length;this.goToRange(n.line(a).from+r-1)}goToRange(e,t){this.editorView.dispatch({selection:{anchor:e,head:t},scrollIntoView:!0}),this.editorView.focus()}}class Q{constructor(){this.handlers=[]}register(e){this.handlers.push(e)}unregister(e){let t=this.handlers.indexOf(e);-1!==t&&this.handlers.splice(t,1)}setHighlightText(e,t,n){for(let a of this.handlers)a.setHighlightText(e,t,n)}}class ee extends R{constructor(e,t){super(t),this.trigger=e,this.editorView=t,this.findText="",this.originalPositions=[],this.replaceText="",this.decorationsField=l.sU.define({create:()=>this.decorations,update:(e,t)=>this.decorations,provide:e=>l.Lz.decorations.from(e)}),e.register(this),this.decorations=l.NZ.none}setHighlightText(e,t,n){let a=this.editorView.state.doc.toString();if(!this.replaceText){this.findText=e;let t=0;for(this.originalPositions=[];-1!==(t=a.indexOf(this.findText,t));)this.originalPositions.push(t),t+=this.findText.length}let r=[],i=[];if(t){let e=this.replaceText?this.replaceText.length:this.findText.length,n=this.replaceText?this.originalPositions.map((e,t)=>e+(this.replaceText.length-this.findText.length)*t):this.originalPositions;for(let a=0;a<n.length;a++){let l=n[a];i.push(l+(t.length-e)*a),r.push({from:l,to:l+e,insert:t})}this.replaceText=t}let o=-1,s=[];if(this.replaceText){for(let e of i)s.push(l.NZ.mark({class:"cm-replaced-text"+(n?"-done":"")}).range(e,e+this.replaceText.length));o=r.reduce((e,t)=>Math.max(e,t.to),0)}else for(let e of this.originalPositions)s.push(l.NZ.mark({class:"cm-highlighted-text"}).range(e,e+this.findText.length)),o=Math.max(o,e+this.findText.length);let c=o<0?void 0:this.editorView.state.doc.lineAt(o).from;this.decorations=l.NZ.set(s),this.editorView.dispatch({changes:r,effects:[en.of(!0)],...c&&this.isAutoScrollAllowed({checkNearBottom:!1})?{selection:{anchor:c},scrollIntoView:!0}:{}})}destroy(){this.trigger.unregister(this)}}let et=l.Lz.baseTheme({".cm-highlighted-text":{backgroundColor:"#ff000033"},".cm-replaced-text":{backgroundColor:"#00ff0033"},".cm-replaced-text-done":{backgroundColor:"#00ff0033",animation:"fadeOutGreenHighlight 1s ease-out forwards"},"@keyframes fadeOutGreenHighlight":{from:{backgroundColor:"#00ff0033"},to:{backgroundColor:"transparent"}}}),en=l.Pe.define(),ea=(e,t,n)=>{(0,_.UK)().toggleCollaborativeTextDebugLogging.getCopy()&&(0,h.Lo)(e,t,n)},er=()=>!(0,z._H)();function el({codeFile:e,maxHeight:t,fullHeight:n,isChatVisible:s,setIsChatVisible:h,nodeWithChatMessages:_,downloadCode:N}){let A=e?.codeFileFullPathWithoutScheme??"tmp-code.tsx",z=_??e,R=z?.guid,O=e?.guid,j=e?.isSubscribedAsset,q=(0,$.OV)(e),U=q&&!q.hasNeverBeenEdited(),{exchange:W}=(0,w.$W)(z?.guid),X=(0,g.md)(S.kb),{code:Q,edits:ee}=function(e,t){let n=!!e&&e.messages.length>0,a={};if(n){let n=e?.messages[e.messages.length-1],r=(0,i.lr)(n?.textContent||""),l=e.fileUpdates.find(e=>e.name===t);r.edits?a={edits:r.edits}:r.code?a={code:r.code}:l&&(a={code:l.contents})}return a}(W,A),et=(0,a.useCallback)(()=>{if(O){let e=D.O.get(O);e&&(e.hasUserEdited=!0),g.zl.set((0,T.Nm)(R),"user")}},[O,R]),en=(0,a.useCallback)((e,t,n)=>{ea(e,`[GUID(${O})] ${t}`,n)},[O]),el=(0,a.useCallback)(()=>U?e?.collaborativeSourceCode??null:null,[U,e]),eo=a.useMemo(()=>U&&q?l.Z9.define(e=>new K(el,e,en,et),{provide:()=>{let e=el();if(!e)return[];let t=[];if(e.isInUnrecoverableBugErrorState()&&t.push(l.$t.readOnly.of(!0)),P.h3O){var n;t.push((n=()=>P.h3O?P.h3O.computeCollaborativeTextRemoteCursorPositions(e):[],l.sU.define({create:e=>l.NZ.set(n().flatMap(t=>G(t,e.doc)),!0),update(e,t){for(let e of t.effects)if(e.is(V))return l.NZ.set(n().flatMap(e=>G(e,t.state.doc)),!0);return e.map(t.changes)},provide:e=>[l.Lz.decorations.from(e),H]})))}return t}}):null,[U,q,el,en,et]),es=(0,a.useCallback)(t=>{q&&q.hasNeverBeenEdited()?(en("Collaborative Text","Initializing collaborative text"),q.startBatch(),q.createInsertionOp(0,t.length,t,0),q.endBatch()):e&&(m.l7.user("edit-code-file-code",()=>{e.sourceCode=t}),et())},[e,q,en,et]),ec=(0,r.wA)(),eu=(0,$.b_)();(0,$.pO)();let ed=A?/\.(ts|tsx)$/i.test(A)?"typescript":/\.(css)$/i.test(A)?"css":/\.(md|mdx)$/i.test(A)?"markdown":null:null,em=(0,a.useMemo)(()=>new Y,[]),ex=(0,a.useMemo)(()=>ed?l.Z9.define(e=>new Z(em,ed,e)):null,[em,ed]),eg=(0,a.useCallback)(async()=>{try{await em.format(),ec(y.F.enqueue({message:(0,f.t)("sites.code_component.format_code_success"),error:!1}))}catch(e){(0,L.Ho)(e,L.lV.CODE_IN_SITES,L.a5.FORMAT),ec(y.F.enqueue({message:(0,f.t)("sites.code_component.format_code_error",{message:e.message.split("\n")[0]}),error:!0}))}},[ec,em]),ep=a.useMemo(()=>l.w4.of([{key:"Mod-s",stopPropagation:!0,preventDefault:!0,run:()=>(eg(),!0)}]),[eg]),eh=(0,a.useMemo)(()=>O?l.Z9.define(e=>new J(O,S.JL,e)):null,[O]),ef=(0,a.useMemo)(()=>[ex,ep,eo,eh].filter(Boolean),[ex,eo,ep,eh]),ey=W&&W.messages.length>0,eE=er()&&!j&&!ey,e_=(0,a.useCallback)(()=>U?e?.collaborativeSourceCode?.computeCurrentText():e?.sourceCode,[e,U]),eb=(0,C.uQ)(),ev=(0,x.k)().sites||(0,x.k)().sts_code,ek=(0,M.aI)(),eC=(0,M.Oc)(),eS=(0,F.Wn)(O);if(!ek&&!ev||!e_)return null;let ew=U?q?.handle:`non-collab-${R}-${X}`;return a.createElement(v.Zk,{className:"x5yr21d x9f619 x78zum5 xdt5ytf x1iyjqo2 x18d9i69 x1y1aw1k x87ps6o xb3r6kr"},eC&&a.createElement("div",{className:"xh8yej3"},a.createElement(k.Wv,{titleTx:a.createElement(B.p,{codeFile:e,disabled:eS||!eE})},eu&&a.createElement(o.K,{"aria-label":(0,f.t)("sites.panel.code_component_multiplayer_warning"),onClick:p.lQ,htmlAttributes:{"data-tooltip":(0,f.t)("sites.panel.code_component_multiplayer_warning"),"data-tooltip-type":b.Ib.TEXT}},a.createElement(c.R,null)),ex&&eE&&a.createElement(o.K,{"aria-label":(0,f.t)("sites.panel.format_code_tooltip"),htmlAttributes:{"data-tooltip":(0,f.t)("sites.panel.format_code_tooltip"),"data-tooltip-type":b.Ib.TEXT},onClick:eg,disabled:!!Q},a.createElement(u.m,null)),N&&a.createElement(o.K,{"aria-label":(0,f.t)("figmake.code_editor.download_code"),onClick:N},a.createElement(d.V,null)),eb&&h&&a.createElement(I,{isChatVisible:s??!1,setIsChatVisible:h}))),a.createElement("div",{className:E.Dm,className:"x78zum5 xdt5ytf x1iyjqo2 x2lwn1j xb3r6kr"},a.createElement(ei,{codeFile:e,codeMirrorInstanceKey:ew,disableUndoRedoExtension:!!U,extensions:ef,fileName:A,formatCode:eg,fullHeight:n,initialText:e_,isEditable:eE,isFigmake:eC,isGenerating:eS,maxHeight:`${t}px`,onChange:U?void 0:es,streamingCodeToDisplay:Q,streamingEditsToDisplay:ee})))}function ei({isGenerating:e,isEditable:t,streamingCodeToDisplay:n,streamingEditsToDisplay:r,fileName:l,fullHeight:i=!1,maxHeight:o,codeMirrorInstanceKey:s,disableUndoRedoExtension:c,extensions:u,initialText:d,formatCode:m,onChange:x,codeFile:g,isFigmake:p}){if(e)return a.createElement("div",{className:"x1n2onr6 xh8yej3 x5yr21d"},a.createElement(q.d,{disableUndoRedoExtension:c,editable:!1,extensions:[],fileName:l,fullHeight:i,initialText:()=>"",maxHeight:o,placeholder:(0,f.t)("living_designs.converting_design_to_code"),codeFile:p?null:g}),e&&a.createElement(ec,null));if(r){let e=Object.entries(r)[0];return a.createElement(eo,{initialText:d,edit:e[1],fileName:l,fullHeight:i,maxHeight:o})}return n?a.createElement(es,{code:n,fileName:l,fullHeight:i,maxHeight:o}):a.createElement(q.d,{key:s,codeFile:p?null:g,disableUndoRedoExtension:c,editable:t,extensions:[...u],fileName:l,formatCode:m,fullHeight:i,initialText:d,maxHeight:o,onChange:x})}function eo({edit:e,initialText:t,fileName:n,fullHeight:r,maxHeight:i}){let o=(0,a.useMemo)(()=>new Q,[]);(0,a.useEffect)(()=>{e.oldString&&o.setHighlightText(e.oldString,e.newString,e.done)},[o,e]);let s=(0,a.useMemo)(()=>[l.Z9.define(e=>new ee(o,e),{decorations:e=>e.decorations,provide:()=>[et]})],[o]);return a.createElement(q.d,{editable:!1,fileName:n,fullHeight:r,initialText:t,maxHeight:`${i}px`,extensions:s})}function es({code:e,fileName:t,fullHeight:n,maxHeight:r,onlyShowCode:i}){let o=(0,a.useMemo)(()=>new O,[]);(0,a.useEffect)(()=>{if(e)try{o.setText(e)}catch(t){let e=(0,M.aI)()?L.lV.FIGMAKE:L.lV.CODE_IN_SITES;(0,L.Ho)(t,e,L.a5.EDIT_LOCALLY)}},[o,e]);let s=(0,a.useMemo)(()=>[l.Z9.define(e=>new j(o,e))],[o]);return a.createElement(q.d,{editable:!1,initialText:()=>e,fileName:t,fullHeight:n,maxHeight:`${r}px`,extensions:s,showStats:!i,showGutters:!i})}function ec(){return a.createElement("div",{className:"x10l6tqk x13vifvy xu96u03 x3m8u43 x1ey2m1c xldgpng x1vjfegm x78zum5 xl56j7k x6s0dn4 x47corl"},a.createElement(s.k,null))}},947967:(e,t,n)=>{n.d(t,{$i:()=>a,NR:()=>i,S$:()=>l,Xe:()=>r,kx:()=>s,lV:()=>o,oD:()=>c,t$:()=>u});let a="full_view_body",r="figma_back_to_files",l="make_a_copy_button",i="fullscreen_preview_button",o="publish_button",s="point_and_edit",c="ds_import_selected_library",u="ds_import_use_design_system"},962790:(e,t,n)=>{n.d(t,{K:()=>K});var a=n(848318),r=n(143823),l=n(773511),i=n(531788),o=n(990140),s=n(782073),c=n(82433),u=n(382902),d=n(329228),m=n(173926),x=n(967688),g=n(730143),p=n(677334),h=n(600254),f=n(887437),y=n(824937),E=n(338538),_=n(78926),b=n(364633),v=n(301168),k=n(162796),C=n(309488),S=n(93275),w=n(658029),T=n(469508),N=n(41099),A=n(544405),I=n(1511),L=n(31898),z=n(446951),M=n(906329),R=n(71774),O=n(68097),j=n(855892),B=n(769682),F=n(57679);function $({activeProjects:e,projectIdToPause:t,setProjectIdToPause:n}){let r=(0,u.md)(M.kz);return a.createElement(N.b,{legend:a.createElement("p",{...c.Ay.props(P.textBodyMediumStrong)},(0,x.t)("figmake.settings.pause_project.radio.label")),value:t,onChange:n,readonly:!!r},e.map(e=>a.createElement(N.c,{key:e.id,value:e.id,label:a.createElement(A.J,null,a.createElement(D,{project:e}))})))}function D({project:e}){return a.createElement("div",{key:e.id},a.createElement("p",{...c.Ay.props(P.textBodyMediumStrong)},e.name),a.createElement("p",{...c.Ay.props(P.textBodyMediumSecondary)},(0,x.tx)("figmake.settings.pause_project.created",{timestamp:a.createElement(m.h1,{date:e.created_at})})))}function q({props:e,projectIdToPause:t}){let n=(0,g.tS)(),[r,l]=(0,u.fp)(M.kz),o=(0,_.h5)({toolCallId:e.toolCallId,toolName:e.toolName,trackingContext:e.trackingContext,source:e.source}),s=async()=>{if(!n){console.error("No open file key found");return}if(!t){console.error("No selected project found");return}l(t);try{await h.R.pauseProject({fileKey:n,projectId:t});let a=setInterval(async()=>{let r=await p.M4.fetch((0,j.GO)({fileKey:n,projectId:t}),{policy:"networkOnly"});r?.status.toLowerCase()===y.TL.INACTIVE&&(e.onClose(),clearInterval(a),(0,B.l4)(),l(null),e.connectToExistingProject?e.connectToExistingProject():o())},2e3)}catch(e){l(null),(0,b.ZH)(e)}};return r?a.createElement(a.Fragment,null,a.createElement("p",{...c.Ay.props(P.textBodyMediumSecondary)},(0,x.t)("figmake.supabase.pausing_project.subtitle")),a.createElement(i.$n,{variant:"secondary",onClick:()=>e.onClose(),disabled:!0},(0,x.t)("figmake.pause_project_modal.button.cancel")),a.createElement(R.lV,{variant:"destructive"},(0,x.t)("figmake.pause_project_modal.button.loading"))):a.createElement(a.Fragment,null,a.createElement(i.$n,{variant:"secondary",onClick:()=>e.onClose()},(0,x.t)("figmake.pause_project_modal.button.cancel")),a.createElement(i.$n,{variant:"destructive",onClick:s,disabled:!t},(0,x.t)("figmake.pause_project_modal.button.submit")))}let P={textBodyMediumStrong:{...s.g.textBodyMediumStrong,$$css:!0},textBodyMediumSecondary:{...s.g.textBodyMedium,color:"x1n0bwc9",$$css:!0}},H=(0,z.Ju)(function(e){let t=k.hS({...e}),{organization:n}=(0,y.mS)(),{activeProjects:r}=(0,y.YY)(),l=(0,v.wA)(),i=!!e.toolCallId&&!!e.toolName,[o,s]=(0,a.useState)(void 0);return a.createElement(C.bL,{manager:t,width:394},a.createElement(S.vo,null,a.createElement(S.Y9,null,i&&a.createElement(w.K,{"aria-label":(0,x.t)("figmake.supabase.pause_project_modal.back"),onClick:()=>{e.onClose(),l((0,L.to)({type:O.Z,data:{toolCallId:e.toolCallId,toolName:e.toolName,trackingContext:e.trackingContext,source:e.source},showModalsBeneath:!0}))}},a.createElement(I.C,null)),a.createElement(S.hE,null,(0,x.t)("figmake.pause_project_modal.title"))),a.createElement(S.nB,{scrolling:"none"},a.createElement("div",{className:"x78zum5 xdt5ytf xou54vl"},a.createElement("div",null,(0,x.tx)("figmake.pause_project_modal.body_with_link",{upgradeLink:a.createElement(T.N,{href:(0,F.$X)(n?.id||""),newTab:!0},(0,x.t)("figmake.pause_project_modal.upgrade_link"))})),a.createElement($,{activeProjects:r,projectIdToPause:o,setProjectIdToPause:s}))),a.createElement(S.wi,null,a.createElement(S.jk,{className:"x78zum5 x1q0g3np x13a6bvl x167g77z xhxeiv9 xh8yej3 x9f619"},a.createElement(q,{props:e,projectIdToPause:o})))))},"PauseProjectModal");function U({toolCallId:e,toolName:t,connectToExistingProject:n,trackingContext:a,source:r}){let l=(0,v.wA)();return()=>l((0,L.to)({type:H,data:{toolCallId:e,toolName:t,connectToExistingProject:n,trackingContext:a,source:r},showModalsBeneath:!0}))}let G={textBodyMedium:{...s.g.textBodyMedium,$$css:!0}},V=(0,z.Ju)(function(e){let t=k.hS(e),n=(0,_.h5)({toolCallId:e.toolCallId,toolName:e.toolName,trackingContext:e.trackingContext,source:e.source});return a.createElement(C.bL,{manager:t,width:386},a.createElement(S.vo,null,a.createElement(S.Y9,null,a.createElement(S.hE,null,(0,x.t)("figmake.supabase_cost_warning_modal.title"))),a.createElement(S.nB,null,a.createElement("div",null,a.createElement("p",{...c.Ay.props(G.textBodyMedium)},(0,x.t)("figmake.supabase_cost_warning_modal.body")," ",a.createElement(T.N,{href:F.Sy,newTab:!0},(0,x.t)("general.learn_more"))))),a.createElement(S.wi,null,a.createElement(S.jk,{className:"x78zum5 x1q0g3np x13a6bvl x167g77z xhxeiv9 xh8yej3 x9f619"},a.createElement(i.$n,{variant:"secondary",onClick:e.onClose},(0,x.t)("figmake.supabase.cancel")),a.createElement(i.$n,{variant:"destructive",onClick:()=>{e.onClose(),n()}},(0,x.t)("figmake.supabase_cost_warning_modal.submit"))))))},"SupabaseCostWarningModal");var W=n(947970);function K({onSubmit:e,toolCallId:t,toolName:n,trackingContext:i,source:o}){let{existingProjects:s,isLoading:u}=(0,y.tE)(),d=function({onSubmit:e,toolCallId:t,toolName:n,trackingContext:a,source:r}){let{needsToPauseProject:l}=(0,y.Lz)(),i=(0,_.h5)({toolCallId:t,toolName:n,trackingContext:a,source:r}),o=U({toolCallId:t,toolName:n,trackingContext:a,source:r}),s=function({toolCallId:e,toolName:t,trackingContext:n,source:a}){let r=(0,v.wA)();return()=>r((0,L.to)({type:V,data:{toolCallId:e,toolName:t,trackingContext:n,source:a},showModalsBeneath:!0}))}({toolCallId:t,toolName:n,trackingContext:a,source:r}),c=function(){let{organization:e}=(0,y.mS)();return e?.plan!=="free"}();return()=>{if(e&&e(),c){s();return}if(l){o();return}i()}}({onSubmit:e,toolCallId:t,toolName:n,trackingContext:i,source:o});if(u)return a.createElement(r.k,null);let m=s.filter(e=>e.status.toLowerCase()!==y.TL.REMOVED);return a.createElement("div",null,a.createElement(l.E,{"aria-label":(0,x.t)("figmake.settings.connect_existing_project.create_project.button"),onClick:d},a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x1v2ro7d"},a.createElement(Z,null),a.createElement("p",{...c.Ay.props(J.textBodyMediumStrong)},(0,x.t)("figmake.settings.connect_existing_project.create_project.button")))),a.createElement("div",{className:"xyamay9 x1l90r2v"},a.createElement(R.cG,null)),a.createElement("div",{className:"x78zum5 xdt5ytf xou54vl xl56j7k x1cy8zhl"},m.map(r=>a.createElement(X,{key:r.id,project:r,onSubmit:e,toolCallId:t,toolName:n,trackingContext:i,source:o}))))}function X({project:e,onSubmit:t,toolCallId:n,toolName:r,trackingContext:l,source:o}){let s=e.status.toLowerCase()===y.TL.INACTIVE||e.status.toLowerCase()===y.TL.PAUSING,_=function({onSubmit:e,project:t,isPaused:n,toolCallId:a,toolName:r,source:l,trackingContext:i}){let{needsToPauseProject:o}=(0,y.Lz)(),s=(0,g.tS)(),{organization:c}=(0,y.mS)(),m=c?.id,[,x]=(0,d.IT)((0,j.TT)({fileKey:s})),[,_]=(0,d.IT)((0,j.YF)({fileKey:s})),v=(0,W.S)(),k=(0,u.Xr)(E.Kj),C=async()=>{if(!s||!m){console.error("No open file key or organization ID found");return}e&&e(),k({project:t,state:"connecting"});try{await h.R.connectFile({fileKey:s,supabaseProjectId:t.id,supabaseOrgId:m})}catch(e){(0,b.AW)(e),k(null)}if((0,f.uF)(i||{persistentEntityId:"",clientLifecycleId:""},l,s,"existing"),await x.refetch(),n){try{await h.R.restoreFile({fileKey:s})}catch(e){(0,b.oT)(e),k(null)}S()}else w()},S=()=>{let e=setInterval(async()=>{let t=await p.M4.fetch((0,j.TT)({fileKey:s}),{policy:"networkOnly"});t?.connectedProject?.status.toLowerCase()===y.TL.ACTIVE_HEALTHY&&(clearInterval(e),w(),_.refetch())},2e3)},w=()=>{k(null),a&&r&&v({toolCallId:a,toolName:r,toolResult:{success:!0,message:"Connected to Supabase."}})},T=U({toolCallId:a,toolName:r,connectToExistingProject:C,trackingContext:i,source:l});return async()=>{n&&o?(e&&e(),T()):await C()}}({project:e,isPaused:s,onSubmit:t,toolCallId:n,toolName:r,trackingContext:l,source:o});return a.createElement("div",{key:e.id,className:"x78zum5 x1q0g3np x6s0dn4 x1v2ro7d xh8yej3"},a.createElement(R.mj,{variant:"existing_project",inactive:s}),a.createElement("div",{className:"x78zum5 x1q0g3np x1qughib x6s0dn4 x1v2ro7d xh8yej3"},a.createElement("div",{className:"x78zum5 xdt5ytf x1cy8zhl"},a.createElement("p",{...c.Ay.props(J.textBodyMediumStrong)},e.name),a.createElement("div",{className:"x78zum5 x1q0g3np x1cy8zhl x1jnr06f"},a.createElement(Y,{isPaused:s}),a.createElement("span",null,"\xb7"),a.createElement("span",{...c.Ay.props(J.textBodyMediumSecondary)},(0,x.tx)("figmake.settings.pause_project.created",{timestamp:a.createElement(m.h1,{date:e.created_at})})))),a.createElement(i.$n,{variant:"secondary",onClick:_},(0,x.t)("figmake.settings.connect_existing_project.project.button"))))}function Y({isPaused:e}){return e?a.createElement("span",{...c.Ay.props(J.textBodyMediumSecondaryStrong)},(0,x.t)("figmake.settings.connect_existing_project.status.project.paused")):a.createElement("span",{...c.Ay.props(J.textBodyMediumSuccessStrong)},(0,x.t)("figmake.settings.connect_existing_project.status.project.active"))}function Z(){return a.createElement("div",{className:"x78zum5 x1td3qas x10w6t97 xfawy5m xl56j7k x6s0dn4 x1sxf85j x6ce33m"},a.createElement(o.e,null))}let J={textBodyMediumSecondary:{...s.g.textBodyMedium,color:"x1n0bwc9",$$css:!0},textBodyMediumSecondaryStrong:{...s.g.textBodyMediumStrong,color:"x1n0bwc9",$$css:!0},textBodyMediumSuccessStrong:{...s.g.textBodyMediumStrong,color:"xq6u9c4",$$css:!0},textBodyMediumStrong:{...s.g.textBodyMediumStrong,$$css:!0}}},68097:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(848318),r=n(162796),l=n(309488),i=n(93275);n(82433);var o=n(967688),s=n(446951),c=n(962790);let u=(0,s.Ju)(function(e){let t=r.hS(e);return a.createElement(l.bL,{manager:t,width:386},a.createElement(i.vo,null,a.createElement(i.Y9,null,a.createElement(i.hE,null,(0,o.t)("figmake.connect_existing_projects_modal.title"))),a.createElement(i.nB,null,a.createElement("div",{className:"x1y1aw1k x1l90r2v"},a.createElement(c.K,{onSubmit:e.onClose,toolCallId:e.toolCallId,toolName:e.toolName,trackingContext:e.trackingContext,source:e.source})))))},"SupabaseConnectExistingProjectsModal")},78926:(e,t,n)=>{n.d(t,{AP:()=>j,h5:()=>B});var a=n(848318),r=n(301168),l=n(162796),i=n(309488),o=n(93275),s=n(531788),c=n(788502),u=n(323209),d=n(629640),m=n(56629),x=n(800490),g=n(782073),p=n(82433),h=n(43746),f=n(967688),y=n(31898),E=n(511067),_=n(730143),b=n(677334),v=n(600254),k=n(446951),C=n(120846),S=n(887437),w=n(855892),T=n(71774),N=n(57679),A=n(364633),I=n(947970);function L({value:e,setValue:t,disabled:n}){let r=(0,f.t)("figmake.settings.create_project_modal.project_name.label"),l=(0,f.t)("figmake.settings.create_project_modal.project_name.placeholder");return a.createElement("div",{className:"x78zum5 xdt5ytf x1v2ro7d"},a.createElement("div",{className:"x78zum5 x1q0g3np x1qughib"},a.createElement("label",{htmlFor:r,...p.Ay.props(O.textBodyMediumStrong)},r)),a.createElement("div",{className:"x78zum5 xdt5ytf x1jnr06f"},a.createElement(c.p,{type:"text",id:r,value:e,onChange:t,placeholder:l,size:"lg",disabled:n})))}function z({value:e,setValue:t,helperText:n,disabled:r}){let l=(0,f.t)("figmake.settings.create_project_modal.db_pass.label"),i=(0,f.t)("figmake.settings.create_project_modal.db_pass.placeholder"),[o,s]=a.useState(!1),[g,y]=a.useState(!1);return a.createElement("div",{className:"x78zum5 xdt5ytf x1v2ro7d"},a.createElement("div",{className:"x78zum5 x1q0g3np x1qughib"},a.createElement("label",{htmlFor:l,...p.Ay.props(O.textBodyMediumStrong)},l),a.createElement("button",{onClick:e=>{e.preventDefault(),t((0,h.b)()),y(!0),s(!0),setTimeout(()=>{s(!1)},500)},className:"x1lcq9ky x1n0bwc9 x78zum5 x1q0g3np"},a.createElement(d._,{...p.Ay.props(o?O.rotatePasswordGenerateIcon:O.passwordGenerateIcon)}),a.createElement("span",null,(0,f.t)("figmake.settings.create_project_modal.password.generate")))),a.createElement("div",{className:"x1n2onr6 x1rg5ohu"},a.createElement(c.p,{type:g?"text":"password",id:l,value:e,onChange:t,placeholder:i,size:"lg",disabled:r}),a.createElement("span",{className:"x10l6tqk x19up5dg xbfrwjf xmauxvm"},a.createElement(u.f,{checked:g,onIcon:a.createElement(m._,null),offIcon:a.createElement(x.j,null),"aria-label":(0,f.t)("figmake.settings.create_project_modal.password.view_hide"),htmlAttributes:{"data-tooltip":(0,f.t)("figmake.settings.create_project_modal.password.view_hide"),"data-tooltip-type":"text"},onChange:()=>y(e=>!e)}))),n&&a.createElement("div",{...p.Ay.props(O.textBodyMediumSecondary)},n))}var M=(e=>(e.US_EAST_1="us-east-1",e.US_EAST_2="us-east-2",e.US_WEST_1="us-west-1",e.AP_SOUTHEAST_1="ap-southeast-1",e.AP_NORTHEAST_1="ap-northeast-1",e.AP_NORTHEAST_2="ap-northeast-2",e.AP_SOUTHEAST_2="ap-southeast-2",e.EU_WEST_1="eu-west-1",e.EU_WEST_2="eu-west-2",e.EU_WEST_3="eu-west-3",e.EU_NORTH_1="eu-north-1",e.EU_CENTRAL_1="eu-central-1",e.EU_CENTRAL_2="eu-central-2",e.CA_CENTRAL_1="ca-central-1",e.AP_SOUTH_1="ap-south-1",e.SA_EAST_1="sa-east-1",e))(M||{});function R({selectedRegion:e,setSelectedRegion:t}){let n=(0,r.wA)(),l=(0,E.Um)(),i=e=>{switch(e){case"us-east-1":return(0,f.t)("figmake.settings.create_project_modal.region.us_east_1");case"us-east-2":return(0,f.t)("figmake.settings.create_project_modal.region.us_east_2");case"us-west-1":return(0,f.t)("figmake.settings.create_project_modal.region.us_west_1");case"ap-southeast-1":return(0,f.t)("figmake.settings.create_project_modal.region.ap_southeast_1");case"ap-northeast-1":return(0,f.t)("figmake.settings.create_project_modal.region.ap_northeast_1");case"ap-northeast-2":return(0,f.t)("figmake.settings.create_project_modal.region.ap_northeast_2");case"ap-southeast-2":return(0,f.t)("figmake.settings.create_project_modal.region.ap_southeast_2");case"eu-west-1":return(0,f.t)("figmake.settings.create_project_modal.region.eu_west_1");case"eu-west-2":return(0,f.t)("figmake.settings.create_project_modal.region.eu_west_2");case"eu-west-3":return(0,f.t)("figmake.settings.create_project_modal.region.eu_west_3");case"eu-north-1":return(0,f.t)("figmake.settings.create_project_modal.region.eu_north_1");case"eu-central-1":return(0,f.t)("figmake.settings.create_project_modal.region.eu_central_1");case"eu-central-2":return(0,f.t)("figmake.settings.create_project_modal.region.eu_central_2");case"ca-central-1":return(0,f.t)("figmake.settings.create_project_modal.region.ca_central_1");case"ap-south-1":return(0,f.t)("figmake.settings.create_project_modal.region.ap_south_1");case"sa-east-1":return(0,f.t)("figmake.settings.create_project_modal.region.sa_east_1");default:throw Error("Unknown region")}};return a.createElement("div",{className:"x78zum5 xdt5ytf x1v2ro7d"},a.createElement("label",{id:"supabase-project-database-region-select",...p.Ay.props(O.textBodyMediumStrong)},(0,f.t)("figmake.settings.create_project_modal.region.label")),a.createElement(C.l6,{ariaLabelledBy:"supabase-project-database-region-select",inputClassName:"x1kowl60 x6sinrp",id:"supabase-project-database-region-select",property:e,formatter:{format:i},onChange:t,dispatch:n,dropdownShown:l},Object.values(M).map(e=>a.createElement(C.c$,{value:e,key:e},i(e)))))}let O={rotatePasswordGenerateIcon:{animation:"xg6l7co",animationComposition:null,animationName:null,animationDuration:null,animationTimingFunction:null,animationDelay:null,animationIterationCount:null,animationDirection:null,animationFillMode:null,animationPlayState:null,animationRange:null,animationRangeEnd:null,animationRangeStart:null,animationTimeline:null,"--color-icon":"xmauxvm",$$css:!0},passwordGenerateIcon:{"--color-icon":"xmauxvm",$$css:!0},textBodyMediumStrong:{...g.g.textBodyMediumStrong,$$css:!0},textBodyMediumSecondary:{...g.g.textBodyMedium,color:"x1n0bwc9",$$css:!0}},j=(0,k.Ju)(function(e){let[t,n]=(0,a.useState)(!1),r=l.hS({...e,preventUserClose:t}),c=(0,_.q5)(),[u,d]=(0,a.useState)(c?.name||""),[m,x]=(0,a.useState)(""),[g,h]=(0,a.useState)(),[y,E]=(0,a.useState)("us-east-1"),[k,C]=(0,a.useState)(!1),[M,j]=(0,a.useState)(!0),B=(0,I.S)();(0,a.useEffect)(()=>{u.length>0&&m.length>0?j(!1):j(!0),m.length>=4&&h(void 0)},[u,m]);let F=async()=>{if(!c)return;if(m.length<4){h("dbPassTooShort");return}n(!0),C(!0);let t=await v.R.createProject({fileKey:c.key,projectName:u,dbPass:m,region:y}).then(e=>{let{id:t,organization_id:n,name:a,region:r,created_at:l,status:i}=e.data.meta;return{id:t,organization_id:n,name:a,region:r,created_at:l,status:i}}).catch(e=>{(0,A.YH)(e)});if(!t||!await v.R.connectFile({fileKey:c.key,supabaseProjectId:t.id,supabaseOrgId:t.organization_id}).catch(e=>{(0,A.AW)(e)})){C(!1);return}(0,S.uF)(e.trackingContext||{persistentEntityId:"",clientLifecycleId:""},e.source,c.key,"new");let a=setInterval(async()=>{let{connectedProject:t}=await b.M4.fetch((0,w.TT)({fileKey:c.key}),{policy:"networkOnly"});t?.public_anon_key&&(C(!1),n(!1),e.toolCallId&&e.toolName&&B({toolCallId:e.toolCallId,toolName:e.toolName,toolResult:{success:!0,message:"Connected to Supabase."}}),clearInterval(a),e.onClose())},2e3);setTimeout(()=>{clearInterval(a),C(!1),e.onClose()},1e4)},$="dbPassTooShort"===g?(0,f.tx)("figmake.settings.create_project_modal.db_pass.too_short"):(0,f.tx)("figmake.settings.create_project_modal.db_pass.context",{learnMoreLink:a.createElement("a",{target:"_blank",href:N.kS},(0,f.t)("general.learn_more"))});return a.createElement(i.bL,{manager:r,width:386},a.createElement(i.Rq,{onSubmit:F},a.createElement(o.Y9,null,a.createElement(o.hE,null,(0,f.t)("figmake.settings.create_project_modal.title"))),a.createElement(o.nB,{scrolling:"none"},a.createElement("div",{className:"x1ib1h6n x78zum5 xdt5ytf x1c1vhfx"},a.createElement(L,{value:u,setValue:d,disabled:k}),a.createElement(R,{selectedRegion:y,setSelectedRegion:E}),a.createElement(z,{value:m,setValue:x,helperText:$,disabled:k}))),a.createElement(o.wi,null,a.createElement(o.jk,{className:"x78zum5 x1q0g3np x13a6bvl x167g77z xhxeiv9 xh8yej3 x9f619"},k&&a.createElement("p",{...p.Ay.props(O.textBodyMediumSecondary)},(0,f.t)("figmake.supabase.creating_project.subtitle")),a.createElement(s.$n,{variant:"secondary",onClick:()=>r.props.close({source:"button"})},(0,f.t)("figmake.settings.create_project_modal.button.cancel")),k?a.createElement(T.lV,{variant:"primary"},(0,f.t)("figmake.settings.create_project_modal.button.submit.loading")):a.createElement(s.$n,{variant:"primary",type:"submit",disabled:M},(0,f.t)("figmake.settings.create_project_modal.button.submit"))))))},"CreateProjectModal");function B({toolCallId:e,toolName:t,trackingContext:n,source:a}){let l=(0,r.wA)();return()=>l((0,y.to)({type:j,data:{toolCallId:e,toolName:t,trackingContext:n,source:a},showModalsBeneath:!0}))}},364633:(e,t,n)=>{n.d(t,{AW:()=>d,EQ:()=>g,YH:()=>s,ZH:()=>c,fQ:()=>u,lN:()=>x,oT:()=>m,wH:()=>o});var a=n(938982),r=n(998568),l=n(522277),i=n(769682);function o(e){(0,l.r)(),(0,r.$D)(a.e.AI_FOR_PRODUCTION,e)}function s(e){if(e.message.match(/^(.*?)Project with name (.+?) already exists in your organization\.$/)){(0,i.ym)();return}if(e.message.match(/^(.*)maximum limits for the number of active free projects(.*)$/)){(0,i.ZK)();return}(0,i.u)(),o(e)}function c(e){(0,i.it)(),o(e)}function u(e){o(e)}function d(e){(0,i.jx)(),o(e)}function m(e){(0,i.n9)(),o(e)}function x(e){(0,i.m8)(),o(e)}class g extends Error{constructor(){super("No index.tsx file found in the code files"),this.name="NoIndexFileError"}}},71774:(e,t,n)=>{n.d(t,{Gt:()=>y,cG:()=>C,jc:()=>b,lV:()=>v,ls:()=>k,mj:()=>h,p1:()=>E,p_:()=>f});var a=n(848318),r=n(531788),l=n(143823),i=n(415676),o=n(782073),s=n(82433),c=n(720522),u=n(334804),d=n(967688),m=n(912873),x=n(824937),g=n(57679),p=n(114344);function h({inactive:e,variant:t="connected_project"}){return a.createElement("div",{...e?{className:"x78zum5 xl56j7k x6s0dn4 x1sxf85j xkawg4k"}:{className:"x78zum5 xl56j7k x6s0dn4 x1sxf85j xgcem94"},style:"existing_project"===t?{width:"32px",height:"32px"}:{width:"40px",height:"40px",border:"1px solid var(--color-border)"}},a.createElement(c.B,{svg:p.A,useOriginalSrcFills_DEPRECATED:!0,svgWidth:"16px",svgHeight:"16px",style:{filter:e?"grayscale(100%)":void 0}}))}function f(){let{organization:e}=(0,x.mS)();return a.createElement("div",{className:"x1tamke2 xh8yej3 x9f619"},a.createElement("div",{className:"x78zum5 x1q0g3np x1qughib x6s0dn4 xh8yej3"},a.createElement("div",{className:"x78zum5 xdt5ytf x1nhvcw1 xdpxx8g"},e&&a.createElement(u.G,{...s.Ay.props(S.orgName),text:e?.name}),a.createElement("p",{...s.Ay.props(S.textBodyMediumSecondary)},(0,d.t)("figmake.settings.project.org_info.title"))),e&&a.createElement(b,{url:(0,g.n1)(e.id),linkText:(0,d.t)("figmake.settings.project.org_info.link")})))}function y({children:e}){return a.createElement(a.Fragment,null,a.createElement("div",{className:"x78zum5 xdt5ytf x1qughib x1cy8zhl x1tny46i x1kgkb76 x1y8v6su x1tamke2 xh8yej3 x9f619"},a.createElement("p",{...s.Ay.props(S.textBodyLargeStrong)},(0,d.t)("figmake.settings.project.header.title")),a.createElement("p",{...s.Ay.props(S.textBodyMediumSecondary)},(0,d.t)("figmake.settings.project.header.subtitle"))),e)}function E({badge:e,actions:t,inactive:n,header:r,orgAlt:l}){return a.createElement("div",{className:"x1tamke2"},a.createElement("div",{className:"x78zum5 x1q0g3np x1qughib x6s0dn4 xh8yej3"},a.createElement("div",{className:"x78zum5 x1q0g3np x1nhvcw1 x6s0dn4 x1v2ro7d"},a.createElement(h,{inactive:n}),a.createElement("div",{className:"x78zum5 xdt5ytf x1nhvcw1 x1cy8zhl"},a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x167g77z"},a.createElement(u.G,{...s.Ay.props(S.textBodyLargeStrong),text:r}),e),l||a.createElement(_,null))),a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4 x167g77z"},t)))}function _(){let{organization:e}=(0,x.mS)();return a.createElement(u.G,{...s.Ay.props(S.orgText),text:e?e.name:(0,d.t)("figmake.settings.project.org_info.title")})}function b({url:e,linkText:t}){return a.createElement("a",{className:"x78zum5 x1q0g3np x1qughib x6s0dn4 x1wt4b31 xebhuq6",target:"_blank",href:e},a.createElement(i.S,null),a.createElement("p",{...s.Ay.props(S.textBodyMedium)},t))}function v({variant:e,children:t}){return a.createElement(r.$n,{variant:e,disabled:!0},a.createElement("div",{className:"x78zum5 x1q0g3np x6s0dn4"},a.createElement(l.k,null),a.createElement("p",{...s.Ay.props(S.textBodyMedium)},t)))}function k({size:e}){let t=(0,x.RK)();return t?a.createElement(m.H8,{user:t,size:e}):null}function C(){return a.createElement("div",{className:"xv42yna xh8yej3"})}let S={orgName:{...o.g.textBodyLargeStrong,maxWidth:"x256u9z",whiteSpace:"xuxw1ft",overflow:"xb3r6kr",overflowX:null,overflowY:null,textOverflow:"xlyipyv",$$css:!0},textBodyLargeStrong:{...o.g.textBodyLargeStrong,$$css:!0},textBodyMediumSecondary:{...o.g.textBodyMedium,color:"x1n0bwc9",$$css:!0},textBodyMedium:{...o.g.textBodyMedium,$$css:!0},orgText:{...o.g.textBodyMedium,color:"x1n0bwc9",maxWidth:"x256u9z",whiteSpace:"xuxw1ft",overflow:"xb3r6kr",overflowX:null,overflowY:null,textOverflow:"xlyipyv",$$css:!0}}},947970:(e,t,n)=>{n.d(t,{S:()=>x});var a=n(909678),r=n(186606),l=n(730143),i=n(125761),o=n(597803),s=n(897659),c=n(267266),u=n(494407),d=n(887437),m=n(304738);function x(){let e=(0,l.tS)(),{codeLibraryInstance:t}=(0,m.oA)(),n=(0,i.iZ)(),x=(0,d.qE)(e,t?.guid||""),g=(0,o.Xu)(),p=(0,c.P)();return({toolCallId:l,toolName:i,toolResult:o})=>{if(!r.glU||!n||!t)return;let c={id:r.glU.generateUniqueID(),type:r.K$p.TOOL_MESSAGE,userId:n.id,textContent:(0,a.J6)({plainText:""}),sentAt:Date.now(),toolCalls:[],toolResults:[(0,a.k4)({toolCallId:l,toolName:i,result:o})]},m=(0,d.Pd)(e,t.guid||"",c.id);(0,u.yc)({featureType:s.lV.FIGMAKE,chatMessagesNode:t,newMessage:c,rawUserChatDetails:void 0,user:n,persistentEntityId:x,clientLifecycleId:m,setInput:()=>{},fileKey:e,canUseSupabase:g,model:p})}}},769682:(e,t,n)=>{n.d(t,{A9:()=>y,SR:()=>E,ZK:()=>d,it:()=>p,jx:()=>x,l4:()=>h,m8:()=>_,n9:()=>g,rq:()=>f,u:()=>m,ym:()=>u});var a=n(398612),r=n(476254),l=n(967688),i=n(952039),o=n(113752),s=n(57679),c=(e=>(e.PROJECT_NAME_TAKEN="supabase-project-name-taken",e.ACTIVE_FREE_PROJECT_LIMIT="supabase-active-free-project-limit",e.PROJECT_CREATION_UNSUCCESSFUL="supabase-project-creation-unsuccessful",e.PROJECT_CONNECTION_UNSUCCESSFUL="supabase-project-connection-unsuccessful",e.PROJECT_RESTORE_UNSUCCESSFUL="supabase-project-restore-unsuccessful",e.PAUSING_PROJECT_UNSUCCESSFUL="supabase-pausing-project-unsuccessful",e.PAUSING_PROJECT_SUCCESSFUL="supabase-pausing-project-successful",e.DEPLOY_UNSUCCESSFUL="supabase-deploy-unsuccessful",e.DEPLOY_SUCCESSFUL="supabase-deploy-successful",e.NOTHING_TO_DEPLOY="supabase-nothing-to-deploy",e.AUTHENTICATION_UNSUCCESSFUL="supabase-authentication-unsuccessful",e))(c||{});function u(){r.D.dispatch(i.F.enqueue({message:(0,l.t)("figmake.supabase.errors.project_name_taken"),type:"supabase-project-name-taken",icon:o.zX.EXCLAMATION,timeoutOverride:3e3,error:!0}))}function d(){r.D.dispatch(i.F.enqueue({message:(0,l.t)("figmake.supabase.errors.project_creation_unsuccessful.need_to_pause"),type:"supabase-active-free-project-limit",icon:o.zX.EXCLAMATION,timeoutOverride:3e3,error:!0,button:{text:(0,l.t)("figmake.supabase.errors.project_creation_unsuccessful.need_to_pause.button"),action:()=>{(0,a.FJ)(s.v7,"_blank")}}}))}function m(){r.D.dispatch(i.F.enqueue({message:(0,l.t)("figmake.supabase.errors.project_creation_unsuccessful"),type:"supabase-project-creation-unsuccessful",icon:o.zX.EXCLAMATION,timeoutOverride:3e3,error:!0}))}function x(){r.D.dispatch(i.F.enqueue({message:(0,l.t)("figmake.supabase.errors.project_connection_unsuccessful"),type:"supabase-project-connection-unsuccessful",icon:o.zX.EXCLAMATION,timeoutOverride:3e3,error:!0}))}function g(){r.D.dispatch(i.F.enqueue({message:(0,l.t)("figmake.supabase.errors.project_restore_unsuccessful"),type:"supabase-project-restore-unsuccessful",icon:o.zX.EXCLAMATION,timeoutOverride:3e3,error:!0}))}function p(){r.D.dispatch(i.F.enqueue({message:(0,l.t)("figmake.supabase.errors.pausing_project_unsuccessful"),type:"supabase-pausing-project-unsuccessful",icon:o.zX.EXCLAMATION,timeoutOverride:3e3,error:!0}))}function h(){r.D.dispatch(i.F.enqueue({message:(0,l.t)("figmake.supabase.errors.pausing_project_successful"),type:"supabase-pausing-project-successful",icon:o.zX.CHECK,timeoutOverride:3e3}))}function f(){r.D.dispatch(i.F.enqueue({message:(0,l.t)("figmake.supabase.errors.deploy_unsuccessful"),type:"supabase-deploy-unsuccessful",icon:o.zX.EXCLAMATION,timeoutOverride:3e3,error:!0}))}function y(){r.D.dispatch(i.F.enqueue({message:(0,l.t)("figmake.supabase.errors.deploy_successful"),type:"supabase-deploy-successful",icon:o.zX.CHECK,timeoutOverride:3e3}))}function E(){r.D.dispatch(i.F.enqueue({message:(0,l.t)("figmake.supabase.errors.nothing_to_deploy"),type:"supabase-nothing-to-deploy",icon:o.zX.EXCLAMATION,timeoutOverride:3e3,error:!0}))}function _(){r.D.dispatch(i.F.enqueue({message:(0,l.t)("figmake.supabase.errors.authentication_unsuccessful"),type:"supabase-authentication-unsuccessful",icon:o.zX.EXCLAMATION,timeoutOverride:3e3,error:!0}))}},885800:(e,t,n)=>{n.d(t,{A:()=>f});var a=n(382902),r=n(182317),l=n(730143),i=n(677334),o=n(600254),s=n(412775),c=n(597803),u=n(906329),d=n(182656),m=n(304738),x=n(364633),g=n(855892),p=n(276630),h=n(769682);function f(){let e=(0,a.Xr)(u.p7),{entryPointCodeInstance:t}=(0,m.oA)(),n=(0,d.vD)(t?.guid??null),f=(0,d.I4)(n),y=(0,l.tS)(),E=(0,a.Xr)(c.Xl),_=(0,a.Xr)(c.GV),b=(0,a.Xr)(p.GA),[,v]=(0,p.PM)();return async t=>{let{showVisualBells:n}=t;if(!y){console.error("No open file key found");return}try{e(u.Ut.DEPLOYING);let t=(0,s.fK)(),a={};for(let[e,n]of Object.entries(t))if(e.includes("/supabase/functions/server/")){let t=e.split("/").pop(),r=n.sourceCode;t&&r&&(a[t]=r)}if(!a["index.tsx"])throw new x.EQ;let r=await o.R.deployEdgeFunction({fileKey:y,files:a});b(r.data.meta.version),(0,p.ZO)(),setTimeout(()=>{i.M4.fetch((0,g.gZ)({fileKey:y,functionName:"make-server"}),{policy:"networkOnly"})},5e3),f(),n&&(0,h.A9)()}catch(t){if(t instanceof x.EQ){n&&(0,h.SR)();return}n&&(0,h.rq)(),(0,x.wH)(t);let e={id:(0,r.g)(),event_message:`Error while deploying: ${t instanceof Error?t.message:String(t)}`,timestamp:Date.now().toString(),level:"error"};v(t=>[...t,e])}finally{e(u.Ut.INIT),E(!1),_(!1)}}}}}]);

//# debugId=1692c739-cf8b-50e4-90c0-2c619989e8b5

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/a228055d183284cf8e61fb7bc15eacfe633d09f1/1119-97d6d5b7f9f67f83.min.js.map